<!DOCTYPE html>

<!-- saved from url=(0090)file:///C:/Users/Jo/OneDrive/Documents/Servidor%20de%20Pruebas%20de%20Proyectos/index.html -->
<html lang="en">
<head>
  <script>
    // Safety globals for Google APIs
    window.gapiInited = false;
    window.gisInited = false;
    window.tokenClient = null;
    window.gapiAccessToken = null;
    window.state = window.state || { settings: {} };
  </script>
  <meta charset="utf-8"/>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>Omni-Coder Unified Tracker v20.3 (Final Restoration Build)</title>
  <link href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text y=%22.9em%22 font-size=%2290%22&gt;%F0%9F%8F%A8&lt;/text&gt;&lt;/svg&gt;" rel="icon"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <meta content="unsafe-none" http-equiv="Cross-Origin-Opener-Policy"/>

  <!-- Google Analytics (GA4) - Replace GA_MEASUREMENT_ID with your actual ID -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDT5RT8T9X"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-FDT5RT8T9X');
  </script>

  <!-- Google Ads Script -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8211255923000898" crossorigin="anonymous"></script>

  <!-- Add Google API Script for gapi -->
  <script src="https://apis.google.com/js/api.js"></script> <!-- Google API script -->

  <!-- Existing scripts -->
  <script async="" src="./index_files/cb=gapi.loaded_0"></script>
  <script src="./index_files/saved_resource"></script>
  <script src="./index_files/chart.js.download"></script>
  <script src="./index_files/confetti.browser.min.js.download"></script>
  <script src="./index_files/umd.js.download"></script>

  <!-- Photon Autocomplete Library (CSS & JS) -->
  <script async="" defer="" gapi_processed="true" onerror="gapiLoadError(event)" onload="gapiLoaded()" src="./index_files/api.js.download"></script>
  <script async="" defer="" onerror="gisLoadError(event)" onload="gisLoaded()" src="./index_files/client"></script>

  <script>
      // Function to initialize Google API client and enable Google Sheets API
    function maybeEnableAndInitClient() { 
      if (typeof gapi !== 'undefined' && gapiInited && gisInited) { 
        const clientId = state.settings.googleClientId; 
        if (clientId) { 
          tokenClient = google.accounts.oauth2.initTokenClient({ 
            client_id: clientId, 
            scope: 'https://www.googleapis.com/auth/spreadsheets',
            callback: async (tokenResponse) => { 
              if (tokenResponse.error) { 
                console.error('Token error:', tokenResponse.error);
                showToast('Authorization failed', 'error');
                return;
              }
              gapiAccessToken = tokenResponse.access_token; 
              gapi.client.setToken({ access_token: gapiAccessToken });
              console.log('‚úÖ Google Sheets token set:', gapiAccessToken);
              updateSigninStatus(true); 
              showToast('Authorization successful!', 'success'); 
              await syncToGoogleSheet(); 
            } 
          }); 
          document.querySelector('#authButton').disabled = false;
          document.querySelector('#googleAuthStatus').textContent = 'Status: Ready to Authorize';
        } else { 
          document.querySelector('#authButton').disabled = true;
          document.querySelector('#googleAuthStatus').textContent = 'Status: Client ID Missing';
        } 
      } else {
        document.querySelector('#authButton').disabled = true;
        document.querySelector('#googleAuthStatus').textContent = 'Status: Loading Google APIs...';
      }
    }

    // Function to update the UI based on whether the user is signed in
    function updateSigninStatus(isSignedIn) {
      console.log('updateSigninStatus called:', isSignedIn);
      if (isSignedIn) {
        document.querySelector('#authButton').classList.add('hidden');
        document.querySelector('#signoutButton').classList.remove('hidden');
        document.querySelector('#manualSyncButton').disabled = false;
        document.querySelector('#googleAuthStatus').textContent = 'Status: Authorized';
        document.querySelector('#googleAuthStatus').style.color = '#166534';
      } else {
        document.querySelector('#authButton').classList.remove('hidden');
        document.querySelector('#signoutButton').classList.add('hidden');
        document.querySelector('#manualSyncButton').disabled = true;
        document.querySelector('#googleAuthStatus').textContent = 'Status: Not Authorized';
        document.querySelector('#googleAuthStatus').style.color = '#991b1b';
      }
    }

    // ü¶à SHARK MODE SYNC FUNCTION
    function updateSharkModeSync() {
        const salesCount = (state.reservations || []).filter(r => r.status !== 'cancelled').length;
        const baseline = (state.settings && Number.isInteger(state.settings.spinOffset)) ? state.settings.spinOffset : 0;
        const effectiveSales = Math.max(0, salesCount - baseline);
        
        localStorage.setItem('performanceData', JSON.stringify({ 
            sales: effectiveSales, 
            timestamp: Date.now() 
        }));
        console.log('ü¶à Shark Mode Synced:', effectiveSales, 'sales');
    }

    // Function to sync data with Google Sheets
    async function syncToGoogleSheet() {
  try {
    // Ensure gapi.client is properly initialized
    if (!gapi.client || !gapi.client.sheets) {
      console.error('Google Sheets API not initialized');
      showToast('Google Sheets API not initialized', 'error');
      return;
    }

    // Check if the user is authorized
    if (!gapiAccessToken) {
      showToast('Not authorized yet', 'error');
      return;
    }

    // Get sheet info
    const spreadsheetId = state.settings.googleSheetId;
    const sheetName = state.settings.googleSheetName || 'Sheet1';

    // Ensure the spreadsheetId is valid
    if (!spreadsheetId) {
      console.error('Spreadsheet ID is missing');
      showToast('Missing Spreadsheet ID', 'error');
      return;
    }

    // PREPARE DATA TO WRITE
    const activeSales = (state.reservations || []).filter(r => r.status !== 'cancelled').length;
    const totalCommissions = (state.reservations || []).reduce((sum, r) => sum + (r.commissionAmount || 0), 0);
    const totalCalls = (state.callRecords || []).length;
    const successfulCalls = (state.callRecords || []).filter(c => c.outcome === 'Successful Sale').length;
    const conversionRate = totalCalls > 0 ? (successfulCalls / totalCalls * 100).toFixed(1) : 0;
    
    const values = [
      ['Last Sync', new Date().toLocaleString()],
      ['Total Active Sales', activeSales],
      ['Total Commissions', totalCommissions],
      ['Total Calls', totalCalls],
      ['Successful Calls', successfulCalls],
      ['Conversion Rate', conversionRate + '%'],
      ['Today Work Time', formatTime(state.timeTracking.todayWorkSeconds)],
      ['Calls Without Sale', state.callsWithoutSale || 0]
    ];

    // WRITE DATA TO GOOGLE SHEETS
    const res = await gapi.client.sheets.spreadsheets.values.update({
      spreadsheetId: spreadsheetId,
      range: `${sheetName}!A1:B8`,
      valueInputOption: 'RAW',
      resource: {
        values: values
      }
    });

    console.log('‚úÖ Sheets data WRITTEN:', res);
    showToast('Data successfully written to Google Sheets!', 'success');

  } catch (err) {
    console.error('‚ùå Google Sheets sync error:', err);
    console.error('Error details:', err.result);
    showToast('Failed to sync with Google Sheets', 'error');
  }
}

    // Bind the manual sync button to trigger syncToGoogleSheet function
    document.querySelector('#manualSyncButton').addEventListener('click', async function() {
      console.log('üîÑ Manual sync button clicked');
      await syncToGoogleSheet();
    });
  </script>
<style>
  /* --- Embedded Photon Autocomplete CSS --- */
  .photon-input{position:relative}.photon-input .photon-input-clear{position:absolute;right:0;top:0;background:0 0;border:none;cursor:pointer;outline:0;display:none;padding:5px;width:30px;height:30px}.photon-input .photon-input-clear.show{display:block}.photon-input .photon-input-clear svg{fill:#999}.photon-input .photon-input-clear svg:hover{fill:#000}.photon-suggestions{position:absolute;z-index:99;background-color:#fff;border-radius:2px;box-shadow:0 2px 4px rgba(0,0,0,.2);max-height:260px;overflow-y:auto;width:100%}.photon-suggestions.empty{padding:5px;font-style:italic;color:gray}.photon-suggestions .photon-suggestion{cursor:pointer;display:block;padding:5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:22px}.photon-suggestions .photon-suggestion.selected{background-color:#f2f2f2}
   
   /* --- Main Application CSS --- */
   body { background-color: #fce7f3; transition: background 2s ease; }
   #background-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 0; overflow: hidden; background-color: inherit; transition: background-color 2s ease; }
   #background-image { position: absolute; top: 50%; left: 50%; width: 100%; height: 100%; object-fit: cover; transform: translate(-50%, -50%); transition: opacity 0.5s ease; opacity: 0;}
   body.ken-burns-active #background-image { animation: ken-burns 40s ease-in-out infinite alternate; min-width: 150%; min-height: 150%; }
   @keyframes ken-burns { 0% { transform: translate(-50%, -50%) scale(1); } 100% { transform: translate(-55%, -45%) scale(1.2); } }
   .main-content { position: relative; z-index: 1; }
   .card { border-radius: 0.75rem; box-shadow: 0 1px 2px rgba(0,0,0,0.06); padding: 1.25rem; }
   .btn { padding: 0.5rem 0.75rem; border-radius: 0.5rem; color: white; font-weight: 600; cursor: pointer; transition: background-color .2s ease, transform .1s ease, box-shadow .2s ease; }
   .btn:hover { transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
   .btn:active { transform: translateY(0px); box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
   .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; box-shadow: none; }
   .modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 50; }
   #modalLocation { z-index: 60; }
   .modal { max-width: 560px; width: 100%; border-radius: 0.75rem; padding: 1.25rem; }
   .hidden { display: none; }
   .progress { height: 10px; border-radius: 9999px; background-color: #e5e7eb; overflow: hidden; }
   .progress > div { height: 100%; transition: width 0.3s ease; }
   table th, table td { padding: 0.5rem; }
   .call-title { font-size: 1.5rem; font-weight: 800; text-align: center; margin-bottom: 0.75rem; color: #111827; }
   .call-btn { display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; min-height: 72px; padding: 1rem; font-size: 1.25rem; border-radius: 0.75rem; font-weight: 700; text-align: center; margin: 8px 0; border: 2px solid transparent; color: #111827; box-shadow: 0 1px 0 rgba(0,0,0,0.06); }
   .call-timer { font-size: 2.5rem; font-weight: 700; color: #1f2937; text-align: center; margin-bottom: 1rem; font-family: monospace; }
   #toastBox { position: fixed; top: 18px; left: 50%; transform: translateX(-50%); z-index: 10001; display: flex; flex-direction: column; gap: 8px; }
   .toast { background: rgba(17,24,39,0.95); color: #fff; padding: 10px 14px; border-radius: 10px; font-weight: 700; letter-spacing: 0.2px; box-shadow: 0 4px 20px rgba(0,0,0,.2); display: inline-flex; align-items: center; gap: 8px; }
   #breakOverlay { position: fixed; inset: 0; background: rgba(29, 78, 216, 0.9); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; }
   .overlay-title { font-size: clamp(2.5rem, 8vw, 5rem); font-weight: 900; text-shadow: 0 4px 10px rgba(0,0,0,0.3); }
   .overlay-timer { font-size: clamp(4rem, 15vw, 10rem); font-weight: 800; font-family: monospace; letter-spacing: -2px; margin: 1rem 0; text-shadow: 0 4px 10px rgba(0,0,0,0.3); }
   .overlay-btn { background: #f59e0b; color: white; font-size: 1.5rem; font-weight: 800; padding: 1rem 2.5rem; border-radius: 0.75rem; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
   #statusLed { position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%); width: 50%; max-width: 400px; padding: 0.5rem; text-align: center; font-weight: 800; color: white; z-index: 45; border-radius: 0.75rem; }
   .led-checked-in { background-color: #22c55e; box-shadow: 0 0 18px rgba(34, 197, 94, 0.8); transition: background-color 0.3s ease, box-shadow 0.3s ease; }
   .led-checked-out { background-color: #ef4444; box-shadow: 0 0 18px rgba(239, 68, 68, 0.8); transition: background-color 0.3s ease, box-shadow 0.3s ease; }
   .led-on-break { background-color: #3b82f6; box-shadow: 0 0 18px rgba(59, 130, 246, 0.8); }
   .hotel-building { fill: #334155; stroke: #1f2937; stroke-width: 2; }
   .hotel-base { fill: #1f2937; }
   .hotel-window, .hotel-window-large { fill: #1f2937; stroke: #0f172a; stroke-width: 1; rx: 2; ry: 2; transition: fill .3s ease; }
   .hotel-window.lit, .hotel-window-large.lit, .hotel-lamp.lit { fill: #fde047; filter: drop-shadow(0 0 6px rgba(251, 191, 36, 0.7)); }
   .hotel-lamp { fill: #475569; transition: fill .3s ease; }
   .performance-log-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; }
   .performance-day { padding: 0.75rem; border-radius: 0.5rem; border: 1px solid; }
   .status-badge { padding: 0.125rem 0.5rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; }
   .status-pending { background-color: #dcfce7; color: #166534; }
   .status-cancelled { background-color: #fee2e2; color: #991b1b; }
   .glow { box-shadow: 0 10px 30px rgba(59,130,246,0.35), inset 0 0 30px rgba(255,255,255,0.12); }
   .pulseSoft { animation: pulseSoft 1.2s ease-in-out infinite alternate; }
   @keyframes pulseSoft { from { transform: scale(1); } to { transform: scale(1.03); } }
   .blink { animation: blink 0.9s linear infinite alternate; }
   @keyframes blink { from { opacity: 1; } to { opacity: .4; } }
   @keyframes christmas-blink { 0%, 100% { fill: #ef4444; filter: drop-shadow(0 0 5px #ef4444); } 25% { fill: #22c55e; filter: drop-shadow(0 0 5px #22c55e); } 50% { fill: #3b82f6; filter: drop-shadow(0 0 5px #3b82f6); } 75% { fill: #fde047; filter: drop-shadow(0 0 5px #fde047); } }
   .christmas-light { animation: christmas-blink 3s infinite; }
   @keyframes snow-fall { 0% { transform: translateY(-20px); opacity: 0; } 10% { opacity: 1; } 100% { transform: translateY(350px); opacity: 0; } }
   .falling-snow { animation: snow-fall 10s linear infinite; }
   @keyframes pumpkin-flicker { 0%, 100% { opacity: 0.8; } 50% { opacity: 1; } }
   .pumpkin-glow { animation: pumpkin-flicker 2s ease-in-out infinite; filter: drop-shadow(0 0 8px #f97316); }
   @keyframes bat-flutter { 0%, 100% { transform: translate(0, 0) scaleX(1); } 25% { transform: translate(10px, -10px) scaleX(-1); } 50% { transform: translate(-10px, 0) scaleX(1); } 75% { transform: translate(0, 10px) scaleX(-1); } }
   .bat { animation: bat-flutter 1s ease-in-out infinite; }
   @keyframes firework-pop { 0% { transform: scale(0.1); opacity: 0; } 50% { opacity: 1; } 100% { transform: scale(1); opacity: 0; } }
   .firework-pop { animation: firework-pop 2s ease-out infinite; transform-origin: center; }
   @keyframes leaf-fall { 0% { transform: translateY(-20px) rotate(0deg); opacity: 0; } 10% { opacity: 1; } 100% { transform: translateY(350px) rotate(360deg); opacity: 0; } }
   .falling-leaf { animation: leaf-fall 8s linear infinite; }
   @keyframes heart-beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
   .beating-heart { animation: heart-beat 1s ease-in-out infinite; transform-origin: center; }
   @keyframes confetti-fall { 0% { transform: translateY(-20px); opacity: 1; } 100% { transform: translateY(350px) rotate(720deg); opacity: 0; } }
   .falling-confetti { animation: confetti-fall 5s linear infinite; }
   .quote-modal-bg { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 10000; transition: opacity 0.3s ease; background: transparent; }
   .quote-modal-bg.active { display: flex; }
   .quote-modal-content { text-align: center; padding: 2rem; max-width: 90%; width: 800px; border-radius: 1rem; }
   .quote-text { font-size: clamp(1.5rem, 5vw, 3.5rem); font-weight: 700; margin-bottom: 1rem; }
   .quote-author { font-size: clamp(1rem, 3vw, 1.5rem); font-style: italic; opacity: 0.8; }
   .quote-close-btn { position: absolute; top: 1.5rem; right: 1.5rem; background: rgba(255,255,255,0.2); color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: bold; border: 1px solid rgba(255,255,255,0.3); cursor: pointer;}
   .quote-style-black-gold { background-color: #111827; color: #fde047; text-shadow: 0 2px 10px rgba(250, 204, 21, 0.3); }
   .quote-style-minimalist { background-color: #f9fafb; color: #1f2937; }
   .quote-style-blueprint { background-color: #3b82f6; color: #fff; font-family: monospace; }
   .quote-style-vintage { background-color: #fdf6e3; color: #586e75; font-family: serif; }
   .ambient-quote { transition: opacity 0.7s ease; }
   .ambient-quote.fade-out { opacity: 0; }
   body.sky-day { background: linear-gradient(to bottom, #87CEEB, #fce7f3); }
   body.sky-dawn { background: linear-gradient(to bottom, #f3a683, #fce7f3); }
   body.sky-dusk { background: linear-gradient(to bottom, #483475, #fce7f3); }
   body.sky-night { background: linear-gradient(to bottom, #0c0a18, #1e1b32); }
   #starryNight { position: fixed; top:0; left:0; width:100%; height:100%; z-index:0; pointer-events: none; }
   .star { position: absolute; background: white; border-radius: 50%; animation: twinkle 3s infinite alternate; }
   @keyframes twinkle { 0% { opacity: 0.5; } 100% { opacity: 1; } }
   #sky-elements { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; overflow: hidden; }
   .sky-object { position: absolute; transition: opacity 2s ease, transform 1s ease; }
   #sun { top: 15%; left: -50px; width: 100px; height: 100px; background: #fde047; border-radius: 50%; box-shadow: 0 0 30px #fde047; animation: sun-path 60s linear infinite; }
   #moon { top: 20%; left: -50px; width: 80px; height: 80px; background: #f7fafc; border-radius: 50%; box-shadow: 0 0 20px #e2e8f0; animation: moon-path 60s linear infinite; }
   #lighthouseBeam-container { position: absolute; top: 50%; left: 13.5%; width: 200px; height: 200px; display: none; transform: translateY(-50%) translateX(-50%); }
   #lighthouseBeam { width: 100%; height: 100%; transform-origin: center center; background: radial-gradient(ellipse at center, rgba(253, 224, 71, 0.2) 0%, rgba(253, 224, 71, 0) 40%); animation: rotate-beam 10s linear infinite; }
   @keyframes sun-path { 0% { transform: translateX(0vw) translateY(20vh); } 50% { transform: translateX(50vw) translateY(0vh); } 100% { transform: translateX(100vw) translateY(20vh); } }
   @keyframes moon-path { 0% { transform: translateX(0vw) translateY(10vh); } 50% { transform: translateX(50vw) translateY(0vh); } 100% { transform: translateX(100vw) translateY(10vh); } }
   @keyframes rotate-beam { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
   .scale-in { animation: scale-in 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; }
   @keyframes scale-in { 0% { transform: scale(0); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
 </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.mx-auto{margin-left:auto;margin-right:auto}.my-2{margin-top:0.5rem;margin-bottom:0.5rem}.mb-1{margin-bottom:0.25rem}.mb-2{margin-bottom:0.5rem}.mb-3{margin-bottom:0.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mt-1{margin-top:0.25rem}.mt-2{margin-top:0.5rem}.mt-3{margin-top:0.75rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.mr-1{margin-right:0.25rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-24{height:6rem}.h-4{height:1rem}.h-5{height:1.25rem}.min-h-0{min-height:0px}.min-h-\[4rem\]{min-height:4rem}.min-h-screen{min-height:100vh}.w-1\/2{width:50%}.w-24{width:6rem}.w-4{width:1rem}.w-full{width:100%}.w-5{width:1.25rem}.max-w-6xl{max-width:72rem}.flex-1{flex:1 1 0%}.flex-shrink-0{flex-shrink:0}.shrink-0{flex-shrink:0}.flex-grow{flex-grow:1}.cursor-pointer{cursor:pointer}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-end{align-items:flex-end}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.gap-4{gap:1rem}.gap-5{gap:1.25rem}.gap-6{gap:1.5rem}.space-y-2 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.5rem * var(--tw-space-y-reverse))}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.rounded{border-radius:0.25rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-xl{border-radius:0.75rem}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-t{border-top-width:1px}.border-gray-200{--tw-border-opacity:1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1))}.border-indigo-200{--tw-border-opacity:1;border-color:rgb(199 210 254 / var(--tw-border-opacity, 1))}.border-slate-200{--tw-border-opacity:1;border-color:rgb(226 232 240 / var(--tw-border-opacity, 1))}.border-yellow-200{--tw-border-opacity:1;border-color:rgb(254 240 138 / var(--tw-border-opacity, 1))}.border-red-200{--tw-border-opacity:1;border-color:rgb(254 202 202 / var(--tw-border-opacity, 1))}.bg-blue-100{--tw-bg-opacity:1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.bg-cyan-100{--tw-bg-opacity:1;background-color:rgb(207 250 254 / var(--tw-bg-opacity, 1))}.bg-green-100{--tw-bg-opacity:1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1))}.bg-green-500{--tw-bg-opacity:1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.bg-indigo-100{--tw-bg-opacity:1;background-color:rgb(224 231 255 / var(--tw-bg-opacity, 1))}.bg-indigo-200{--tw-bg-opacity:1;background-color:rgb(199 210 254 / var(--tw-bg-opacity, 1))}.bg-indigo-400{--tw-bg-opacity:1;background-color:rgb(129 140 248 / var(--tw-bg-opacity, 1))}.bg-orange-100{--tw-bg-opacity:1;background-color:rgb(255 237 213 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-white\/70{background-color:rgb(255 255 255 / 0.7)}.bg-red-100{--tw-bg-opacity:1;background-color:rgb(254 226 226 / var(--tw-bg-opacity, 1))}.bg-red-500{--tw-bg-opacity:1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.bg-yellow-500{--tw-bg-opacity:1;background-color:rgb(234 179 8 / var(--tw-bg-opacity, 1))}.p-2{padding:0.5rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-1{padding:0.25rem}.px-2{padding-left:0.5rem;padding-right:0.5rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.py-1{padding-top:0.25rem;padding-bottom:0.25rem}.py-1\.5{padding-top:0.375rem;padding-bottom:0.375rem}.py-10{padding-top:2.5rem;padding-bottom:2.5rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.pb-16{padding-bottom:4rem}.pt-4{padding-top:1rem}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-5xl{font-size:3rem;line-height:1}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-black{font-weight:900}.font-bold{font-weight:700}.font-extrabold{font-weight:800}.font-medium{font-weight:500}.font-semibold{font-weight:600}.italic{font-style:italic}.leading-tight{line-height:1.25}.text-amber-600{--tw-text-opacity:1;color:rgb(217 119 6 / var(--tw-text-opacity, 1))}.text-blue-600{--tw-text-opacity:1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-cyan-600{--tw-text-opacity:1;color:rgb(8 145 178 / var(--tw-text-opacity, 1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity, 1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99 / var(--tw-text-opacity, 1))}.text-gray-700{--tw-text-opacity:1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55 / var(--tw-text-opacity, 1))}.text-gray-900{--tw-text-opacity:1;color:rgb(17 24 39 / var(--tw-text-opacity, 1))}.text-green-500{--tw-text-opacity:1;color:rgb(34 197 94 / var(--tw-text-opacity, 1))}.text-green-600{--tw-text-opacity:1;color:rgb(22 163 74 / var(--tw-text-opacity, 1))}.text-green-700{--tw-text-opacity:1;color:rgb(21 128 61 / var(--tw-text-opacity, 1))}.text-indigo-800{--tw-text-opacity:1;color:rgb(55 48 163 / var(--tw-text-opacity, 1))}.text-orange-600{--tw-text-opacity:1;color:rgb(234 88 12 / var(--tw-text-opacity, 1))}.text-pink-600{--tw-text-opacity:1;color:rgb(219 39 119 / var(--tw-text-opacity, 1))}.text-purple-600{--tw-text-opacity:1;color:rgb(147 51 234 / var(--tw-text-opacity, 1))}.text-red-600{--tw-text-opacity:1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.text-sky-600{--tw-text-opacity:1;color:rgb(2 132 199 / var(--tw-text-opacity, 1))}.text-slate-500{--tw-text-opacity:1;color:rgb(100 116 139 / var(--tw-text-opacity, 1))}.text-slate-600{--tw-text-opacity:1;color:rgb(71 85 105 / var(--tw-text-opacity, 1))}.text-slate-700{--tw-text-opacity:1;color:rgb(51 65 85 / var(--tw-text-opacity, 1))}.text-slate-800{--tw-text-opacity:1;color:rgb(30 41 59 / var(--tw-text-opacity, 1))}.text-slate-900{--tw-text-opacity:1;color:rgb(15 23 42 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.opacity-0{opacity:0}.ring-2{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.ring-teal-300{--tw-ring-opacity:1;--tw-ring-color:rgb(94 234 212 / var(--tw-ring-opacity, 1))}.hover\:text-red-500:hover{--tw-text-opacity:1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}@media (min-width: 640px){.sm\:mt-2{margin-top:0.5rem}.sm\:text-5xl{font-size:3rem;line-height:1}.sm\:text-sm{font-size:0.875rem;line-height:1.25rem}}@media (min-width: 768px){.md\:col-span-2{grid-column:span 2 / span 2}.md\:block{display:block}.md\:w-1\/3{width:33.333333%}.md\:w-2\/3{width:66.666667%}.md\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.md\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}.md\:grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}.md\:grid-cols-5{grid-template-columns:repeat(5, minmax(0, 1fr))}.md\:grid-cols-6{grid-template-columns:repeat(6, minmax(0, 1fr))}.md\:flex-row{flex-direction:row}.md\:border-r{border-right-width:1px}.md\:border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.md\:pr-6{padding-right:1.5rem}.md\:text-3xl{font-size:1.875rem;line-height:2.25rem}.md\:text-5xl{font-size:3rem;line-height:1}.md\:text-6xl{font-size:3.75rem;line-height:1}.md\:text-sm{font-size:0.875rem;line-height:1.25rem}}@media (min-width: 1024px){.lg\:col-span-2{grid-column:span 2 / span 2}.lg\:grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}}@media (min-width: 1280px){.xl\:text-7xl{font-size:4.5rem;line-height:1}}</style><style id="googleidentityservice_button_styles">.qJTHM{-webkit-user-select:none;color:#202124;direction:ltr;-webkit-touch-callout:none;font-family:"Roboto-Regular",arial,sans-serif;-webkit-font-smoothing:antialiased;font-weight:400;margin:0;overflow:hidden;-webkit-text-size-adjust:100%}.ynRLnc{left:-9999px;position:absolute;top:-9999px}.L6cTce{display:none}.bltWBb{overflow-wrap:break-word;word-break:break-word}.hSRGPd{color:#1a73e8;cursor:pointer;font-weight:500;text-decoration:none}.Bz112c-W3lGp{height:16px;width:16px}.Bz112c-E3DyYd{height:20px;width:20px}.Bz112c-r9oPif{height:24px;width:24px}.Bz112c-u2z5K{height:36px;width:36px}.Bz112c-uaxL4e{-webkit-border-radius:10px;border-radius:10px}.LgbsSe-Bz112c{display:block}.S9gUrf-YoZ4jf,.S9gUrf-YoZ4jf *{border:none;margin:0;padding:0}.fFW7wc-ibnC6b>.aZ2wEe>div{border-color:#4285f4}.P1ekSe-ZMv3u{-webkit-transition:height linear 200ms;-webkit-transition:height linear 200ms;transition:height linear 200ms}.P1ekSe-ZMv3u>div:nth-child(1){background-color:#1a73e8!important;-webkit-transition:width linear 300ms;-webkit-transition:width linear 300ms;transition:width linear 300ms}.P1ekSe-ZMv3u>div:nth-child(2),.P1ekSe-ZMv3u>div:nth-child(3){background-image:linear-gradient(to right,rgba(255,255,255,.7),rgba(255,255,255,.7)),linear-gradient(to right,#1a73e8,#1a73e8)!important}.haAclf{display:inline-block}.nsm7Bb-HzV7m-LgbsSe{border-radius:4px;box-sizing:border-box;-webkit-transition:background-color 0.218s,border-color 0.218s;transition:background-color 0.218s,border-color 0.218s;-webkit-user-select:none;-webkit-appearance:none;background-color:#fff;background-image:none;border:1px solid #dadce0;color:#3c4043;cursor:pointer;font-family:"Google Sans",arial,sans-serif;font-size:14px;height:40px;letter-spacing:0.25px;outline:none;overflow:hidden;padding:0 12px;position:relative;text-align:center;vertical-align:middle;white-space:nowrap;width:auto}@media screen and (-ms-high-contrast:active){.nsm7Bb-HzV7m-LgbsSe{border:2px solid windowText;color:windowText}}@media screen and (preferes-contrast:more){.nsm7Bb-HzV7m-LgbsSe{color:#000}}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe{font-size:14px;height:32px;letter-spacing:0.25px;padding:0 10px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe{font-size:11px;height:20px;letter-spacing:0.3px;padding:0 8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe{padding:0;width:40px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe{width:32px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe{width:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK{border-radius:20px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.pSzOP-SxQuSe{border-radius:16px}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK.purZT-SxQuSe{border-radius:10px}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc{border:none;color:#fff}.nsm7Bb-HzV7m-LgbsSe.MFS4be-v3pZbf-Ia7Qfc{background-color:#1a73e8}.nsm7Bb-HzV7m-LgbsSe.MFS4be-JaPV2b-Ia7Qfc{background-color:#202124;color:#e8eaed}@media screen and (prefers-contrast:more){.nsm7Bb-HzV7m-LgbsSe.MFS4be-JaPV2b-Ia7Qfc{color:#fff}}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:18px;margin-right:8px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:14px;min-width:14px;width:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{height:10px;min-width:10px;width:10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin-left:8px;margin-right:-4px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:10px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:8px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c{padding:4px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-top-left-radius:3px;border-bottom-left-radius:3px;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center;background-color:#fff;height:36px;margin-left:-10px;margin-right:12px;min-width:36px;width:36px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c,.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf .nsm7Bb-HzV7m-LgbsSe-Bz112c{margin:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:28px;margin-left:-8px;margin-right:10px;min-width:28px;width:28px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{height:16px;margin-left:-6px;margin-right:8px;min-width:16px;width:16px}.nsm7Bb-HzV7m-LgbsSe.Bz112c-LgbsSe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:3px;margin-left:2px;margin-right:0;padding:0}.nsm7Bb-HzV7m-LgbsSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:18px}.nsm7Bb-HzV7m-LgbsSe.pSzOP-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:14px}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:8px}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-bN97Pc-sM5MNb{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-align-items:center;-webkit-box-align:center;align-items:center;-webkit-flex-direction:row;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:row;-webkit-box-pack:space-between;-webkit-justify-content:space-between;justify-content:space-between;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;height:100%;position:relative;width:100%}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX{-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{-webkit-flex-grow:1;-webkit-box-flex:1;flex-grow:1;font-family:"Google Sans",arial,sans-serif;font-weight:500;overflow:hidden;text-overflow:ellipsis;vertical-align:top}.nsm7Bb-HzV7m-LgbsSe.purZT-SxQuSe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-weight:300}.nsm7Bb-HzV7m-LgbsSe .oXtfBe-l4eHX .nsm7Bb-HzV7m-LgbsSe-BPrWId{-webkit-flex-grow:0;-webkit-box-flex:0;flex-grow:0}.nsm7Bb-HzV7m-LgbsSe .nsm7Bb-HzV7m-LgbsSe-MJoBVe{-webkit-transition:background-color 0.218s;transition:background-color 0.218s;bottom:0;left:0;position:absolute;right:0;top:0}.nsm7Bb-HzV7m-LgbsSe:hover,.nsm7Bb-HzV7m-LgbsSe:focus{box-shadow:none;border-color:#d2e3fc;outline:none}.nsm7Bb-HzV7m-LgbsSe:focus-within{outline:2px solid #00639b;border-color:transparent}.nsm7Bb-HzV7m-LgbsSe:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.08)}.nsm7Bb-HzV7m-LgbsSe:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(66,133,244,.1)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:hover .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.24)}.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:active .nsm7Bb-HzV7m-LgbsSe-MJoBVe,.nsm7Bb-HzV7m-LgbsSe.MFS4be-Ia7Qfc:focus .nsm7Bb-HzV7m-LgbsSe-MJoBVe{background:rgba(255,255,255,.32)}.nsm7Bb-HzV7m-LgbsSe .n1UuX-DkfjY{border-radius:50%;display:-webkit-box;display:-webkit-flex;display:flex;height:20px;margin-left:-4px;margin-right:8px;min-width:20px;width:20px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId{font-family:"Roboto";font-size:12px;text-align:left}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .ssJRIf,.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .fmcmS{overflow:hidden;text-overflow:ellipsis}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-align-items:center;-webkit-box-align:center;align-items:center;color:#5f6368;fill:#5f6368;font-size:11px;font-weight:400}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.MFS4be-Ia7Qfc .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{color:#e8eaed;fill:#e8eaed}@media screen and (prefers-contrast:more){.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff,.nsm7Bb-HzV7m-LgbsSe.jVeSEe.MFS4be-Ia7Qfc .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff{color:#000;fill:#000}}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-BPrWId .K4efff .Bz112c{height:18px;margin:-3px -3px -3px 2px;min-width:18px;width:18px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-top-left-radius:0;border-bottom-left-radius:0;border-top-right-radius:3px;border-bottom-right-radius:3px;margin-left:12px;margin-right:-10px}.nsm7Bb-HzV7m-LgbsSe.jVeSEe.JGcpL-RbRzK .nsm7Bb-HzV7m-LgbsSe-Bz112c-haAclf{border-radius:18px}.L5Fo6c-sM5MNb{border:0;display:block;left:0;position:relative;top:0}.L5Fo6c-bF1uUb{-webkit-border-radius:4px;border-radius:4px;bottom:0;cursor:pointer;left:0;position:absolute;right:0;top:0}.L5Fo6c-bF1uUb:focus{border:none;outline:none}sentinel{}</style><style id="all-sections-spacing">
  /* Air between every major section card */
  .section.card { margin-bottom: 2rem; }           /* desktop gap */
  @media (max-width: 768px) {
    .section.card { margin-bottom: 1.5rem; }       /* mobile gap */
  }
  .section.card:last-of-type { margin-bottom: 0; } /* no extra at end */
</style>
<style id="section-gap">
  /* Additional spacing if cards aren't using .section */
  .section.card + .section.card { margin-top: 2rem; }
  .card + .card { margin-top: 2rem; }
  @media (max-width: 768px) {
    .section.card + .section.card { margin-top: 1.5rem; }
    .card + .card { margin-top: 1.5rem; }
  }
</style>
<style id="section-gap-override">
  :is(.section.card, .card) + :is(.section.card, .card) { margin-top: 2rem !important; }
  @media (max-width: 768px) {
    :is(.section.card, .card) + :is(.section.card, .card) { margin-top: 1.5rem !important; }
  }
</style>
<style id="card-air">
  /* Force visual air between top-level section cards */
  :is(.section.card, .card) + :is(.section.card, .card) { margin-top: 2rem !important; }
  @media (max-width: 768px) {
    :is(.section.card, .card) + :is(.section.card, .card) { margin-top: 1.5rem !important; }
  }
</style>
<style id="card-air">
  :is(.section.card, .card) + :is(.section.card, .card) { margin-top: 2rem !important; }
  @media (max-width: 768px){
    :is(.section.card, .card) + :is(.section.card, .card) { margin-top: 1.5rem !important; }
  }
</style>
<style id="section-spacing-fix">
  .section.card + .section.card, .card + .card { margin-top: 26px !important; }
</style>
<style id="op-grid-cols">
  .op-grid { display:grid; grid-template-columns: repeat(1, minmax(0,1fr)); gap: 1rem; align-items:stretch; }
  @media (min-width: 768px) {
    .op-grid { grid-template-columns: repeat(5, minmax(0,1fr)); }
  }
  .op-grid > * { height: 100%; }
</style>
<script async="" defer="" onerror="gapiLoadError(event)" onload="gapiLoaded()" src="https://apis.google.com/js/api.js"></script>
<script async="" defer="" onerror="gisLoadError(event)" onload="gisLoaded()" src="https://accounts.google.com/gsi/client"></script>
</head>
<body class="ken-burns-active sky-night">
<div id="background-container">
<div id="starryNight"><div class="star" style="width: 2.87976px; height: 2.87976px; top: 17.9119%; left: 29.3107%; animation-delay: 2.86721s;"></div><div class="star" style="width: 1.15689px; height: 1.15689px; top: 56.5348%; left: 61.0496%; animation-delay: 0.585046s;"></div><div class="star" style="width: 2.09121px; height: 2.09121px; top: 42.3767%; left: 66.2034%; animation-delay: 1.64489s;"></div><div class="star" style="width: 2.60271px; height: 2.60271px; top: 73.8886%; left: 74.315%; animation-delay: 0.547779s;"></div><div class="star" style="width: 1.88691px; height: 1.88691px; top: 1.65189%; left: 94.9799%; animation-delay: 2.88678s;"></div><div class="star" style="width: 2.94829px; height: 2.94829px; top: 43.2485%; left: 18.789%; animation-delay: 1.7028s;"></div><div class="star" style="width: 2.12236px; height: 2.12236px; top: 59.5803%; left: 27.0611%; animation-delay: 1.8322s;"></div><div class="star" style="width: 2.23108px; height: 2.23108px; top: 14.5039%; left: 53.521%; animation-delay: 2.72279s;"></div><div class="star" style="width: 1.36074px; height: 1.36074px; top: 77.1571%; left: 66.4802%; animation-delay: 0.00475768s;"></div><div class="star" style="width: 1.5862px; height: 1.5862px; top: 51.6391%; left: 29.7017%; animation-delay: 1.79658s;"></div><div class="star" style="width: 2.25357px; height: 2.25357px; top: 76.9981%; left: 25.426%; animation-delay: 1.51959s;"></div><div class="star" style="width: 2.42448px; height: 2.42448px; top: 31.7445%; left: 54.2506%; animation-delay: 0.589905s;"></div><div class="star" style="width: 2.03594px; height: 2.03594px; top: 66.9713%; left: 84.7096%; animation-delay: 2.48366s;"></div><div class="star" style="width: 1.85473px; height: 1.85473px; top: 6.32991%; left: 68.9717%; animation-delay: 1.49024s;"></div><div class="star" style="width: 1.01673px; height: 1.01673px; top: 46.1993%; left: 57.18%; animation-delay: 1.88424s;"></div><div class="star" style="width: 2.66395px; height: 2.66395px; top: 27.7483%; left: 97.2636%; animation-delay: 0.973552s;"></div><div class="star" style="width: 1.57389px; height: 1.57389px; top: 89.8069%; left: 75.2666%; animation-delay: 2.68096s;"></div><div class="star" style="width: 2.76119px; height: 2.76119px; top: 24.4576%; left: 14.7812%; animation-delay: 1.39497s;"></div><div class="star" style="width: 2.8826px; height: 2.8826px; top: 96.1344%; left: 83.879%; animation-delay: 0.90276s;"></div><div class="star" style="width: 1.45401px; height: 1.45401px; top: 59.7419%; left: 40.3589%; animation-delay: 1.09166s;"></div><div class="star" style="width: 2.17774px; height: 2.17774px; top: 78.1286%; left: 46.7055%; animation-delay: 1.67255s;"></div><div class="star" style="width: 1.68022px; height: 1.68022px; top: 32.9728%; left: 63.1897%; animation-delay: 1.70888s;"></div><div class="star" style="width: 2.77905px; height: 2.77905px; top: 90.9873%; left: 21.4788%; animation-delay: 0.409934s;"></div><div class="star" style="width: 2.46004px; height: 2.46004px; top: 34.9408%; left: 46.2541%; animation-delay: 2.22386s;"></div><div class="star" style="width: 1.56201px; height: 1.56201px; top: 59.5627%; left: 5.70976%; animation-delay: 0.806813s;"></div><div class="star" style="width: 2.72273px; height: 2.72273px; top: 7.97983%; left: 23.8623%; animation-delay: 2.27201s;"></div><div class="star" style="width: 2.49681px; height: 2.49681px; top: 69.5031%; left: 21.2642%; animation-delay: 2.12021s;"></div><div class="star" style="width: 2.56801px; height: 2.56801px; top: 39.6122%; left: 12.4213%; animation-delay: 0.182671s;"></div><div class="star" style="width: 1.45855px; height: 1.45855px; top: 59.5453%; left: 97.1818%; animation-delay: 1.75635s;"></div><div class="star" style="width: 1.5178px; height: 1.5178px; top: 55.9325%; left: 5.93362%; animation-delay: 2.30236s;"></div><div class="star" style="width: 1.41208px; height: 1.41208px; top: 13.6712%; left: 71.0102%; animation-delay: 2.70872s;"></div><div class="star" style="width: 1.84858px; height: 1.84858px; top: 63.2476%; left: 50.9042%; animation-delay: 0.33011s;"></div><div class="star" style="width: 1.93542px; height: 1.93542px; top: 18.3212%; left: 12.0991%; animation-delay: 0.463955s;"></div><div class="star" style="width: 1.8298px; height: 1.8298px; top: 71.5898%; left: 91.7976%; animation-delay: 1.09686s;"></div><div class="star" style="width: 2.31438px; height: 2.31438px; top: 78.9152%; left: 20.2075%; animation-delay: 1.72583s;"></div><div class="star" style="width: 1.174px; height: 1.174px; top: 28.4974%; left: 65.1261%; animation-delay: 2.01128s;"></div><div class="star" style="width: 1.72748px; height: 1.72748px; top: 50.7296%; left: 61.238%; animation-delay: 2.31003s;"></div><div class="star" style="width: 2.20384px; height: 2.20384px; top: 37.7512%; left: 78.0456%; animation-delay: 2.40772s;"></div><div class="star" style="width: 1.68447px; height: 1.68447px; top: 17.8137%; left: 61.7392%; animation-delay: 1.64023s;"></div><div class="star" style="width: 2.13663px; height: 2.13663px; top: 96.9514%; left: 72.2098%; animation-delay: 1.98056s;"></div><div class="star" style="width: 1.53759px; height: 1.53759px; top: 82.496%; left: 61.2498%; animation-delay: 0.955749s;"></div><div class="star" style="width: 1.56537px; height: 1.56537px; top: 58.6338%; left: 34.1351%; animation-delay: 2.65024s;"></div><div class="star" style="width: 2.68208px; height: 2.68208px; top: 69.5468%; left: 84.5757%; animation-delay: 0.969187s;"></div><div class="star" style="width: 2.74741px; height: 2.74741px; top: 72.8745%; left: 34.7354%; animation-delay: 2.24125s;"></div><div class="star" style="width: 1.71541px; height: 1.71541px; top: 83.0382%; left: 73.3213%; animation-delay: 2.9829s;"></div><div class="star" style="width: 1.02594px; height: 1.02594px; top: 34.896%; left: 4.5702%; animation-delay: 1.08363s;"></div><div class="star" style="width: 2.18679px; height: 2.18679px; top: 19.1288%; left: 73.6527%; animation-delay: 2.03794s;"></div><div class="star" style="width: 2.52941px; height: 2.52941px; top: 76.2724%; left: 19.6539%; animation-delay: 2.47267s;"></div><div class="star" style="width: 1.73335px; height: 1.73335px; top: 77.4102%; left: 56.2575%; animation-delay: 1.59947s;"></div><div class="star" style="width: 1.64718px; height: 1.64718px; top: 0.0595432%; left: 29.7738%; animation-delay: 1.7163s;"></div><div class="star" style="width: 2.8052px; height: 2.8052px; top: 8.05461%; left: 19.8338%; animation-delay: 1.50558s;"></div><div class="star" style="width: 1.43286px; height: 1.43286px; top: 81.4967%; left: 73.203%; animation-delay: 0.516481s;"></div><div class="star" style="width: 1.78186px; height: 1.78186px; top: 86.7767%; left: 0.427815%; animation-delay: 0.685977s;"></div><div class="star" style="width: 2.92101px; height: 2.92101px; top: 9.5265%; left: 82.6488%; animation-delay: 2.58946s;"></div><div class="star" style="width: 2.34001px; height: 2.34001px; top: 64.4776%; left: 3.56208%; animation-delay: 2.66236s;"></div><div class="star" style="width: 1.37615px; height: 1.37615px; top: 45.149%; left: 21.6007%; animation-delay: 2.97007s;"></div><div class="star" style="width: 1.3606px; height: 1.3606px; top: 70.0419%; left: 29.2852%; animation-delay: 1.78171s;"></div><div class="star" style="width: 2.4198px; height: 2.4198px; top: 39.1769%; left: 35.9437%; animation-delay: 0.743655s;"></div><div class="star" style="width: 1.04787px; height: 1.04787px; top: 10.2312%; left: 23.7664%; animation-delay: 2.43121s;"></div><div class="star" style="width: 1.69417px; height: 1.69417px; top: 86.003%; left: 30.1069%; animation-delay: 2.96132s;"></div><div class="star" style="width: 2.13778px; height: 2.13778px; top: 14.12%; left: 42.379%; animation-delay: 0.381798s;"></div><div class="star" style="width: 2.52766px; height: 2.52766px; top: 47.678%; left: 61.3599%; animation-delay: 2.13656s;"></div><div class="star" style="width: 1.50519px; height: 1.50519px; top: 88.3291%; left: 92.2331%; animation-delay: 1.88504s;"></div><div class="star" style="width: 1.55306px; height: 1.55306px; top: 20.4149%; left: 91.4373%; animation-delay: 1.1322s;"></div><div class="star" style="width: 2.57089px; height: 2.57089px; top: 19.833%; left: 39.3661%; animation-delay: 0.421104s;"></div><div class="star" style="width: 1.96749px; height: 1.96749px; top: 83.4645%; left: 11.3194%; animation-delay: 0.000446958s;"></div><div class="star" style="width: 2.08443px; height: 2.08443px; top: 40.455%; left: 73.5253%; animation-delay: 0.488965s;"></div><div class="star" style="width: 1.95692px; height: 1.95692px; top: 88.9526%; left: 27.6767%; animation-delay: 0.0958452s;"></div><div class="star" style="width: 1.0177px; height: 1.0177px; top: 85.6273%; left: 61.3146%; animation-delay: 2.71004s;"></div><div class="star" style="width: 1.27546px; height: 1.27546px; top: 9.14552%; left: 55.6684%; animation-delay: 2.42022s;"></div><div class="star" style="width: 2.6317px; height: 2.6317px; top: 30.3413%; left: 13.092%; animation-delay: 2.24402s;"></div><div class="star" style="width: 2.8102px; height: 2.8102px; top: 24.2548%; left: 98.4702%; animation-delay: 2.95633s;"></div><div class="star" style="width: 2.81829px; height: 2.81829px; top: 14.5009%; left: 85.2423%; animation-delay: 1.90647s;"></div><div class="star" style="width: 2.63705px; height: 2.63705px; top: 20.9195%; left: 70.8558%; animation-delay: 2.35392s;"></div><div class="star" style="width: 1.27317px; height: 1.27317px; top: 0.542521%; left: 78.6758%; animation-delay: 2.08502s;"></div><div class="star" style="width: 2.37765px; height: 2.37765px; top: 89.2022%; left: 27.2282%; animation-delay: 0.169046s;"></div><div class="star" style="width: 2.10605px; height: 2.10605px; top: 50.8491%; left: 62.5132%; animation-delay: 2.63173s;"></div><div class="star" style="width: 1.57871px; height: 1.57871px; top: 90.2938%; left: 93.3752%; animation-delay: 2.12317s;"></div><div class="star" style="width: 2.07022px; height: 2.07022px; top: 68.7837%; left: 52.8679%; animation-delay: 2.37178s;"></div><div class="star" style="width: 2.77627px; height: 2.77627px; top: 3.553%; left: 11.395%; animation-delay: 1.05988s;"></div><div class="star" style="width: 2.8063px; height: 2.8063px; top: 45.7579%; left: 97.9108%; animation-delay: 2.72375s;"></div><div class="star" style="width: 1.0521px; height: 1.0521px; top: 58.1407%; left: 41.3993%; animation-delay: 2.79535s;"></div><div class="star" style="width: 1.1898px; height: 1.1898px; top: 73.2252%; left: 26.2976%; animation-delay: 2.82334s;"></div><div class="star" style="width: 2.77719px; height: 2.77719px; top: 16.3747%; left: 90.9705%; animation-delay: 1.51014s;"></div><div class="star" style="width: 1.50117px; height: 1.50117px; top: 38.9443%; left: 48.0513%; animation-delay: 1.9264s;"></div><div class="star" style="width: 2.82738px; height: 2.82738px; top: 41.0463%; left: 47.1047%; animation-delay: 1.17193s;"></div><div class="star" style="width: 1.81577px; height: 1.81577px; top: 59.5731%; left: 21.4766%; animation-delay: 1.66739s;"></div><div class="star" style="width: 2.2019px; height: 2.2019px; top: 85.0654%; left: 82.2564%; animation-delay: 1.67506s;"></div><div class="star" style="width: 2.04921px; height: 2.04921px; top: 89.7366%; left: 25.5702%; animation-delay: 0.7714s;"></div><div class="star" style="width: 2.4279px; height: 2.4279px; top: 31.121%; left: 76.7114%; animation-delay: 1.49088s;"></div><div class="star" style="width: 2.45234px; height: 2.45234px; top: 54.4215%; left: 40.7997%; animation-delay: 1.53714s;"></div><div class="star" style="width: 1.74205px; height: 1.74205px; top: 13.3342%; left: 23.943%; animation-delay: 1.75078s;"></div><div class="star" style="width: 1.00883px; height: 1.00883px; top: 96.9836%; left: 33.4209%; animation-delay: 0.320135s;"></div><div class="star" style="width: 1.12344px; height: 1.12344px; top: 16.0066%; left: 63.3543%; animation-delay: 0.117545s;"></div><div class="star" style="width: 1.71805px; height: 1.71805px; top: 1.062%; left: 16.3278%; animation-delay: 2.27267s;"></div><div class="star" style="width: 2.48751px; height: 2.48751px; top: 66.979%; left: 95.4183%; animation-delay: 0.0105212s;"></div><div class="star" style="width: 1.33361px; height: 1.33361px; top: 57.7239%; left: 47.5775%; animation-delay: 0.70374s;"></div><div class="star" style="width: 1.82446px; height: 1.82446px; top: 86.8585%; left: 28.6677%; animation-delay: 0.449177s;"></div><div class="star" style="width: 1.8804px; height: 1.8804px; top: 0.522188%; left: 46.3983%; animation-delay: 0.356419s;"></div><div class="star" style="width: 1.44039px; height: 1.44039px; top: 44.622%; left: 44.3229%; animation-delay: 2.87355s;"></div></div>
<div id="sky-elements">
<div class="sky-object" id="sun" style="opacity:0;"></div>
<div class="sky-object" id="moon" style="opacity: 1;"></div>
<div id="lighthouseBeam-container" style="display: block;"><div id="lighthouseBeam"></div></div>
</div>
<img alt="" id="background-image" src="file:///C:/Users/Jo/OneDrive/Documents/Servidor%20de%20Pruebas%20de%20Proyectos/index.html"/>
</div>
<div id="toastBox"></div>
<div id="breakOverlay" style="display: none;">
<div class="overlay-title" id="overlayTitle">On Break</div>
<div class="overlay-timer" id="overlayTimer">00:00:00</div>
<button class="overlay-btn" id="endBreakLunchBtn">End</button>
</div>
<div class="led-checked-in" id="statusLed">CHECKED IN</div>
<div class="quote-modal-bg" id="quoteModal">
<div class="quote-modal-content" id="quoteModalContent">
<p class="quote-text" id="quoteText"></p>
<p class="quote-author" id="quoteAuthor"></p>
<button class="btn mt-6" id="quoteContinueBtn" style="background-color: #10b981;">Continue</button>
</div>
<button class="quote-close-btn" id="quoteCloseBtn">Close</button>
</div>
<div class="max-w-6xl mx-auto pb-16 main-content">
<header class="mb-8 p-6 rounded-lg" style="background-color: #e0e7ff;">
<div class="flex items-center justify-between gap-5">
<div class="flex items-center gap-5">
<svg aria-hidden="true" class="shrink-0" height="110" viewbox="0 0 110 110" width="110"><rect class="hotel-building" height="86" rx="6" width="74" x="18" y="12"></rect><rect class="hotel-base" height="8" rx="2" width="86" x="12" y="98"></rect><rect fill="#0f172a" height="20" rx="2" stroke="#0b1220" width="18" x="50" y="78"></rect><circle cx="65" cy="88" fill="#fde047" r="1.2"></circle><rect class="hotel-window lit" height="12" width="16" x="28" y="18"></rect><rect class="hotel-window" height="12" width="16" x="66" y="18"></rect><rect class="hotel-window" height="12" width="16" x="28" y="33"></rect><rect class="hotel-window" height="12" width="16" x="66" y="33"></rect><rect class="hotel-window" height="12" width="16" x="28" y="48"></rect><rect class="hotel-window lit" height="12" width="16" x="66" y="48"></rect><rect class="hotel-window lit" height="12" width="16" x="28" y="63"></rect><rect class="hotel-window lit" height="12" width="16" x="66" y="63"></rect><rect class="hotel-window lit" height="12" width="16" x="28" y="78"></rect><rect class="hotel-window" height="12" width="16" x="66" y="78"></rect></svg>
<div>
<h1 class="font-extrabold leading-tight text-4xl sm:text-5xl md:text-6xl xl:text-7xl" id="appTitle">Hotel Commission Tracker</h1>
<p class="text-gray-600 mt-1 sm:mt-2">Manage reservations and track your commissions</p>
</div>
</div>
<div class="flex flex-col items-end gap-2">
<label class="flex items-center gap-2 text-sm cursor-pointer mt-2">
<input class="w-4 h-4" id="toggleGoalLights" type="checkbox"/>
<span class="font-semibold">Goal Lights Mode</span>
</label>
<p class="text-xs text-gray-600 mt-1">Lights turn on only with sales. 16 sales = full hotel!</p>
<label class="flex items-center gap-2 text-sm cursor-pointer">
<input class="w-4 h-4" id="toggleLights" type="checkbox"/>
<span class="font-semibold">Hotel lights</span>
</label>
<div class="flex items-center gap-2 text-xs">
<span>Fast</span>
<input class="w-24" id="lightsSpeedSlider" max="5.0" min="0.2" step="0.1" type="range" value="1.0"/>
<span>Slow</span>
</div>
<label class="flex items-center gap-2 text-sm cursor-pointer mt-2">
<input class="w-4 h-4" id="toggleLamps" type="checkbox"/>
<span class="font-semibold">Exterior Lamps</span>
</label>
</div>
</div>
</header>
<div class="card mb-8" style="background-color: #f5f3ff;">
<h2 class="text-lg font-bold mb-4">üé® UI Customization</h2>
<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="backgroundSelector">App Background</label>
<select class="w-full border rounded px-2 py-1.5" id="backgroundSelector"><option value="#fce7f3">Default Pink</option><option value="#eff6ff">Soothing Blue</option><option value="#f0fdf4">Mint Green</option><option value="#fefce8">Warm Yellow</option></select>
<label class="block text-sm font-medium text-gray-700 mb-1 mt-3" for="dynamicSkySelector">Dynamic Sky</label>
<select class="w-full border rounded px-2 py-1.5" id="dynamicSkySelector">
<option value="on">On</option>
<option value="off">Off</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1" for="themeSelector">Seasonal Theme</label>
<select class="w-full border rounded px-2 py-1.5" id="themeSelector"><option value="none">None</option><option value="christmas">Christmas</option><option value="new_year">New Year's Eve</option><option value="halloween">Halloween</option><option value="patriotic">Patriotic (USA)</option><option value="muertos">D√≠a de los Muertos / Mex. Ind.</option><option value="autumn">Autumn / Thanksgiving</option><option value="valentines">Valentine's Day</option><option value="stpatricks">St. Patrick's Day</option><option value="spring">Spring</option><option value="summer">Summer</option><option value="cinco_de_mayo">Cinco de Mayo</option><option value="new_year_day">New Year's Day</option></select>
<label class="block text-sm font-medium text-gray-700 mb-1 mt-3" for="bgUpload">Upload Background</label>
<input accept="image/png, image/jpeg" class="w-full text-sm" id="bgUpload" type="file"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Animation Controls</label>
<div class="space-y-2">
<label class="flex items-center gap-2 text-sm cursor-pointer">
<input class="w-4 h-4" id="kenBurnsToggle" type="checkbox"/> Ken Burns Effect
                 </label>
<label class="flex items-center gap-2 text-sm cursor-pointer">
<input class="w-4 h-4" id="sunMoonToggle" type="checkbox"/> Sun/Moon Cycle
                 </label>
<label class="flex items-center gap-2 text-sm cursor-pointer">
<input class="w-4 h-4" id="lighthouseToggle" type="checkbox"/> Lighthouse Beam
                 </label>
</div>
</div>
</div>
</div>
<div class="card mb-8" style="background-color: #fefce8;">
<h2 class="text-lg font-bold mb-4">üß† Mindset &amp; Motivation</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div><h3 class="font-semibold mb-2">Quote Engine</h3><div class="flex gap-2 mb-2"><select class="flex-1 border rounded px-2 py-1.5" id="quoteThemeSelector"><option value="Productivity">Productivity</option></select><select class="flex-1 border rounded px-2 py-1.5" id="quoteStyleSelector"><option value="quote-style-black-gold">Black/Gold</option><option value="quote-style-minimalist">Minimalist</option><option value="quote-style-blueprint">Blueprint</option><option value="quote-style-vintage">Vintage</option></select></div><button class="btn w-full mb-3" id="showQuoteBtn" style="background:#ca8a04">Show Me a Quote</button><label class="flex items-center gap-2 text-sm cursor-pointer"><input class="w-4 h-4" id="autoQuoteToggle" type="checkbox"/> Enable Auto-Quotes (Ambient)</label></div><div><h3 class="font-semibold mb-2">Upload New Quote Theme (.json)</h3><input class="w-full border rounded px-2 py-1.5 mb-2" id="newQuoteThemeName" placeholder="Name your theme (e.g., Stoicism)" type="text"/><label for="quoteFileUpload" class="block text-sm font-medium mb-2">Upload JSON File</label>
<input accept=".json,application/json" class="w-full text-sm mb-2" id="quoteFileUpload" name="quoteFile" type="file"><button class="btn w-full" id="saveQuoteThemeBtn" style="background:#15803d">Upload &amp; Save Theme</button></div></div>
<div class="mt-4 pt-4 border-t border-yellow-200 text-center min-h-[4rem] flex items-center justify-center" id="ambientQuoteContainer"><p class="text-gray-600 italic ambient-quote opacity-0 fade-out" id="ambientQuote"></p></div>
</div>
<div class="card mb-8" style="background-color: #fef3c7;">
<h2 class="text-lg font-semibold mb-4 flex items-center gap-2"><span>‚è±Ô∏è</span> Time Tracker (Real-time)</h2>
<div class="mt-2 mx-auto w-full md:w-1/3 flex flex-col gap-3"><button class="btn w-full" id="checkBtn" style="font-size: 32px; padding: 16px; background-color: rgb(239, 68, 68);">‚ñ† Check Out</button><div class="flex gap-3"><button class="btn w-1/2" id="breakBtn" style="font-size: 16px; padding: 16px; background-color: #60a5fa;">üïí Start Break</button><button class="btn w-1/2" id="lunchBtn" style="font-size: 16px; padding: 16px; background-color: #10b981;">‚òï Start Lunch</button></div></div>
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6"><div class="text-center p-4 rounded-lg bg-blue-100"><div class="text-3xl font-bold text-blue-600 mb-1" id="liveWorkTime">01:15:00</div><div class="text-xs text-gray-700">Live Work Session</div></div><div class="text-center p-4 rounded-lg bg-orange-100"><div class="text-3xl font-bold text-orange-600 mb-1" id="breakTime">00:00:00</div><div class="text-xs text-gray-700">Total Break Time</div></div><div class="text-center p-4 rounded-lg bg-cyan-100"><div class="text-3xl font-bold text-cyan-600 mb-1" id="lunchTime">00:00:00</div><div class="text-xs text-gray-700">Total Lunch Time</div></div><div class="text-center p-4 rounded-lg bg-green-100"><div class="text-3xl font-bold text-green-600 mb-1" id="todayWorkTime">57:32:07</div><div class="text-xs text-gray-700">Today's Work Time</div></div></div>
</div>
<div class="card mb-8 glow" id="spinProgressSection" style="background: linear-gradient(135deg,#dbeafe 0%, #fef3c7 100%);"><div class="flex items-center justify-between gap-3 mb-4"><h2 class="text-2xl md:text-3xl font-extrabold text-slate-800 flex items-center gap-3"><span>üéØ Spin Progress</span><span class="hidden bg-green-500 text-white text-xs md:text-sm font-extrabold px-3 py-1 rounded-full blink" id="spinReadyBadge">SPIN READY</span></h2><div class="text-xs md:text-sm text-slate-700">Regular Spin every 4th sale ¬∑ MEGA Spin every 16th sale</div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div class="p-4 rounded-xl bg-white/70 border border-slate-200 text-center"><div class="text-sm font-semibold text-slate-600">Total Sales</div><div class="text-5xl md:text-6xl font-black text-slate-900" id="spinCurrentSales">1</div></div><div class="p-4 rounded-xl bg-white/70 border border-slate-200"><div class="text-sm font-semibold text-slate-600 mb-1">Next Spin</div><div class="text-4xl md:text-5xl font-black text-blue-600"><span id="spinNextRegular">1/4</span></div><div class="progress mt-3" style="height: 16px; border:1px solid #93c5fd; background:#eff6ff;"><div id="spinRegProgress" style="width: 25%; background: linear-gradient(90deg, rgb(147, 197, 253), rgb(59, 130, 246));"></div></div></div><div class="p-4 rounded-xl bg-white/70 border border-slate-200"><div class="text-sm font-semibold text-slate-600 mb-1">Next MEGA Spin</div><div class="text-4xl md:text-5xl font-black text-amber-600 pulseSoft"><span id="spinNextMega">1/16</span></div><div class="progress mt-3" style="height: 16px; border:1px solid #fbbf24; background:#fffbeb;"><div id="spinMegaProgress" style="width: 6.25%; background: linear-gradient(90deg, rgb(253, 230, 138), rgb(245, 158, 11));"></div></div></div></div></div>
<div class="card mb-8" style="background:#f3e8ff;">
<h2 class="text-lg font-semibold mb-3">Data Tools &amp; Sync</h2>
<div class="flex flex-wrap gap-3 mb-4">
<button class="btn" id="resetCalls" style="background:#06b6d4">Reset Calls</button>
<button class="btn" id="resetSales" style="background:#ef4444">Reset Sales</button>
<button class="btn" id="resetWork" style="background:#f59e0b">Reset All Work</button>
<button class="btn" id="resetSpins" style="background:#9333ea">Reset Wheel Spins</button>
<button class="btn" id="exportAll" style="background:#0ea5e9">‚¨áÔ∏è Export All Activity CSV</button>
</div>
<div class="pt-4 border-t border-gray-200">
<div class="mb-4">
<label class="text-sm font-medium mb-2 block" for="confettiSlider">Celebration Intensity</label>
<div class="flex items-center gap-3">
<span class="text-xs">Subtle</span>
<input class="flex-1" id="confettiSlider" max="2.0" min="0.3" step="0.1" type="range" value="1.0"/>
<span class="text-xs">Party!</span>
</div>
</div>
<div class="p-4 rounded-lg bg-indigo-100 border border-indigo-200">
<h3 class="font-bold mb-2 text-indigo-800">Google Sheets Sync</h3>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
<div>
<label class="text-sm font-medium mb-1 block" for="googleClientIdInput">Google Client ID</label>
<input class="w-full border rounded px-2 py-1.5 text-sm" id="googleClientIdInput" placeholder="Enter your Google Client ID" type="text"/>
</div>
<div>
<label class="text-sm font-medium mb-1 block" for="googleSheetIdInput">Google Spreadsheet ID</label>
<input class="w-full border rounded px-2 py-1.5 text-sm" id="googleSheetIdInput" placeholder="Enter your Spreadsheet ID" type="text"/>
</div>
<div class="md:col-span-2">
<label class="text-sm font-medium mb-1 block" for="googleSheetNameInput">Sheet Name (e.g., Sheet1, Sales)</label>
<input class="w-full border rounded px-2 py-1.5 text-sm" id="googleSheetNameInput" placeholder="Enter the name of the sheet/tab" type="text"/>
</div>
</div>
<div class="flex items-center gap-3 mt-3">
<button class="btn" id="authButton" style="background:#3b82f6">Authorize Google</button>
<button class="btn hidden" id="signoutButton" style="background:#6b7280">Sign Out</button>
<button class="btn" disabled="" id="manualSyncButton" style="background:#10b981">Sync Manually</button>
<span class="text-sm font-semibold text-gray-600" id="googleAuthStatus">Status: Ready to Authorize</span>
</div>
<p class="text-xs text-gray-500 mt-2">Data is synced automatically when a sale is added, cancelled, or deleted. Use manual sync if needed.</p>
</div>
</div>
</div>
<div class="card mb-8" style="background-color: #fecaca;"><h2 class="text-lg font-semibold mb-3 flex items-center gap-2"><span>üìâ</span> Calls Without Sale</h2>
<div class="text-center p-4 rounded-lg" style="background-color: #fee2e2;"><div class="text-3xl font-bold text-red-600 mb-2" id="callsWithoutSale">13</div><div class="text-sm text-gray-700">Consecutive non-sale calls</div></div></div>
<div class="section card mb-8" style="background-color: #fef3c7;">
<h2 class="text-lg font-bold mb-4 flex items-center gap-2">üß† AI &amp; Event Intelligence</h2>
<div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label class="text-sm font-medium mb-1 block" for="apiKeyInput">OpenRouter.ai API Key</label>
<div class="flex gap-2">
<input class="flex-1 w-full border rounded px-2 py-2" id="apiKeyInput" placeholder="API Key is saved" type="password"/>
<button class="btn" id="saveApiKey" style="background:#0ea5e9">Save</button>
</div>
</div>
<div>
<label class="text-sm font-medium mb-1 block" for="predictHQKeyInput">PredictHQ API Key</label>
<div class="flex gap-2">
<input class="flex-1 w-full border rounded px-2 py-2" id="predictHQKeyInput" placeholder="API Key is saved" type="password"/>
<button class="btn" id="savePredictHQKey" style="background:#0ea5e9">Save</button>
</div>
</div> <!-- closes the grid -->
</div> <!-- üëà closes the AI card -->
<div class="card mb-8 mt-6" style="background-color: #e6fffa;">
<div class="flex items-center justify-between mb-4">
<h2 class="text-lg font-semibold flex items-center gap-2"><span>üèÜ</span> This Week's Performance</h2>
<button class="btn" id="resetWeekPerformance" style="background-color:#0284c7">Reset This Week</button>
</div>
<div class="grid grid-cols-1 md:grid-cols-6 gap-4">
<div class="text-center p-4 rounded-lg" style="background-color: #bbf7d0;"><div class="text-2xl font-bold text-green-600" id="weekReservations">1</div><div class="text-sm text-gray-700">Week Reservations</div></div>
<div class="text-center p-4 rounded-lg" style="background-color: #fce7f3;"><div class="text-2xl font-bold text-pink-600" id="weekCommissions">$7.74</div><div class="text-sm text-gray-700">Week Commissions</div></div>
<div class="text-center p-4 rounded-lg" style="background-color: #ddd6fe;"><div class="text-2xl font-bold text-purple-600" id="weekCalls">22</div><div class="text-sm text-gray-700">Week Calls</div></div>
<div class="text-center p-4 rounded-lg" style="background-color: #bfdbfe;"><div class="text-2xl font-bold text-blue-600" id="weekSuccessfulCalls">1</div><div class="text-sm text-gray-700">Week Sales Count</div></div>
<div class="text-center p-4 rounded-lg" style="background-color: rgb(254, 226, 226);"><div class="text-2xl font-bold text-green-700" id="weekConversionRate" style="color: rgb(153, 27, 27);">4.5%</div><div class="text-sm text-gray-700">Week Conv. Rate</div></div>
<div class="text-center p-4 rounded-lg" style="background-color: #fffbeb;"><div class="text-2xl font-bold text-amber-600" id="weekWorkedTime">56:30:40</div><div class="text-sm text-gray-700">Week Worked Time</div></div>
</div>
</div>
<div class="card mb-8" style="background-color: #fffbeb;">
<div class="flex items-center justify-between mb-4">
<h2 class="text-lg font-semibold flex items-center gap-2"><span>üìû</span> Today¬¥s Performance</h2>
<button class="btn" id="resetTodayPerformance" style="background-color:#f59e0b">Reset Today</button>
</div>
<div class="grid grid-cols-3 md:grid-cols-6 gap-4">
<div class="text-center p-4 rounded-lg" style="background-color: #fef3c7;">
<div class="text-2xl font-bold text-amber-600" id="todayCommissions">$0.00</div>
<div class="text-sm text-gray-700">Today's Commissions</div>
</div>
<div class="text-center p-4 rounded-lg" style="background-color: #f0f9ff;">
<div class="text-2xl font-bold text-sky-600" id="todayCalls">0</div>
<div class="text-sm text-gray-700">Today's Calls</div>
</div>
<div class="text-center p-4 rounded-lg" style="background-color: #f0fdf4;">
<div class="text-2xl font-bold text-green-600" id="todaySalesCount">0</div>
<div class="text-sm text-gray-700">Today's Sales Count</div>
</div>
<div class="text-center p-4 rounded-lg" style="background-color: #faf5ff;">
<div class="text-2xl font-bold text-purple-600" id="todayWheelSpins">0</div>
<div class="text-sm text-gray-700">Today's Wheel Spins</div>
</div>
<div class="text-center p-4 rounded-lg" style="background-color: #fdf2f8;">
<div class="text-2xl font-bold text-orange-600" id="todaySpinEarnings">$0.00</div>
<div class="text-sm text-gray-700">Spin Earnings</div>
</div>
<div class="text-center p-4 rounded-lg" style="background-color: #dcfce7;">
<div class="text-2xl font-bold text-green-600" id="todayPerformanceWorkedTime">56:17:07</div>
<div class="text-sm text-gray-700">Today's Worked Time</div>
</div>
</div>
</div>
<div class="card mb-8" style="background-color: #e6fffa;">
<div class="flex gap-6 items-center">
<svg aria-hidden="true" class="shrink-0 hidden md:block" height="330" id="largeHotelGraphic" viewbox="0 0 200 330" width="200">
<rect class="hotel-building" height="300" rx="10" width="152" x="24" y="16"></rect>
<rect class="hotel-base" height="12" rx="4" width="168" x="16" y="316"></rect>
<rect class="hotel-lamp lit" height="30" rx="2" width="10" x="40" y="265"></rect>
<rect class="hotel-lamp lit" height="30" rx="2" width="10" x="150" y="265"></rect>
<rect fill="#0f172a" height="51" rx="4" stroke="#0b1220" width="40" x="80" y="265"></rect>
<circle cx="113" cy="292" fill="#fde047" r="2"></circle>
<rect class="hotel-window-large" height="21" width="29" x="40" y="29"></rect> <rect class="hotel-window-large" height="21" width="29" x="131" y="29"></rect>
<rect class="hotel-window-large" height="21" width="29" x="40" y="56"></rect> <rect class="hotel-window-large" height="21" width="29" x="131" y="56"></rect>
<rect class="hotel-window-large" height="21" width="29" x="40" y="82"></rect> <rect class="hotel-window-large" height="21" width="29" x="131" y="82"></rect>
<rect class="hotel-window-large" height="21" width="29" x="40" y="109"></rect> <rect class="hotel-window-large" height="21" width="29" x="131" y="109"></rect>
<rect class="hotel-window-large" height="21" width="29" x="40" y="135"></rect> <rect class="hotel-window-large" height="21" width="29" x="131" y="135"></rect>
<rect class="hotel-window-large" height="21" width="29" x="40" y="162"></rect> <rect class="hotel-window-large" height="21" width="29" x="131" y="162"></rect>
<rect class="hotel-window-large" height="21" width="29" x="40" y="188"></rect> <rect class="hotel-window-large" height="21" width="29" x="131" y="188"></rect>
<rect class="hotel-window-large" height="21" width="29" x="40" y="215"></rect> <rect class="hotel-window-large" height="21" width="29" x="131" y="215"></rect>
<g id="theme-container"></g>
</svg>
<div class="flex-1">
<div class="flex items-center justify-between mb-4"><h2 class="text-lg font-semibold flex items-center gap-2"><span>üìû</span> Call Management</h2><div class="flex items-center gap-2"><label class="text-sm">Preview:</label><select class="border rounded px-2 py-1 text-sm" id="callsPreviewCount"><option value="1">1</option><option value="3">3</option><option selected="" value="5">5</option><option value="10">10</option></select></div></div>
<div class="flex justify-center mb-4"><button class="btn" id="startCall" style="background-color: #10b981; padding: 24px 48px; font-size: 32px;">üìû Start New Call</button></div>
<div class="mb-3" id="mostRecentCall"><div class="p-2 rounded-lg border flex items-center justify-between gap-3 ring-2 ring-teal-300" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:55 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 110s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#fce7f3; color:#db2777; border: 1px solid #db2777;">Existing reservation</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="22" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div></div><div class="space-y-2 mb-3" id="recentCalls"><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:51 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 59s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#cffafe; color:#0891b2; border: 1px solid #0891b2;">Wanted to speak to hotel directly</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="21" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:50 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 135s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#fef3c7; color:#d97706; border: 1px solid #d97706;">Rate too high</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="20" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:47 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 48s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#cffafe; color:#0891b2; border: 1px solid #0891b2;">Wanted to speak to hotel directly</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="19" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:46 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 46s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#fce7f3; color:#db2777; border: 1px solid #db2777;">Existing reservation</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="18" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:45 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 27s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#e5e7eb; color:#6b7280; border: 1px solid #6b7280;">Wrong number</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="17" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div></div>
<details id="allCallsDetails"><summary class="cursor-pointer font-semibold">All Calls</summary><div class="mt-2 space-y-2" id="allCalls"><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:55 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 110s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#fce7f3; color:#db2777; border: 1px solid #db2777;">Existing reservation</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="22" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:51 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 59s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#cffafe; color:#0891b2; border: 1px solid #0891b2;">Wanted to speak to hotel directly</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="21" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:50 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 135s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#fef3c7; color:#d97706; border: 1px solid #d97706;">Rate too high</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="20" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:47 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 48s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#cffafe; color:#0891b2; border: 1px solid #0891b2;">Wanted to speak to hotel directly</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="19" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:46 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 46s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#fce7f3; color:#db2777; border: 1px solid #db2777;">Existing reservation</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="18" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:45 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 27s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#e5e7eb; color:#6b7280; border: 1px solid #6b7280;">Wrong number</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="17" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:44 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 41s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#e2e8f0; color:#475569; border: 1px solid #475569;">Hotel rates not available</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="16" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:43 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 33s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#f3e8ff; color:#9333ea; border: 1px solid #9333ea;">Dead air</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="15" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:43 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 158s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#e5e7eb; color:#6b7280; border: 1px solid #6b7280;">Wrong number</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="14" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:37 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 231s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#fed7aa; color:#ea580c; border: 1px solid #ea580c;">Hang up</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="13" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:33 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 49s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#fce7f3; color:#db2777; border: 1px solid #db2777;">Existing reservation</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="12" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:29 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 53s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#e2e8f0; color:#475569; border: 1px solid #475569;">Hotel rates not available</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="11" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:28 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 226s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#e2e8f0; color:#475569; border: 1px solid #475569;">Hotel rates not available</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="10" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">01:23 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 704s</div><div class="text-green-700 text-base font-extrabold">$7.74</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#d1fae5; color:#16a34a; border: 1px solid #16a34a;">Successful Sale</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="9" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">12:58 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 90s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#cffafe; color:#0891b2; border: 1px solid #0891b2;">Wanted to speak to hotel directly</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="8" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">12:54 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 518s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#fee2e2; color:#dc2626; border: 1px solid #dc2626;">Rate Shopping</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="7" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">12:45 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 38s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#fee2e2; color:#dc2626; border: 1px solid #dc2626;">Rate Shopping</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="6" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">12:44 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 68s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#cffafe; color:#0891b2; border: 1px solid #0891b2;">Wanted to speak to hotel directly</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="5" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">12:43 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 490s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#fee2e2; color:#dc2626; border: 1px solid #dc2626;">Rate Shopping</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="4" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">12:35 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 117s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#e2e8f0; color:#475569; border: 1px solid #475569;">Hotel rates not available</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="3" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">12:33 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 52s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#cffafe; color:#0891b2; border: 1px solid #0891b2;">Wanted to speak to hotel directly</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="2" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div><div class="p-2 rounded-lg border flex items-center justify-between gap-3" style="background-color: rgb(240, 249, 255);"><div class="flex-shrink-0"><div class="font-semibold text-gray-800">12:32 PM</div><div class="text-xs text-gray-600 mt-1">Duration: 417s</div></div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:#fee2e2; color:#dc2626; border: 1px solid #dc2626;">Rate Shopping</span></div><div class="flex-shrink-0"><button class="delete-call-btn text-gray-400 hover:text-red-500 p-1" data-call-id="1" title="Delete this call"><svg class="h-5 w-5" fill="currentColor" viewbox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" fill-rule="evenodd"></path></svg></button></div></div></div></details>
</div>
</div>
</div>
<!-- Overall Performance Section -->
<div class="bg-transparent p-4 rounded-lg mb-6 shadow w-full">
<div class="flex items-center justify-between mb-3">
<h2 class="text-lg font-semibold">üìä Overall Performance</h2>
</div>
<div class="grid grid-cols-1 md:grid-cols-5 gap-4">
<div class="text-center p-4 rounded-lg" style="background-color:#e0f2fe;">
<div class="text-sm font-medium mb-1">Total Spins</div>
<div class="text-2xl font-bold text-pink-600" id="totalSpins">$0.00</div>
</div>
<div class="text-center p-4 rounded-lg" style="background-color:#ddd6fe;">
<div class="text-sm font-medium mb-1">Total Commissions</div>
<div class="text-2xl font-bold text-purple-600" id="totalCommissions">$0.00</div>
</div>
<div class="text-center p-4 rounded-lg" style="background-color:#d1fae5;">
<div class="text-sm font-medium mb-1">Sales Count</div>
<div class="text-2xl font-bold text-blue-600" id="salesCount">0</div>
</div>
<div class="text-center p-4 rounded-lg" style="background-color:rgb(254,226,226);">
<div class="text-sm font-medium mb-1">Conversion Rate</div>
<div class="text-2xl font-bold" id="conversionRate" style="color:rgb(153,27,27);">0%</div>
</div>

<div class="text-center p-4 rounded-lg" style="background-color:#eef2ff;">
  <div class="text-sm font-medium mb-1">Monthly Tracker</div>
  <div class="text-2xl font-bold text-indigo-600" id="monthlyTime">00:00:00</div>
  <div class="text-xs opacity-80">This month (auto)</div>
</div>

</div>
<div class="card mb-8" id="quincenaOverviewSection" style="background-color: #eef2ff;">
<div class="flex items-center justify-between mb-3">
<div>
<h2 class="text-2xl font-bold text-slate-800">Quincena Overview</h2>
<p class="text-sm text-slate-600">Viewing Period: <span class="font-semibold text-blue-600" id="qNow">Sep 1, 2025 - Sep 15, 2025</span></p>
</div>
<div class="flex gap-2">
<button class="btn bg-indigo-400" id="prevQuincenaBtn">‚óÄ</button>
<button class="btn bg-indigo-400" id="nextQuincenaBtn">‚ñ∂</button>
</div>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"><div class="p-4 rounded-lg" style="background-color: #dcfce7;"><h3 class="font-bold text-gray-800">First Half (1‚Äì15) ‚Äî Combined Total</h3><p class="text-sm text-gray-600">Payday: <span class="font-semibold" id="q1Payday">Sep 21, 2025</span></p><p class="text-3xl font-extrabold text-gray-900 my-2" id="q1Total">$0.00</p><p class="text-xs text-gray-500">Includes commissions settled in this period + wheel bonuses paying on this date.</p></div><div class="p-4 rounded-lg" style="background-color: #fff7ed;"><h3 class="font-bold text-gray-800">Second Half (16‚ÄìEOM) ‚Äî Combined Total</h3><p class="text-sm text-gray-600">Payday: <span class="font-semibold" id="q2Payday">Oct 6, 2025</span></p><p class="text-3xl font-extrabold text-gray-900 my-2" id="q2Total">$0.00</p><p class="text-xs text-gray-500">Includes commissions settled in this period + wheel bonuses paying on this date.</p></div></div><div><h3 class="text-lg font-bold text-slate-800 mb-2">Pay Period Activity (Sales &amp; Spins)</h3><div class="overflow-x-auto"><table class="w-full text-sm"><thead class="bg-indigo-200"><tr><th class="text-left p-2">Guest/Source</th><th class="text-left p-2">Settled Date</th><th class="text-left p-2">Pay Date</th><th class="text-right p-2">Commission</th><th class="text-center p-2">Actions</th></tr></thead><tbody id="qSettlingTbody"><tr><td class="p-2 text-slate-500" colspan="5">No settlements in this quincena.</td></tr></tbody></table></div></div>
</div>
<div class="card mb-8" style="background-color: #111827;">
<h2 class="text-lg font-semibold mb-4" style="color: #f97316;">
<details open="">
<summary class="cursor-pointer flex items-center justify-between mb-3">
<h3 class="text-xl font-bold" id="monthlyReviewTitle">Daily Performance for September 2025</h3>
<div class="flex gap-2">
<button class="btn bg-indigo-400" id="prevMonthBtn">‚óÄ</button>
<button class="btn bg-indigo-400" id="nextMonthBtn">‚ñ∂</button>
</div>
</summary>
<div class="performance-log-grid mt-4" id="monthlyReviewContent"><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">1 Mon</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">2 Tue</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">3 Wed</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">4 Thu</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">5 Fri</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">6 Sat</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">7 Sun</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">8 Mon</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">9 Tue</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">10 Wed</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>13:40:12</p></div><div><p class="font-semibold">Calls:</p><p>22</p></div><div><p class="font-semibold">Sales:</p><p>1</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">4.5%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">11 Thu</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>42:36:55</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">12 Fri</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p id="today-monthly-log-time">57:32:07</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">13 Sat</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">14 Sun</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">15 Mon</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">16 Tue</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">17 Wed</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">18 Thu</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">19 Fri</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">20 Sat</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">21 Sun</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">22 Mon</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">23 Tue</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">24 Wed</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">25 Thu</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">26 Fri</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">27 Sat</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">28 Sun</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">29 Mon</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div><div class="performance-day bg-red-100 border-red-200"><div class="font-bold">30 Tue</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p><p>00:00:00</p></div><div><p class="font-semibold">Calls:</p><p>0</p></div><div><p class="font-semibold">Sales:</p><p>0</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="text-red-600 font-bold">0.0%</p></div></div></div></div>
</details>
</h2></div>
<div class="card mb-8" style="background-color: #e0e7ff;">
<div class="flex items-center justify-between cursor-pointer" onclick="toggleReservations()">
<h2 class="text-lg font-semibold mb-4">All Reservations</h2>
<span class="transform transition-transform duration-300" id="reservationsArrow">‚ñº</span>
</div>
<div class="overflow-x-auto transition-all duration-500 ease-in-out" id="reservationsContent">
<table class="w-full text-sm">
<thead>
<tr class="border-b" style="background-color: #c7d2fe;">
<th class="text-left">ID</th>
<th class="text-left">Guest</th>
<th class="text-left">Dates</th>
<th class="text-right">Commission</th>
<th class="text-left">Status</th>
<th class="text-left">Actions</th>
</tr>
</thead>
<tbody id="reservationsTbody">
<tr class="border-b">
<td>1</td>
<td>New Sale</td>
<td>Sep 23, 2025 ‚Üí Sep 25, 2025</td>
<td class="text-right">$7.74</td>
<td><span class="status-badge status-pending">pending</span></td>
<td>
<button class="text-xs px-2 py-1 rounded bg-yellow-500 text-white mr-1" data-cancel-id="1">Cancel</button>
<button class="text-xs px-2 py-1 rounded bg-red-500 text-white" data-del-id="1">Delete</button>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<script>
  function toggleReservations() {
    const content = document.getElementById("reservationsContent");
    const arrow = document.getElementById("reservationsArrow");

    if (content.style.display === "none") {
      content.style.display = "block";
      arrow.style.transform = "rotate(0deg)";
    } else {
      content.style.display = "none";
      arrow.style.transform = "rotate(-90deg)";
    }
  }

  // start collapsed (optional)
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("reservationsContent").style.display = "none";
    document.getElementById("reservationsArrow").style.transform = "rotate(-90deg)";
  });
</script>
<!-- Modals -->
<!-- New Location Disambiguation Modal -->
<div aria-labelledby="locationTitle" aria-modal="true" class="modal-bg" id="modalLocation" role="dialog">
<div class="modal" style="background-color: #eef2ff;">
<h3 class="text-center font-bold text-lg mb-3 text-slate-800" id="locationTitle">Ambiguous Location</h3>
<p class="text-center text-slate-600 mb-4">Your search returned multiple possible locations. Please select the correct one:</p>
<div class="flex flex-col gap-2" id="locationOptions">
<!-- Options will be injected here by JavaScript -->
</div>
<div class="mt-4 text-center">
<button class="btn" onclick="hideModal('modalLocation')" style="background-color:#64748b">Cancel</button>
</div>
</div>
</div>
<div aria-labelledby="callOutcomeTitle" aria-modal="true" class="modal-bg" id="modalCall" role="dialog">
<div class="modal" style="background-color: #f0f9ff; width: 100%; max-width: 100%; height: 100%; display: flex; flex-direction: column; border-radius: 0; padding: 2rem;">
<div class="flex flex-col md:flex-row gap-6 flex-grow min-h-0">
<!-- Left Column: Call Operations -->
<div class="w-full md:w-1/3 md:pr-6 md:border-r md:border-gray-300 flex flex-col">
<div class="call-title" id="callOutcomeTitle">Call Outcome</div>
<div class="call-timer" id="callTimerDisplay">00:00</div>
<div class="grid grid-cols-2 gap-2 flex-grow" id="callOutcomeBtns"></div>
<div class="mt-4 text-center">
<button class="btn w-full" onclick="hideModal('modalCall')" style="background-color:#ef4444">Cancel &amp; Reset Call</button>
</div>
</div>
<!-- Right Column: Omniscience Dashboard -->
<div class="w-full md:w-2/3 flex flex-col min-h-0">
<h3 class="text-xl font-bold mb-3 flex items-center gap-2 text-slate-800 shrink-0">
<span>üîÆ</span> Omniscience Dashboard
</h3>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-3 mb-3 shrink-0">
<input class="lg:col-span-2 w-full border rounded px-3 py-2 text-base" id="searchInput" placeholder="Enter Full Address or City..." type="text"/>
<input class="w-40 h-10 px-2 border rounded-md" id="intelligenceCheckInDate" type="date"/>
<div class="flex gap-2">
<button class="btn w-1/2" id="todayBtn" style="background:#6366f1">Today</button>
<button class="btn w-1/2" id="analyzeBtn" style="background:#0ea5e9">Analyze</button>
</div>
</div>
<div class="flex-grow p-4 rounded-lg bg-white border border-slate-200 overflow-y-auto min-h-0" id="intelligenceResults">
<p class="text-slate-500 text-center py-10">Enter a location and date to begin intelligence scan...</p>
</div>
</div>
</div>
</div>
</div>
<div id="modalCommission" class="modal-bg" role="dialog" aria-modal="true" aria-labelledby="commissionTitle"><div class="modal" style="background-color: #d1fae5;"><h3 id="commissionTitle" class="text-center font-semibold mb-3">üéâ Congratulations! üéâ</h3><p class="text-center mb-3">Enter commission amount for this sale:</p><input id="commissionInput" type="number" class="w-full border rounded px-2 py-2" placeholder="Commission amount"><button id="commissionContinue" class="btn w-full mt-3" style="background-color:#10b981">Continue</button><div class="mt-3 text-center"><button class="btn" style="background-color:#ef4444" onclick="hideModal(&#39;modalCommission&#39;)">Cancel</button></div></div></div>
<div id="modalDates" class="modal-bg" role="dialog" aria-modal="true" aria-labelledby="datesTitle">
  <div class="modal" style="background-color: #fef3c7;">
      <div id="datesForm">
          <h3 id="datesTitle" class="text-center font-semibold mb-3">Select Check-in and Check-out Dates</h3>
          <label class="block text-sm mb-1">Check-in</label>
          <div id="checkInRow" class="flex items-center gap-2 mb-3 cursor-pointer">
              <input id="reservationCheckInDate" type="date" class="w-full border rounded px-2 py-2" class="w-40 h-10 px-2 border rounded-md">
              <button id="btnCheckInToday" class="btn" style="background:#3b82f6">Today</button>
          </div>
          <label class="block text-sm mb-1">Check-out</label>
          <input id="reservationCheckOutDate" type="date" class="w-full border rounded px-2 py-2 mb-3" class="w-40 h-10 px-2 border rounded-md">
          <button id="datesConfirm" class="btn w-full" style="background-color:#10b981">Confirm</button>
          <div class="mt-3 text-center">
              <button class="btn" style="background-color:#ef4444" onclick="hideModal(&#39;modalDates&#39;)">Cancel</button>
          </div>
      </div>
      <div id="datesSuccess" class="hidden text-center">
          <svg class="mx-auto h-24 w-24 text-green-500 scale-in" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <h3 class="mt-4 text-2xl font-bold text-gray-800">¬°Guardado!</h3>
</div>
</div>
</div>
<div aria-labelledby="wheelTitle" aria-modal="true" class="modal-bg" id="modalWheel" role="dialog"><div class="modal" style="background-color:#fff7ed;"><h3 class="text-center font-extrabold mb-2 text-2xl" id="wheelTitle">üéâ Fantastic! Wheel Spin üéâ</h3><div class="wheel-container"><div class="wheel-pointer"></div><canvas height="350" id="wheelCanvas" width="350"></canvas></div><p class="text-center mb-1 font-semibold">Enter the bonus amount you earned:</p><input class="border rounded px-2 py-2 w-full text-center text-lg" id="wheelSpinInput" placeholder="e.g., 18" type="number"/><button class="btn w-full mt-2 text-lg" id="wheelSpinSave" style="background-color:#f59e0b">Spin &amp; Save</button></div></div>
<script>
  // --- Omni-Coder Unified Logic Engine v20.5 (Manual Override Corrective Build) ---

   const GOAL_CONVERSION_RATE = 25;
   const STORAGE_KEY = 'hotelCommissionTracker_unified_v15_idb';
   const DAILY_GOAL_HOURS = 8;
   
   // STATE FOR INTEL SORTING
   let lastIntelData = null;
   let lastCheckInDateStr = null;
   let intelSortDirection = 'asc';

   let masterTimerInterval = null, ambientQuoteInterval = null, callTimerInterval = null;
   let hotelLightsTimer = null, largeHotelTimer = null, dynamicSkyInterval = null;

   let gapiInited = false, gisInited = false, tokenClient, gapiAccessToken = null;
   const DISCOVERY_DOC = 'https://sheets.googleapis.com/$discovery/rest?version=v4';
   const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';
   
   const DEFAULT_QUOTES = { "Productivity": [ { "text": "The secret of getting ahead is getting started.", "author": "Mark Twain" }, { "text": "Amateurs sit and wait for inspiration, the rest of us just get up and go to work.", "author": "Stephen King" } ] };
const callOutcomes = [
    { outcome: 'Successful Sale', bg: '#d1fae5', border: '#16a34a' },
    { outcome: 'Rate Shopping', bg: '#fee2e2', border: '#dc2626' },
    { outcome: 'Rate too high', bg: '#fef3c7', border: '#d97706' },
    { outcome: 'Wanted to pay in cash', bg: '#e0e7ff', border: '#4f46e5' },
    { outcome: 'Wanted to speak to hotel directly', bg: '#cffafe', border: '#0891b2' },
    { outcome: 'Card declined', bg: '#fecaca', border: '#ef4444' },
    { outcome: 'Hotel rates not available', bg: '#e2e8f0', border: '#475569' },
    // THE EXTRA COMMA WAS HERE. IT HAS BEEN REMOVED.
    { outcome: 'Dead air', bg: '#f3e8ff', border: '#9333ea' },
    { outcome: 'Hang up', bg: '#fed7aa', border: '#ea580c' },
    { outcome: 'Wrong number', bg: '#e5e7eb', border: '#6b7280' },
    { outcome: 'Existing reservation', bg: '#fce7f3', border: '#db2777' },
    { outcome: 'Wanted Group/Govt/Special rate/long term stay', bg: '#e0e7ff', border: '#4338ca' }
];

   const wheelPrizes = [12, 30, 18, 54, 12, 36, 24, 12, 18, 30, 12, 54, 24, 12, 36, 18, 12, 24, 30, 12];
   const wheelColors = ["#f87171", "#fb923c", "#facc15", "#a3e635", "#4ade80", "#34d399", "#2dd4bf", "#22d3ee", "#38bdf8", "#60a5fa", "#818cf8", "#a78bfa", "#c084fc", "#e879f9", "#f472b6", "#fb7185", "#fca5a5", "#fdba74", "#fde047", "#bbf7d0"];
   let currentSpinMode = 'regular'; window.currentSpinMode = currentSpinMode;
   let currentReservationIdForSpin = null;
   const THEME_DATA = { 'none': { name: 'None', svg: '' }, 'christmas': { name: 'Christmas', svg: `<path d="M 24 16 C 50 40, 150 40, 176 16 M 24 316 L 80 150 L 120 150 L 176 316 M 80 150 Q 100 130 120 150" stroke="#166534" stroke-width="2" fill="none" /><circle cx="20" cy="180" r="4" class="christmas-light" style="animation-delay: 0s;"/><circle cx="180" cy="180" r="4" class="christmas-light" style="animation-delay: .2s;"/><circle cx="40" cy="100" r="4" class="christmas-light" style="animation-delay: .4s;"/><circle cx="160" cy="100" r="4" class="christmas-light" style="animation-delay: .6s;"/><circle cx="100" cy="145" r="5" class="christmas-light" style="animation-delay: .8s;"/><circle cx="34" cy="21" r="3" class="christmas-light" style="animation-delay: 0s;"/><circle cx="54" cy="29" r="3" class="christmas-light" style="animation-delay: .2s;"/><circle cx="74" cy="35" r="3" class="christmas-light" style="animation-delay: .4s;"/><circle cx="94" cy="36" r="3" class="christmas-light" style="animation-delay: .6s;"/><circle cx="114" cy="35" r="3" class="christmas-light" style="animation-delay: .8s;"/><circle cx="134" cy="29" r="3" class="christmas-light" style="animation-delay: 1s;"/><circle cx="154" cy="21" r="3" class="christmas-light" style="animation-delay: 1.2s;"/><path d="M 10 316 L 25 280 L 15 280 Z" fill="#15803d"/><path d="M 15 280 L 30 240 L 20 240 Z" fill="#15803d"/><path d="M 20 240 L 35 200 L 25 200 Z" fill="#15803d"/><path d="M 100 130 L 110 120 L 100 110 L 90 120 Z" fill="#fde047" class="pulseSoft" style="filter: drop-shadow(0 0 5px #fde047);"/><circle class="falling-snow" cx="30" r="2" fill="white" style="animation-delay: 0s;"/><circle class="falling-snow" cx="60" r="3" fill="white" style="animation-delay: 2s;"/><circle class="falling-snow" cx="90" r="2" fill="white" style="animation-delay: 5s;"/><circle class="falling-snow" cx="120" r="3" fill="white" style="animation-delay: 1s;"/><circle class="falling-snow" cx="150" r="2" fill="white" style="animation-delay: 7s;"/>`}, 'new_year': { name: `New Year's Eve`, svg: `<g class="firework-pop" style="animation-delay: 0s; transform-box: fill-box; transform-origin: center;"><circle cx="60" cy="50" r="20" fill="#fde047"/></g><g class="firework-pop" style="animation-delay: 0.7s; transform-box: fill-box; transform-origin: center;"><circle cx="140" cy="70" r="20" fill="#f0f9ff"/></g><g class="firework-pop" style="animation-delay: 1.2s; transform-box: fill-box; transform-origin: center;"><circle cx="100" cy="40" r="25" fill="#fde047"/></g><text x="100" y="150" font-family="monospace" font-size="48" fill="#fde047" text-anchor="middle" class="blink" style="filter: drop-shadow(0 0 5px #fde047);">2024</text><rect class="falling-confetti" x="40" y="-20" width="5" height="10" fill="#fde047" style="animation-delay: 0s;"/><rect class="falling-confetti" x="80" y="-20" width="5" height="10" fill="#a855f7" style="animation-delay: 1s;"/><rect class="falling-confetti" x="120" y="-20" width="5" height="10" fill="#3b82f6" style="animation-delay: 2s;"/><rect class="falling-confetti" x="160" y="-20" width="5" height="10" fill="#ec4899" style="animation-delay: 3s;"/>` }, 'halloween': { name: 'Halloween', svg: `<path d="M30 300 q 15 -20 30 0" fill="#fb923c" stroke="#7c2d12" stroke-width="1" class="pumpkin-glow"/><path d="M140 300 q 15 -20 30 0" fill="#fb923c" stroke="#7c2d12" stroke-width="1" class="pumpkin-glow" style="animation-delay: 0.5s;"/><path d="M176 16 L 150 40 M 176 40 L 150 16 M 24 16 L 50 40 M 24 40 L 50 16" stroke="#d1d5db" stroke-width="1.5"/><path class="ghost" d="M 160 16 q 0 -15 -15 -15 q -15 0 -15 15 q 0 10 5 15 l 5 -5 l 5 5 l 5 -5 Z" fill="white" /><path d="M 40 29 L 24 16" stroke="white" stroke-width="1" opacity="0.5"/><path d="M 69 29 L 24 16" stroke="white" stroke-width="1" opacity="0.5"/><path d="M 131 29 L 176 16" stroke="white" stroke-width="1" opacity="0.5"/><path d="M 160 29 L 176 16" stroke="white" stroke-width="1" opacity="0.5"/>`}, 'patriotic': { name: 'Patriotic (USA)', svg: `<path d="M 24 16 H 176" stroke="#ef4444" stroke-width="4"/><path d="M 24 22 H 176" stroke="white" stroke-width="4"/><path d="M 24 28 H 176" stroke="#3b82f6" stroke-width="4"/><path d="M 24 160 H 176" stroke="#ef4444" stroke-width="4"/><path d="M 24 166 H 176" stroke="white" stroke-width="4"/><path d="M 24 172 H 176" stroke="#3b82f6" stroke-width="4"/><g class="firework-pop" style="animation-delay: 0s; transform-box: fill-box; transform-origin: center;"><circle cx="60" cy="50" r="15" fill="#ef4444"/></g><g class="firework-pop" style="animation-delay: 0.5s; transform-box: fill-box; transform-origin: center;"><circle cx="140" cy="70" r="15" fill="#3b82f6"/></g><g class="firework-pop" style="animation-delay: 1s; transform-box: fill-box; transform-origin: center;"><circle cx="100" cy="40" r="15" fill="white"/></g>`}, 'muertos': { name: 'D√≠a de los Muertos / Mex. Ind.', svg: `<g><path d="M24 20 L 176 20" stroke="none" fill="none" id="p1"/><text><textPath href="#p1" fill="#22c55e" font-size="10">VIVA</textPath><textPath href="#p1" startOffset="50%" fill="white" font-size="10">MEXICO</textPath><textPath href="#p1" startOffset="100%" text-anchor="end" fill="#ef4444" font-size="10">VIVA</textPath></g><path d="M 80 265 Q 100 285 120 265" stroke="#4c0519" stroke-width="1" fill="none"/><path d="M 40 29 Q 100 -10 160 29" stroke="#4c0519" stroke-width="1" fill="none"/><circle cx="80" cy="265" r="5" fill="#f97316"/><circle cx="120" cy="265" r="5" fill="#f97316"/><circle cx="100" cy="279" r="6" fill="#f97316"/><circle cx="90" cy="274" r="4" fill="#eab308"/><circle cx="110" cy="274" r="4" fill="#eab308"/><circle cx="40" cy="29" r="5" fill="#a21caf"/><circle cx="160" cy="29" r="5" fill="#a21caf"/><circle cx="100" cy="14" r="6" fill="#a21caf"/><circle cx="70" cy="20" r="4" fill="#1d4ed8"/><circle cx="130" cy="20" r="4" fill="#1d4ed8"/>`}, 'autumn': { name: 'Autumn / Thanksgiving', svg: `<path class="falling-leaf" d="M25 0 C 40 20, 60 20, 75 0 C 60 -20, 40 -20, 25 0 Z" fill="#ea580c" style="animation-delay: 0s;"/><path class="falling-leaf" d="M100 0 C 115 20, 135 20, 150 0 C 135 -20, 115 -20, 100 0 Z" fill="#ca8a04" style="animation-delay: 2s;"/><path class="falling-leaf" d="M60 0 C 75 20, 95 20, 110 0 C 95 -20, 75 -20, 60 0 Z" fill="#dc2626" style="animation-delay: 5s;"/><path d="M30 300 q 15 -20 30 0" fill="#f97316" stroke="#7c2d12" stroke-width="1"/><path d="M140 300 q 15 -20 30 0" fill="#f97316" stroke="#7c2d12" stroke-width="1"/>`}, 'valentines': { name: `Valentine's Day`, svg: `<path class="beating-heart" d="M100 100 a 20 20 0 1 1 40 0 a 20 20 0 1 1 40 0 q 0 20 -40 40 q -40 -20 -40 -40 Z" fill="#f43f5e" transform="translate(-40, -40) scale(0.5)"/><path class="beating-heart" d="M100 100 a 20 20 0 1 1 40 0 a 20 20 0 1 1 40 0 q 0 20 -40 40 q -40 -20 -40 -40 Z" fill="#f43f5e" transform="translate(60, 20) scale(0.3)" style="animation-delay: 0.3s"/><path class="beating-heart" d="M100 100 a 20 20 0 1 1 40 0 a 20 20 0 1 1 40 0 q 0 20 -40 40 q -40 -20 -40 -40 Z" fill="#f43f5e" transform="translate(10, 100) scale(0.4)" style="animation-delay: 0.6s"/>`}, 'stpatricks': { name: `St. Patrick's Day`, svg: `<circle class="falling-confetti" cx="40" cy="0" r="5" fill="#16a34a" style="animation-delay: 0s;"/><circle class="falling-confetti" cx="80" cy="0" r="5" fill="#fbbf24" style="animation-delay: 1s;"/><circle class="falling-confetti" cx="120" cy="0" r="5" fill="#16a34a" style="animation-delay: 2s;"/><circle class="falling-confetti" cx="160" cy="0" r="5" fill="#fbbf24" style="animation-delay: 3s;"/>` }, 'spring': { name: 'Spring', svg: `<circle cx="40" cy="300" r="10" fill="#f472b6"/><path d="M 40 290 L 40 250" stroke="#166534" stroke-width="2"/><circle cx="160" cy="300" r="10" fill="#8b5cf6" /><path d="M 160 290 L 160 250" stroke="#166534" stroke-width="2"/>`}, 'summer': { name: 'Summer', svg: `<circle cx="100" cy="60" r="30" fill="#fde047" class="pulseSoft"/>`}, 'cinco_de_mayo': { name: 'Cinco de Mayo', svg: `<path d="M24 20 L 176 20" stroke="none" fill="none" id="p1"/><text><textPath href="#p1" fill="#22c55e" font-size="10">CINCO</textPath><textPath href="#p1" startOffset="50%" fill="white" font-size="10">DE</textPath><textPath href="#p1" startOffset="100%" text-anchor="end" fill="#ef4444" font-size="10">MAYO</textPath></g>`}, 'new_year_day': { name: `New Year's Day`, svg: `<text x="100" y="150" font-family="monospace" font-size="32" fill="#4f46e5" text-anchor="middle" class="pulseSoft">Happy New Year!</text>`} };
   let state = {};
   function getDefaultState() { 
     return { 
       config: {
         appName: "Hotel Commission Tracker",
         featureToggles: {}
       },
       reservations: [], 
       callRecords: [], 
       wheelSpins: [], 
       workSessions: [], 
       callsWithoutSale: 0, 
       nextReservationId: 1, 
       nextWheelId: 1, 
       nextCallId: 1, 
       timeTracking: { status: 'checked-out', lastStatusChange: null, todayWorkSeconds: 0, todayBreakSeconds: 0, todayLunchSeconds: 0, }, 
       settings: { spinOffset: 0, hotelLightsOn: true, exteriorLampsOn: false, kenBurns: false, background: '#fce7f3', customBg: null, autoQuotes: false, hotelLightsSpeed: 1.0, activeTheme: 'none', dynamicSky: 'on', sunMoon: true, lighthouse: true, googleClientId: '', googleSheetId: '', googleSheetName: 'Sheet1' }, 
       quotes: { ...DEFAULT_QUOTES }, 
       ui: { monthlyViewDate: new Date(), quincenaViewDate: new Date(), todayPerformanceResetTimestamp: null }, 
       confettiIntensity: 1.0,
       customApiKeys: {} 
     }; 
   }
   const $ = s => document.querySelector(s);
   const $$ = s => Array.from(document.querySelectorAll(s));
   async function save() { try { state.settings.googleClientId = (document.querySelector('#googleClientIdInput')?.value || '').trim(); state.settings.googleSheetId = (document.querySelector('#googleSheetIdInput')?.value || '').trim(); state.settings.googleSheetName = (document.querySelector('#googleSheetNameInput')?.value || 'Sheet1').trim(); await idbKeyval.set(STORAGE_KEY, state); } catch (e) { console.error("IndexedDB Save Error:", e); showToast("Error saving data!", "error"); } }
   async function load() { 
     let savedState = await idbKeyval.get(STORAGE_KEY); 
     state = getDefaultState(); 
     
     // --- NEW: Load external configuration ---
     try {
       const response = await fetch('config.json?v=' + new Date().getTime()); // Appending timestamp to prevent caching
       if (response.ok) {
         const config = await response.json();
         state.config = { ...state.config, ...config }; // Merge config into state
       } else {
         console.warn("config.json not found or failed to load. Using default settings.");
       }
     } catch (e) {
       console.error("Error reading or parsing config.json:", e);
     }
     // --- END NEW ---

     if (savedState) { 
       try { 
         Object.keys(state).forEach(key => { 
           if (savedState[key] !== undefined && key !== 'config') { // Do not load old config from save
             if (typeof state[key] === 'object' && state[key] !== null && !Array.isArray(state[key])) { 
               state[key] = { ...state[key], ...savedState[key] }; 
             } else { 
               state[key] = savedState[key]; 
             } 
           } 
         }); 
         ['callRecords', 'wheelSpins', 'workSessions', 'reservations'].forEach(key => { if (state[key]) { state[key].forEach(item => { for (const dateKey in item) { const isDateLike = dateKey.toLowerCase().includes('date') || ['timestamp', 'start', 'end', 'lastStatusChange'].includes(dateKey); if (isDateLike && item[dateKey] && typeof item[dateKey] === 'string') { item[dateKey] = new Date(item[dateKey]); } } }); } }); 
         if (state.timeTracking.lastStatusChange) state.timeTracking.lastStatusChange = new Date(state.timeTracking.lastStatusChange); 
         state.ui.monthlyViewDate = new Date(state.ui.monthlyViewDate || new Date()); 
         state.ui.quincenaViewDate = new Date(state.ui.quincenaViewDate || new Date()); 
         state.ui.todayPerformanceResetTimestamp = state.ui.todayPerformanceResetTimestamp ? new Date(state.ui.todayPerformanceResetTimestamp) : null; 
       } catch(e) { 
         console.warn('Error processing saved state, resetting to default.', e); 
         state = getDefaultState(); 
         await idbKeyval.del(STORAGE_KEY); 
       } 
     } 
     document.querySelector('#googleClientIdInput').value = state.settings.googleClientId || ''; 
     document.querySelector('#googleSheetIdInput').value = state.settings.googleSheetId || ''; 
     document.querySelector('#googleSheetNameInput').value = state.settings.googleSheetName || 'Sheet1'; 
     await save(); 
   }
   function showToast(msg, type = 'info') { const box = document.querySelector('#toastBox'); if (!box) return; const t = document.createElement('div'); t.className = 'toast'; t.textContent = msg; if (type === 'success') t.style.backgroundColor = '#166534'; if (type === 'error') t.style.backgroundColor = '#991b1b'; box.appendChild(t); setTimeout(() => { t.remove(); }, 3000); }
   const formatMoney = n => '$' + (Number(n||0)).toFixed(2);
   const formatTime = totalSeconds => { const h = Math.floor(totalSeconds / 3600), m = Math.floor((totalSeconds % 3600) / 60), s = Math.floor(totalSeconds % 60); return [h, m, s].map(v => v.toString().padStart(2, '0')).join(':'); };
   const formatTimer = sec => { const m = String(Math.floor(sec / 60)).padStart(2, '0'), s = String(sec % 60).padStart(2, '0'); return `${m}:${s}`; };
   // ü¶à SHARK MODE SYNC SYSTEM - ESCAPE PROOF ACROSS APPS ‚Üê PUT IT RIGHT HERE
function checkSharkModeSync() {
    const isEscapeProof = localStorage.getItem('escapeProof') === 'true';
    const sales = parseInt(localStorage.getItem('sharkSales') || '0');
    const targetSales = parseInt(localStorage.getItem('sharkTarget') || '16');
    
    if (isEscapeProof && sales < targetSales) {
        // Activate escape-proof mode in this app too
        window.addEventListener('beforeunload', function(e) {
            e.preventDefault();
            e.returnValue = 'üö´ SHARK MODE ACTIVE - ' + (targetSales - sales) + ' SALES NEEDED!';
            return 'üö´ SHARK MODE ACTIVE - ' + (targetSales - sales) + ' SALES NEEDED!';
        });
        
        // Show shark mode warning in your app
        if (!document.getElementById('sharkModeWarning')) {
            const warning = document.createElement('div');
            warning.id = 'sharkModeWarning';
            warning.style.cssText = 'position:fixed; top:0; left:0; right:0; background:linear-gradient(90deg, #ff0000, #ffff00, #ff0000); color:#000; padding:10px; text-align:center; font-weight:bold; z-index:9999;';
            warning.textContent = 'ü¶à SHARK MODE ACTIVE - ' + sales + '/' + targetSales + ' SALES - TAB LOCKED!';
            document.body.prepend(warning);
        }
        
        // Update sales display every second
        if (document.getElementById('sharkModeWarning')) {
            document.getElementById('sharkModeWarning').textContent = 
                'ü¶à SHARK MODE ACTIVE - ' + sales + '/' + targetSales + ' SALES - TAB LOCKED!';
        }
    } else {
        // Remove escape-proof if sales target met or mode off
        window.removeEventListener('beforeunload', arguments.callee);
        const warning = document.getElementById('sharkModeWarning');
        if (warning) warning.remove();
    }
}

// Check for shark mode every 2 seconds
setInterval(checkSharkModeSync, 2000);

// Also check immediately when page loads
document.addEventListener('DOMContentLoaded', checkSharkModeSync);
   // --- RE-ENGINEERED DATE UTILITIES (v20.5 Corrective Build) ---
   const formatDateReadable = (dateObj) => {
     if (!dateObj || !(dateObj instanceof Date)) return 'N/A';
     return dateObj.toLocaleString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
   };
   const formatDateTimeReadable = (dateStr) => {
     if (!dateStr) return 'N/A';
     const dateObj = new Date(dateStr);
     if (isNaN(dateObj)) return 'Invalid Date';
     return dateObj.toLocaleString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false });
   };
   const formatDateForInput = (date) => {
     const year = date.getFullYear();
     const month = String(date.getMonth() + 1).padStart(2, '0');
     const day = String(date.getDate()).padStart(2, '0');
     return `${year}-${month}-${day}`;
   };

   const safeOn = (id, evt, fn) => { const el = document.getElementById(id); if (el) el.addEventListener(evt, fn); };
   const showModal = id => { const el = document.getElementById(id); if (el) { el.style.display = 'flex'; if (id === 'modalDates') { document.querySelector('#datesForm').classList.remove('hidden'); document.querySelector('#datesSuccess').classList.add('hidden'); } } if (id === 'modalWheel') { document.querySelector('#wheelSpinInput').value = ''; document.querySelector('#wheelSpinSave').disabled = false; const title = document.querySelector('#wheelTitle'); const isMega = (window.currentSpinMode === 'mega'); if (title) title.textContent = isMega ? 'üéâ MEGA SPIN üéâ' : 'üéâ Fantastic! Wheel Spin üéâ'; const basePrizes = isMega ? wheelPrizes.map(x=>x*3) : wheelPrizes; drawWheel(basePrizes); } };
   window.hideModal = id => { const el = document.getElementById(id); if (el) el.style.display = 'none'; if (id === 'modalCall') { if (callTimerInterval) { clearInterval(callTimerInterval); callTimerInterval = null; } state.activeCallStart = null; } };
function applyMasterBackground() {
  if (state.settings.dynamicSky === 'on') {
    updateDynamicSky();
  } else {
    updateManualBackground();
  }
}

function updateManualBackground() {
  const body = document.body;

  // Keep other classes; only toggle ken-burns
  body.classList.toggle('ken-burns-active', !!state.settings.kenBurns);
  // Remove any dynamic sky classes set earlier
  body.classList.remove('sky-night','sky-day','sky-dawn','sky-dusk');

  // Hide sky widgets
  const sun = document.querySelector('#sun');
  const moon = document.querySelector('#moon');
  const lighthouse = document.querySelector('#lighthouseBeam-container');
  if (sun)  sun.style.opacity  = '0';
  if (moon) moon.style.opacity = '0';
  if (lighthouse) lighthouse.style.display = 'none';

  // Manual / custom background
  const bgImg = document.querySelector('#background-image');
  if (state.settings.background === 'custom' && state.settings.customBg && bgImg) {
    bgImg.src = state.settings.customBg;
    bgImg.style.opacity = '1';
    body.style.background = '#111827';
  } else {
    if (bgImg) bgImg.style.opacity = '0';
    body.style.background = state.settings.background;
  }

  // Make sure no stars remain when manual
  removeStarfield();
}

function removeStarfield() {
  const sf = document.querySelector('#starryNight');
  if (sf) sf.remove();
}

function ensureStarfield(count = 180) {
  if (document.querySelector('#starryNight')) return;

  const sf = document.createElement('div');
  sf.id = 'starryNight';
  for (let i = 0; i < count; i++) {
    const d = document.createElement('div');
    d.className = 's';
    d.style.left = (Math.random() * 100) + 'vw';
    d.style.top  = (Math.random() * 100) + 'vh';
    d.style.opacity = (0.2 + Math.random() * 0.8).toFixed(2);
    d.style.animationDelay = (Math.random() * 2.5).toFixed(2) + 's';
    sf.appendChild(d);
  }
  document.body.appendChild(sf);
}

function updateDynamicSky() {
  const h = new Date().getHours();
  const isNight = (h >= 19 || h < 6);  // 7pm‚Äì6am

  const body = document.body;
  // Keep other classes; only toggle ken-burns + sky states
  body.classList.toggle('ken-burns-active', !!state.settings.kenBurns);
  body.classList.remove('sky-dawn','sky-dusk'); // we‚Äôre using day/night only
  body.classList.toggle('sky-night', isNight);
  body.classList.toggle('sky-day', !isNight);

  // Starfield
  if (isNight) ensureStarfield(180);
  else removeStarfield();

  // Optional widgets
  const sun = document.querySelector('#sun');
  const moon = document.querySelector('#moon');
  const lighthouse = document.querySelector('#lighthouseBeam-container');
  if (sun)  sun.style.opacity  = (!isNight && state.settings.sunMoon) ? '1' : '0';
  if (moon) moon.style.opacity = ( isNight && state.settings.sunMoon) ? '1' : '0';
  if (lighthouse) lighthouse.style.display = (isNight && state.settings.lighthouse) ? 'block' : 'none';
}

// Backward-compat: if something still calls this, map to the new starfield logic
function generateStars(count) {
  if (count > 0) ensureStarfield(count);
  else removeStarfield();
}

   function animateHotelLights() { if (hotelLightsTimer) clearTimeout(hotelLightsTimer); if (!state.settings.hotelLightsOn) { $$('.hotel-window').forEach(w => w.classList.remove('lit')); return; } const windows = $$('.hotel-window'); if (windows.length === 0) return; const idx = Math.floor(Math.random() * windows.length); windows[idx].classList.toggle('lit'); const delay = (Math.random() * 4000 + 1000) * (state.settings.hotelLightsSpeed || 1.0); hotelLightsTimer = setTimeout(animateHotelLights, delay); }
   function animateLargeHotel() { if (largeHotelTimer) clearTimeout(largeHotelTimer); if (state.timeTracking.status === 'checked-out') { $$('.hotel-window-large').forEach(w => w.classList.remove('lit')); return; } const windows = $$('.hotel-window-large'); if (windows.length === 0) return; const darkWindows = windows.filter(w => !w.classList.contains('lit')); if (darkWindows.length > 0) { const windowToTurnOn = darkWindows[Math.floor(Math.random() * darkWindows.length)]; windowToTurnOn.classList.add('lit'); } else { const litWindows = windows.filter(w => w.classList.contains('lit')); if (litWindows.length > 0 && Math.random() < 0.2) { const windowToTurnOff = litWindows[Math.floor(Math.random() * litWindows.length)]; windowToTurnOff.classList.remove('lit'); } } const delay = 1500 + Math.random() * 4000; largeHotelTimer = setTimeout(animateLargeHotel, delay); }
   function renderLamps() { $$('.hotel-lamp').forEach(lamp => lamp.classList.toggle('lit', state.settings.exteriorLampsOn)); }
   function applyTheme() { const container = document.querySelector('#theme-container'); const themeKey = state.settings.activeTheme; if(!container) return; container.innerHTML = ''; if (themeKey && themeKey !== 'none' && THEME_DATA[themeKey]) { container.innerHTML = THEME_DATA[themeKey].svg; } }
   function populateQuoteSelectors() { const themeSel = document.querySelector('#quoteThemeSelector'), styleSel = document.querySelector('#quoteStyleSelector'); if(!themeSel || !styleSel) return; themeSel.innerHTML = ''; Object.keys(state.quotes).forEach(themeName => { const option = document.createElement('option'); option.value = themeName; option.textContent = themeName; themeSel.appendChild(option); }); const quoteStyles = { 'Black/Gold': 'quote-style-black-gold', 'Minimalist': 'quote-style-minimalist', 'Blueprint': 'quote-style-blueprint', 'Vintage': 'quote-style-vintage' }; styleSel.innerHTML = ''; Object.entries(quoteStyles).forEach(([name, className]) => { const option = document.createElement('option'); option.value = className; option.textContent = name; styleSel.appendChild(option); }); }
   function updateUIToState() { const status = state.timeTracking.status; const checkBtn=document.querySelector('#checkBtn'), breakBtn=document.querySelector('#breakBtn'), lunchBtn=document.querySelector('#lunchBtn'), startCall=document.querySelector('#startCall'); checkBtn.textContent = status === 'checked-out' ? '‚ñ∂ Check In' : '‚ñ† Check Out'; checkBtn.style.backgroundColor = status === 'checked-out' ? '#22c55e' : '#ef4444'; breakBtn.disabled = status !== 'checked-in'; lunchBtn.disabled = status !== 'checked-in'; startCall.disabled = status === 'checked-out'; let ledText = status.replace('-', ' ').toUpperCase(); if (status === 'on-break' || status === 'on-lunch') { document.querySelector('#overlayTitle').textContent = status === 'on-break' ? 'On Break' : 'On Lunch'; document.querySelector('#breakOverlay').style.display = 'flex'; } else { document.querySelector('#breakOverlay').style.display = 'none'; } document.querySelector('#statusLed').textContent = ledText; document.querySelector('#statusLed').className = `led-${status.startsWith('on-') ? 'on-break' : status}`; }
   function updateCallsUI() {
       const calls = (state.callRecords || []).slice().reverse();
       const recent = calls[0];
       const recentBox = document.querySelector('#mostRecentCall'), listBox = document.querySelector('#recentCalls'), allBox = document.querySelector('#allCalls');
       if (!recentBox || !listBox || !allBox) return;
       recentBox.innerHTML = ''; listBox.innerHTML = ''; allBox.innerHTML = '';
       const outcomeColors = o => { 
    const m = callOutcomes.find(x => x.outcome === o); 
    // Return default colors if outcome not found
    return m ? { bg: m.bg, border: m.border } : { bg: '#e5e7eb', border: '#6b7280' }; 
};
       function callItem(call) {
           const colors = outcomeColors(call.outcome);
           const div = document.createElement('div');
           div.className = 'p-2 rounded-lg border flex items-center justify-between gap-3';
           div.style.backgroundColor = '#f0f9ff';
           let commissionHTML = call.commissionAmount ? `<div class="text-green-700 text-base font-extrabold">${formatMoney(call.commissionAmount)}</div>` : '';
           div.innerHTML = `<div class="flex-shrink-0"><div class="font-semibold text-gray-800">${new Date(call.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div><div class="text-xs text-gray-600 mt-1">Duration: ${call.durationSec || 0}s</div>${commissionHTML}</div><div class="flex-grow text-center"><span class="text-xs sm:text-sm font-bold px-3 py-1.5 rounded-full" style="background-color:${colors.bg}; color:${colors.border}; border: 1px solid ${colors.border};">${call.outcome}</span></div><div class="flex-shrink-0"><button title="Delete this call" data-call-id="${call.id}" class="delete-call-btn text-gray-400 hover:text-red-500 p-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg></button></div>`;
           return div;
       }

       if (recent) { const big = callItem(recent); big.classList.add('ring-2', 'ring-teal-300'); recentBox.appendChild(big); } else { recentBox.innerHTML = '<div class="text-sm text-gray-600 p-4 text-center">No calls yet.</div>'; }
       const previewN = Math.max(1, parseInt(document.querySelector('#callsPreviewCount')?.value || '5', 10));
       const upcoming = calls.slice(1, 1 + previewN);
       upcoming.forEach(c => listBox.appendChild(callItem(c)));
       allBox.innerHTML = '';
       calls.forEach(c => allBox.appendChild(callItem(c)));
   }
   function drawWheel(prizes = wheelPrizes) { const canvas = document.querySelector('#wheelCanvas'); if (!canvas || !canvas.getContext) return; const ctx = canvas.getContext('2d'); const numSegments = prizes.length; const anglePerSegment = (2 * Math.PI) / numSegments; const radius = canvas.width / 2; ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.font = 'bold 20px Arial'; ctx.textBaseline = 'middle'; ctx.textAlign = 'center'; prizes.forEach((prize, i) => { const startAngle = i * anglePerSegment; const endAngle = (i + 1) * anglePerSegment; ctx.beginPath(); ctx.moveTo(radius, radius); ctx.arc(radius, radius, radius - 10, startAngle, endAngle); ctx.closePath(); ctx.fillStyle = wheelColors[i % wheelColors.length]; ctx.fill(); ctx.strokeStyle = '#4b5563'; ctx.lineWidth = 2; ctx.stroke(); ctx.save(); ctx.translate(radius, radius); ctx.rotate(startAngle + anglePerSegment / 2); ctx.fillStyle = '#1f2937'; ctx.fillText(`$${prize}`, radius - 40, 0); ctx.restore(); }); }
function drawWheel(prizes = wheelPrizes) {
    const canvas = document.querySelector('#wheelCanvas');
    if (!canvas || !canvas.getContext) return;
    const ctx = canvas.getContext('2d');
    const numSegments = prizes.length;
    const anglePerSegment = (2 * Math.PI) / numSegments;
    const radius = canvas.width / 2;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.font = 'bold 20px Arial';
    ctx.textBaseline = 'middle';
    ctx.textAlign = 'center';
    prizes.forEach((prize, i) => {
        const startAngle = i * anglePerSegment;
        const endAngle = (i + 1) * anglePerSegment;
        ctx.beginPath();
        ctx.moveTo(radius, radius);
        ctx.arc(radius, radius, radius - 10, startAngle, endAngle);
        ctx.closePath();
        ctx.fillStyle = wheelColors[i % wheelColors.length];
        ctx.fill();
        ctx.strokeStyle = '#4b5563';
        ctx.lineWidth = 2;
        ctx.stroke();
        ctx.save();
        ctx.translate(radius, radius);
        ctx.rotate(startAngle + anglePerSegment / 2);
        ctx.fillStyle = '#1f2937';
        ctx.fillText(`$${prize}`, radius - 40, 0);
        ctx.restore();
    });
} // <--- Esta llave termina drawWheel

//  PEGA LA NUEVA FUNCI√ìN UPDATE GOAL LIGHTS JUSTO AQU√ç, en este espacio.

// --- FUNCI√ìN CORREGIDA: GOAL LIGHTS ALEATORIAS ---
function updateGoalLights() {
    // 1. Check if Goal Lights Mode is even enabled. If not, do nothing.
    if (!state.settings.goalLightsMode) {
        return;
    }

    // 2. Count ACTIVE sales (ignore cancelled reservations)
    const activeSalesCount = state.reservations.filter(r => r.status !== 'cancelled').length;
    // We have 16 windows. Calculate how many should be lit.
    const lightsToTurnOn = Math.min(activeSalesCount, 16);

    // 3. First, turn ALL lights OFF
    $$('.hotel-window').forEach(window => window.classList.remove('lit'));
    $$('.hotel-window-large').forEach(window => window.classList.remove('lit'));

    // 4. Get ALL windows (small and large) into one big list
    const allWindows = [...$$('.hotel-window'), ...$$('.hotel-window-large')];
    
    // 5. Mezclamos (shuffle) la lista de ventanas para obtener un orden aleatorio
    const shuffledWindows = allWindows.sort(() => Math.random() - 0.5);
    
    // 6. Now, turn on the first 'X' windows from the RANDOMIZED list
    for (let i = 0; i < lightsToTurnOn; i++) {
        if (shuffledWindows[i]) {
            shuffledWindows[i].classList.add('lit');
        }
    }

    // 7. IMPORTANTE: SI el modo goal est√° activo, FORZAR que las luces autom√°ticas est√©n APAGADAS.
    state.settings.hotelLightsOn = false;
    document.querySelector('#toggleLights').checked = false; // Actualiza el checkbox tambi√©n
    // Detener los timers de las animaciones viejas
    if (hotelLightsTimer) {
        clearTimeout(hotelLightsTimer);
        hotelLightsTimer = null;
    }
    if (largeHotelTimer) {
        clearTimeout(largeHotelTimer);
        largeHotelTimer = null;
    }
}
   const getSettledDateForReservation = (checkOutDate) => { const date = new Date(checkOutDate); date.setDate(date.getDate() + 7); return date; };
   const calculatePayDate = (settledDate) => { const d = new Date(settledDate); const day = d.getDate(); if (day <= 15) { return new Date(d.getFullYear(), d.getMonth(), 21); } else { return new Date(d.getFullYear(), d.getMonth() + 1, 6); } };
   const getPayPeriodsForMonth = (refDate) => { const y = refDate.getFullYear(), m = refDate.getMonth(); const p1Start = new Date(y, m, 1); const p1End = new Date(y, m, 15); const p2Start = new Date(y, m, 16); const eom = new Date(y, m + 1, 0); const p2End = new Date(y, m, eom.getDate()); return [ { earningStart: p1Start, earningEnd: p1End, payDate: new Date(y, m, 21) }, { earningStart: p2Start, earningEnd: p2End, payDate: new Date(y, m + 1, 6) } ]; };
   function renderQuincenaOverview() {
       const all = [];
       (state.reservations || []).filter(r => r.status !== 'cancelled').forEach(res => { const settledDate = getSettledDateForReservation(res.checkOutDate); all.push({ source: `Sale #${res.id}`, settledDate, amount: res.commissionAmount || 0, payDate: calculatePayDate(settledDate), type: 'reservation', id: res.id }); });
       (state.wheelSpins || []).forEach(spin => { const settledDate = new Date(spin.timestamp); all.push({ source: `Bonus #${spin.id}`, settledDate, amount: spin.amount || 0, payDate: calculatePayDate(settledDate), type: 'wheelSpin', id: spin.id }); });
       const refDate = new Date(state.ui.quincenaViewDate);
       const [p1, p2] = getPayPeriodsForMonth(refDate);
       const current = refDate.getDate() <= 15 ? p1 : p2;
       document.querySelector('#qNow').textContent = `${formatDateReadable(current.earningStart)} - ${formatDateReadable(current.earningEnd)}`;
       document.querySelector('#q1Payday').textContent = formatDateReadable(p1.payDate);
       document.querySelector('#q2Payday').textContent = formatDateReadable(p2.payDate);
       const q1Total = all.filter(x => x.payDate.getTime() === p1.payDate.getTime()).reduce((s, x) => s + x.amount, 0);
       const q2Total = all.filter(x => x.payDate.getTime() === p2.payDate.getTime()).reduce((s, x) => s + x.amount, 0);
       document.querySelector('#q1Total').textContent = formatMoney(q1Total);
       document.querySelector('#q2Total').textContent = formatMoney(q2Total);
       const settling = all.filter(x => x.settledDate >= current.earningStart && x.settledDate <= current.earningEnd).sort((a, b) => a.settledDate - b.settledDate);
       const tbody = document.querySelector('#qSettlingTbody');
       tbody.innerHTML = '';
       if (settling.length === 0) {
           tbody.innerHTML = '<tr><td colspan="5" class="p-2 text-slate-500">No settlements in this quincena.</td></tr>';
       } else {
           settling.forEach(item => {
               const tr = document.createElement('tr');
               tr.className = 'border-b border-indigo-100';
               let actionCell = '';
               if (item.type === 'reservation') { actionCell = `<button data-del-id="${item.id}" class="text-xs px-2 py-1 rounded bg-red-200 text-red-800 hover:bg-red-300">Delete</button>`; } 
               else if (item.type === 'wheelSpin') { actionCell = `<button data-del-spin-id="${item.id}" class="text-xs px-2 py-1 rounded bg-red-200 text-red-800 hover:bg-red-300">Delete</button>`; }
               tr.innerHTML = `<td class="p-2">${item.source}</td><td class="p-2">${formatDateReadable(item.settledDate)}</td><td class="p-2">${formatDateReadable(item.payDate)}</td><td class="p-2 text-right font-semibold">${formatMoney(item.amount)}</td><td class="p-2 text-center">${actionCell}</td>`;
               tbody.appendChild(tr);
           });
       }
   }
   function renderAllReservationsTable() {
       const tbody = document.querySelector('#reservationsTbody');
       tbody.innerHTML = '';
       const sortedReservations = (state.reservations || []).sort((a, b) => new Date(a.checkInDate) - new Date(b.checkInDate));
       
       sortedReservations.forEach(r => {
           const tr = document.createElement('tr');
           const isCancelled = r.status === 'cancelled';
           tr.className = `border-b ${isCancelled ? 'bg-gray-100 text-gray-500' : ''}`;
           const settledDate = getSettledDateForReservation(r.checkOutDate);
           const payDate = calculatePayDate(settledDate);
           let actionButtons = '';
           if (isCancelled) {
               actionButtons = `<button data-reinstate-id="${r.id}" class="text-xs px-2 py-1 rounded bg-green-500 text-white">Re-instate</button>`;
           } else {
               actionButtons = `<button data-cancel-id="${r.id}" class="text-xs px-2 py-1 rounded bg-yellow-500 text-white mr-1">Cancel</button>`;
           }
           actionButtons += `<button data-del-id="${r.id}" class="text-xs px-2 py-1 rounded bg-red-500 text-white">Delete</button>`;
           const dateDisplay = `${formatDateReadable(new Date(r.checkInDate))} ‚Üí ${formatDateReadable(new Date(r.checkOutDate))}`;
           tr.innerHTML = `<td>${r.id}</td><td>${r.guestName || 'N/A'}</td><td>${dateDisplay}</td><td>${formatDateReadable(settledDate)}</td><td>${formatDateReadable(payDate)}</td><td class="text-right">${formatMoney(r.commissionAmount)}</td><td><span class="status-badge ${isCancelled ? 'status-cancelled' : 'status-pending'}">${r.status}</span></td><td>${actionButtons}</td>`;
           tbody.appendChild(tr);
       });
   }
   function renderMonthlyReview(){ const date=state.ui.monthlyViewDate; document.querySelector('#monthlyReviewTitle').textContent = `Daily Performance for ${date.toLocaleString('default', { month: 'long', year: 'numeric' })}`; const container=document.querySelector('#monthlyReviewContent'); container.innerHTML=''; const y=date.getFullYear(), m=date.getMonth(); const daysInMonth=new Date(y, m+1, 0).getDate(); const today = new Date(); for(let d=1; d<=daysInMonth; d++){ const cur=new Date(y,m,d); const start=new Date(cur); start.setHours(0,0,0,0); const end=new Date(cur); end.setHours(23,59,59,999); const isToday = cur.toDateString() === today.toDateString(); let dailyWorkSeconds=(state.workSessions||[]).filter(s=>s.start>=start&&s.start<=end).reduce((sum,s)=>sum+((s.end-s.start)/1000),0); if (isToday) { dailyWorkSeconds = state.timeTracking.todayWorkSeconds; if (state.timeTracking.status === 'checked-in' && state.timeTracking.lastStatusChange) { dailyWorkSeconds += Math.floor((new Date() - state.timeTracking.lastStatusChange) / 1000); } } const callsToday = (state.callRecords||[]).filter(c => c.timestamp >= start && c.timestamp <= end); const dailySales = callsToday.filter(c => c.outcome === 'Successful Sale').length; const dailyCalls = callsToday.length; const conversionRate = dailyCalls > 0 ? (dailySales / dailyCalls) * 100 : 0; let cardStyleClass = 'bg-red-100 border-red-200'; let rateColorClass = 'text-red-600 font-bold'; if (conversionRate >= 25) { cardStyleClass = 'bg-green-100 border-green-200'; rateColorClass = 'text-green-600 font-bold'; } else if (conversionRate >= 15) { cardStyleClass = 'bg-yellow-100 border-yellow-200'; rateColorClass = 'text-yellow-600 font-bold'; } const dayEl=document.createElement('div'); dayEl.className=`performance-day ${cardStyleClass}`; const timeDisplayHTML = isToday ? `<p id="today-monthly-log-time">${formatTime(dailyWorkSeconds)}</p>` : `<p>${formatTime(dailyWorkSeconds)}</p>`; dayEl.innerHTML=`<div class="font-bold">${cur.toLocaleDateString(undefined,{weekday:'short',day:'numeric'})}</div><div class="mt-2 text-sm text-gray-700 grid grid-cols-2 gap-2"><div><p class="font-semibold">Time:</p>${timeDisplayHTML}</div><div><p class="font-semibold">Calls:</p><p>${dailyCalls}</p></div><div><p class="font-semibold">Sales:</p><p>${dailySales}</p></div><div><p class="font-semibold">Conv. Rate:</p><p class="${rateColorClass}">${conversionRate.toFixed(1)}%</p></div></div>`; container.appendChild(dayEl); } }
   function updateSpinIndicator() {
  // Real sales (do NOT modify these)
  const activeSales = (state.reservations || []).filter(r => r.status !== 'cancelled').length;

  // Visual offset set by the "Reset Wheel Spins" button
  const spinOffset = (state.settings && typeof state.settings.spinOffset === 'number')
    ? state.settings.spinOffset
    : 0;

  // Adjusted visual count (what the progress shows)
  const adjusted = Math.max(0, activeSales - spinOffset);

  // Progress within cycles (regular: 4, mega: 16)
  const s4  = adjusted > 0 ? (adjusted % 4  || 4)  : 0;
  const s16 = adjusted > 0 ? (adjusted % 16 || 16) : 0;

  // Percentages
  const regPct  = (s4  / 4)  * 100;
  const megaPct = (s16 / 16) * 100;

  // Update UI numbers/bars
  document.querySelector('#spinCurrentSales').textContent = adjusted;
  document.querySelector('#spinNextRegular').textContent  = `${s4}/4`;
  document.querySelector('#spinNextMega').textContent     = `${s16}/16`;
  document.querySelector('#spinRegProgress').style.width  = `${regPct}%`;
  document.querySelector('#spinMegaProgress').style.width = `${megaPct}%`;

  // Badge: show exactly at multiples of 4 (visual). Rename to SPIN SAVED (green).
  const badge = document.querySelector('#spinReadyBadge');
  if (badge) {
    const show = adjusted > 0 && adjusted % 4 === 0;
    badge.textContent = 'SPIN SAVED';
    badge.classList.toggle('hidden', !show);
    badge.classList.add('bg-green-500');
  }
}

   function updateAllUI() {
     const todayStart = new Date();
     todayStart.setHours(0, 0, 0, 0);
     const weekStart = new Date();
     weekStart.setDate(weekStart.getDate() - (weekStart.getDay() || 7) + 1);
     weekStart.setHours(0, 0, 0, 0);

     const resetTimestamp = state.ui.todayPerformanceResetTimestamp;
     const activeRes = (state.reservations || []).filter(r => r.status !== 'cancelled');
     const spins = (state.wheelSpins || []);
     const calls = (state.callRecords || []);
     const successfulCalls = calls.filter(c => c.outcome === 'Successful Sale').length;

     document.querySelector('#callsWithoutSale').textContent = state.callsWithoutSale;
     document.querySelector('#totalSpins').textContent = formatMoney(spins.reduce((s, w) => s + (w.amount || 0), 0));
     document.querySelector('#totalCommissions').textContent = formatMoney(activeRes.reduce((s, r) => s + (r.commissionAmount || 0), 0));
     document.querySelector('#salesCount').textContent = activeRes.length;
     
     // --- NEW LOGIC FOR OVERALL CONVERSION COLOR ---
     const conv = calls.length > 0 ? (successfulCalls / calls.length) * 100 : 0;
     const convEl = document.querySelector('#conversionRate');
     if(convEl) {
        const parentBox = convEl.parentElement;
        convEl.textContent = conv.toFixed(1) + '%';
        convEl.style.color = conv >= 25 ? '#166534' : '#991b1b';
        parentBox.style.backgroundColor = conv >= 25 ? '#dcfce7' : '#fee2e2';
          //... (all the other code in the function)
     document.querySelector('#breakTime').textContent = formatTime(state.timeTracking.todayBreakSeconds);
     document.querySelector('#lunchTime').textContent = formatTime(state.timeTracking.todayLunchSeconds);

     // --- NEW LINE TO ADD ---
     if (document.querySelector('#appTitle')) document.querySelector('#appTitle').textContent = state.config.appName;
        //... (all the other code in the function)
     if (document.querySelector('#appTitle')) document.querySelector('#appTitle').textContent = state.config.appName;

     // --- NEW LOGIC FOR FEATURE TOGGLES ---
     if (document.querySelector('#spinProgressSection')) {
       const isEnabled = state.config.featureToggles?.wheelSpins !== false; // Default to true if not specified
       document.querySelector('#spinProgressSection').classList.toggle('hidden', !isEnabled);
     }
   }
     // --- END OF NEW LOGIC ---

     const todayFilter = (item) => { const itemDate = item.bookingDate || item.timestamp; return new Date(itemDate) >= todayStart && (!resetTimestamp || new Date(itemDate) >= resetTimestamp); };
     const todayRes = activeRes.filter(todayFilter);
     const todayCalls = calls.filter(todayFilter);
     const todaySpins = spins.filter(todayFilter);
     document.querySelector('#todayCommissions').textContent = formatMoney(todayRes.reduce((s, r) => s + (r.commissionAmount || 0), 0));
     document.querySelector('#todayCalls').textContent = todayCalls.length;
     document.querySelector('#todaySalesCount').textContent = todayCalls.filter(c => c.outcome === 'Successful Sale').length;
     document.querySelector('#todayWheelSpins').textContent = todaySpins.length;
     document.querySelector('#todaySpinEarnings').textContent = formatMoney(todaySpins.reduce((s, w) => s + (w.amount || 0), 0));
     document.querySelector('#todayPerformanceWorkedTime').textContent = formatTime(state.timeTracking.todayWorkSeconds);

     const weekRes = activeRes.filter(r => new Date(r.bookingDate) >= weekStart);
     const weekCalls = calls.filter(c => new Date(c.timestamp) >= weekStart);
     const weekSuccessfulCalls = weekCalls.filter(c => c.outcome === 'Successful Sale').length;
     const weekSpins = spins.filter(w => new Date(w.timestamp) >= weekStart);
     let weekWorkSeconds = (state.workSessions || []).filter(s => new Date(s.start) >= weekStart).reduce((sum, s) => sum + (new Date(s.end) - new Date(s.start)) / 1000, 0);
     if (state.timeTracking.status === 'checked-in' && state.timeTracking.lastStatusChange && new Date(state.timeTracking.lastStatusChange) >= weekStart) {
       weekWorkSeconds += (new Date() - new Date(state.timeTracking.lastStatusChange)) / 1000;
     }
     const weekConv = weekCalls.length > 0 ? (weekSuccessfulCalls / weekCalls.length) * 100 : 0;
     const weekConvEl = document.querySelector('#weekConversionRate');
     
     document.querySelector('#weekReservations').textContent = weekRes.length;
     document.querySelector('#weekCommissions').textContent = formatMoney(weekRes.reduce((s, r) => s + (r.commissionAmount || 0), 0) + weekSpins.reduce((s, w) => s + (w.amount || 0), 0));
     document.querySelector('#weekCalls').textContent = weekCalls.length;
     document.querySelector('#weekSuccessfulCalls').textContent = weekSuccessfulCalls;
     document.querySelector('#weekWorkedTime').textContent = formatTime(weekWorkSeconds);
     if(weekConvEl) {
        const parentBox = weekConvEl.parentElement;
        weekConvEl.textContent = weekConv.toFixed(1) + '%';
        weekConvEl.style.color = weekConv >= 25 ? '#166534' : '#991b1b';
        parentBox.style.backgroundColor = weekConv >= 25 ? '#d1fae5' : '#fee2e2';
     }

     applyMasterBackground();
     updateCallsUI();
     updateSpinIndicator();
     renderQuincenaOverview();
     renderAllReservationsTable();
     renderMonthlyReview();
     populateQuoteSelectors();
     updateUIToState();
     renderLamps();
     applyTheme();
     if (!state.timeTracking || state.timeTracking.status !== 'checked-in') {
  document.querySelector('#todayWorkTime').textContent = formatTime(state.timeTracking.todayWorkSeconds);
}
     document.querySelector('#breakTime').textContent = formatTime(state.timeTracking.todayBreakSeconds);
     document.querySelector('#lunchTime').textContent = formatTime(state.timeTracking.todayLunchSeconds);
   }
function celebrate(level = 'sale') { if (typeof window.confetti !== 'function') return; const intensity = state.confettiIntensity || 1.0; let config = { particleCount: Math.floor(250 * intensity), spread: 120, startVelocity: 40, origin: { y: 0.6 } }; if (level === 'spin') config = { ...config, particleCount: Math.floor(400 * intensity), spread: 160 }; if (level === 'mega') config = { ...config, particleCount: Math.floor(800 * intensity), spread: 180 }; confetti(config); }
   function spinWheel(targetAmount) { const canvas = document.querySelector('#wheelCanvas'), isMega = (currentSpinMode === 'mega'), basePrizes = isMega ? wheelPrizes.map(x => x * 3) : wheelPrizes, prizes = [...basePrizes], numSegments = prizes.length, anglePerSegmentDeg = 360 / numSegments, targetIndex = 0; prizes[targetIndex] = targetAmount; drawWheel(prizes); const pointerDeg = 270, targetCenterDeg = targetIndex * anglePerSegmentDeg + anglePerSegmentDeg / 2, fullSpins = 5 + Math.floor(Math.random() * 2), finalRotation = fullSpins * 360 + (pointerDeg - targetCenterDeg); canvas.style.transition = 'transform 5s cubic-bezier(0.25, 0.1, 0.25, 1)'; canvas.style.transform = `rotate(${finalRotation}deg)`; setTimeout(() => { state.wheelSpins.push({ id: state.nextWheelId++, amount: targetAmount, timestamp: new Date(), mega: isMega, reservationId: currentReservationIdForSpin }); currentReservationIdForSpin = null; save(); updateAllUI(); hideModal('modalWheel'); celebrate(isMega ? 'mega' : 'spin'); setTimeout(() => { canvas.style.transition = 'none'; canvas.style.transform = 'rotate(0deg)'; drawWheel(); setTimeout(() => { canvas.style.transition = 'transform 5s cubic-bezier(0.25, 0.1, 0.25, 1)'; }, 50); }, 500); window.currentSpinMode = 'regular'; }, 5200); }
   function showQuote(isModal) { const themeKey = document.querySelector('#quoteThemeSelector').value; const theme = state.quotes[themeKey]; if (!theme || theme.length === 0) { showToast(`No quotes in theme "${themeKey}".`, "error"); return; } const quote = theme[Math.floor(Math.random() * theme.length)]; if (isModal) { document.querySelector('#quoteText').textContent = `‚Äú${quote.text}‚Äù`; document.querySelector('#quoteAuthor').textContent = `‚Äî ${quote.author}`; document.querySelector('#quoteModalContent').className = 'quote-modal-content ' + document.querySelector('#quoteStyleSelector').value; document.querySelector('#quoteModal').classList.add('active'); } else { document.querySelector('#ambientQuote').textContent = `‚Äú${quote.text}‚Äù ‚Äî ${quote.author}`; document.querySelector('#ambientQuote').classList.remove('fade-out'); } }
   function hideQuote() { document.querySelector('#quoteModal').classList.remove('active'); }
   function updateAmbientQuotes() { clearInterval(ambientQuoteInterval); if (state.settings.autoQuotes) { showQuote(false); ambientQuoteInterval = setInterval(() => { document.querySelector('#ambientQuote').classList.add('fade-out'); setTimeout(() => showQuote(false), 700); }, 15000); } else { document.querySelector('#ambientQuote').classList.add('fade-out'); } }
   function handleQuoteFileUpload() { const themeName = document.querySelector('#newQuoteThemeName').value.trim(), file = document.querySelector('#quoteFileUpload').files[0]; if (!themeName || !file) { showToast("Provide a name and file.", "error"); return; } const reader = new FileReader(); reader.onload = (e) => { try { const newQuotes = JSON.parse(e.target.result); if (!Array.isArray(newQuotes) || !newQuotes.every(q => q.text && q.author)) throw new Error("Invalid format."); state.quotes[themeName] = newQuotes; populateQuoteSelectors(); document.querySelector('#quoteThemeSelector').value = themeName; save(); showToast(`Theme "${themeName}" uploaded!`, "success"); document.querySelector('#newQuoteThemeName').value = ''; document.querySelector('#quoteFileUpload').value = ''; } catch (err) { showToast("Invalid JSON.", "error"); } }; reader.readAsText(file); }
   function handleCheckIn() { state.timeTracking.status = 'checked-in'; state.timeTracking.lastStatusChange = new Date(); startMasterTimer(); animateLargeHotel(); updateUIToState(); showToast("Checked in!", "success"); save(); }
   function handleCheckOut() { if (!confirm("Check out?")) return; updateTotalsBeforeStateChange(); state.timeTracking.status = 'checked-out'; state.timeTracking.lastStatusChange = null; stopMasterTimer(); clearTimeout(largeHotelTimer); largeHotelTimer = null; $$('.hotel-window-large').forEach(w => w.classList.remove('lit')); updateUIToState(); document.querySelector('#liveWorkTime').textContent = '00:00:00'; save(); updateAllUI(); }
   function handleStartBreak(type) { if (state.timeTracking.status !== 'checked-in') return; updateTotalsBeforeStateChange(); state.timeTracking.status = type === 'break' ? 'on-break' : 'on-lunch'; state.timeTracking.lastStatusChange = new Date(); updateUIToState(); save(); }
   function handleEndBreak() { updateTotalsBeforeStateChange(); state.timeTracking.status = 'checked-in'; state.timeTracking.lastStatusChange = new Date(); updateUIToState(); save(); }
   function startMasterTimer() { if (masterTimerInterval) clearInterval(masterTimerInterval); masterTimerInterval = setInterval(updateTimers, 1000); }
   function stopMasterTimer() { clearInterval(masterTimerInterval); masterTimerInterval = null; }
   function updateTimers() { if (state.timeTracking.status === 'checked-out') return; const now = new Date(); const lastChange = state.timeTracking.lastStatusChange ? new Date(state.timeTracking.lastStatusChange) : now; const liveSeconds = Math.floor((now - lastChange) / 1000); const todayWorkLive = state.timeTracking.todayWorkSeconds + (state.timeTracking.status === 'checked-in' ? liveSeconds : 0); if (state.timeTracking.status === 'checked-in') { document.querySelector('#liveWorkTime').textContent = formatTime(liveSeconds); document.querySelector('#todayWorkTime').textContent = formatTime(todayWorkLive); } else { const total = (state.timeTracking.status === 'on-break' ? state.timeTracking.todayBreakSeconds : state.timeTracking.todayLunchSeconds) + liveSeconds; document.querySelector('#overlayTimer').textContent = formatTime(liveSeconds); if (state.timeTracking.status === 'on-break') document.querySelector('#breakTime').textContent = formatTime(total); else document.querySelector('#lunchTime').textContent = formatTime(total); } const todayMonthlyLogTimeEl = document.querySelector('#today-monthly-log-time'); if(todayMonthlyLogTimeEl) { todayMonthlyLogTimeEl.textContent = formatTime(todayWorkLive); } }
   function updateTotalsBeforeStateChange() { if (!state.timeTracking.lastStatusChange) return; const lastChange = new Date(state.timeTracking.lastStatusChange); const elapsed = Math.floor((new Date() - lastChange) / 1000); if (state.timeTracking.status === 'checked-in') { const start = lastChange; const end = new Date(); state.workSessions.push({ start, end }); state.timeTracking.todayWorkSeconds += elapsed; } if (state.timeTracking.status === 'on-break') state.timeTracking.todayBreakSeconds += elapsed; if (state.timeTracking.status === 'on-lunch') state.timeTracking.todayLunchSeconds += elapsed; }
   function resetTodayPerformance() {
  if (!confirm("Reset TODAY's performance? This will zero today's worked/break/lunch timers and restart from now. Weekly totals stay untouched.")) return;

  const now = new Date();

  // Close any live segment first so state is consistent before the reset.
  try {
    if (typeof updateTotalsBeforeStateChange === 'function') {
      updateTotalsBeforeStateChange();
    } else if (state?.timeTracking?.lastStatusChange) {
      const last = new Date(state.timeTracking.lastStatusChange);
      const elapsed = Math.floor((now - last) / 1000);
      if (elapsed > 0 && state?.timeTracking) {
        if (state.timeTracking.status === 'checked-in') {
          state.timeTracking.todayWorkSeconds = (state.timeTracking.todayWorkSeconds || 0) + elapsed;
        } else if (state.timeTracking.status === 'on-break') {
          state.timeTracking.todayBreakSeconds = (state.timeTracking.todayBreakSeconds || 0) + elapsed;
        } else if (state.timeTracking.status === 'on-lunch') {
          state.timeTracking.todayLunchSeconds = (state.timeTracking.todayLunchSeconds || 0) + elapsed;
        }
      }
    }
  } catch (e) {
    console.warn("updateTotalsBeforeStateChange failed:", e);
  }

  // Mark reset point for "Today" views that honor this timestamp (does not affect weekly).
  if (!state.ui) state.ui = {};
  state.ui.todayPerformanceResetTimestamp = now;

  // Hard reset today's counters.
  if (!state.timeTracking) state.timeTracking = {};
  state.timeTracking.todayWorkSeconds = 0;
  state.timeTracking.todayBreakSeconds = 0;
  state.timeTracking.todayLunchSeconds = 0;

  // Restart timing from now if user is not checked-out.
  if (state.timeTracking.status !== 'checked-out') {
    state.timeTracking.lastStatusChange = now;
  } else {
    state.timeTracking.lastStatusChange = null;
  }

  // Persist & refresh UI immediately.
  save();
  updateAllUI();

  // Force the visible "Today's Worked Time" to 00:00:00 right away.
  const t = document.querySelector('#todayPerformanceWorkedTime');
  if (t) t.textContent = formatTime(0);

  showToast("Today's performance has been reset.", "success");
}
   function resetWeekPerformance() { if (!confirm("Reset all performance data for THIS WEEK? This will permanently delete calls and reservations from this week. (Spins are kept).")) return; const weekStart = new Date(); weekStart.setDate(weekStart.getDate() - (weekStart.getDay() || 7) + 1); weekStart.setHours(0,0,0,0); state.reservations = state.reservations.filter(r => new Date(r.bookingDate) < weekStart); state.callRecords = state.callRecords.filter(c => new Date(c.timestamp) < weekStart); state.workSessions = state.workSessions.filter(s => new Date(s.start) < weekStart); state.timeTracking.todayWorkSeconds = 0; state.timeTracking.todayBreakSeconds = 0; state.timeTracking.todayLunchSeconds = 0; state.ui.todayPerformanceResetTimestamp = null; save(); updateAllUI(); showToast("This week's performance data has been reset."); }
   
   function gapiLoaded() { 
    gapi.load('client', initializeGapiClient); 
}

function gisLoaded() { 
    gisInited = true; 
    maybeEnableAndInitClient(); 
}

async function initializeGapiClient() { 
    try {
        await gapi.client.init({
            discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4']
        });
        gapiInited = true;
        console.log('‚úÖ Google Sheets API initialized!');
        maybeEnableAndInitClient();
    } catch (err) {
        console.error("GAPI init error:", err);
        showToast('Failed to initialize Google Sheets API', 'error');
    }
}

function maybeEnableAndInitClient() { 
    console.log('Checking Google APIs - gapiInited:', gapiInited, 'gisInited:', gisInited);
    
    if (gapiInited && gisInited && typeof google !== 'undefined' && google.accounts) { 
        const clientId = state.settings.googleClientId; 
        
        if (clientId) { 
            try {
                tokenClient = google.accounts.oauth2.initTokenClient({ 
                    client_id: clientId, 
                    scope: 'https://www.googleapis.com/auth/spreadsheets',
                    callback: async (tokenResponse) => { 
                        if (tokenResponse.error) { 
                            console.error('Token error:', tokenResponse.error);
                            showToast('Authorization failed', 'error');
                            return;
                        }
                        gapiAccessToken = tokenResponse.access_token; 
                        gapi.client.setToken({ access_token: gapiAccessToken });
                        console.log('‚úÖ Google Sheets token set:', gapiAccessToken);
                        updateSigninStatus(true); 
                        showToast('Authorization successful!', 'success'); 
                        await syncToGoogleSheet(); 
                    } 
                }); 
                console.log('‚úÖ Token client initialized successfully');
                document.querySelector('#authButton').disabled = false;
                document.querySelector('#googleAuthStatus').textContent = 'Status: Ready to Authorize';
            } catch (error) {
                console.error('Error initializing token client:', error);
                document.querySelector('#googleAuthStatus').textContent = 'Status: Initialization Failed';
            }
        } else { 
            document.querySelector('#authButton').disabled = true;
            document.querySelector('#googleAuthStatus').textContent = 'Status: Client ID Missing';
        } 
    } else {
        console.log('Google APIs not ready yet, waiting...');
        document.querySelector('#authButton').disabled = true;
        document.querySelector('#googleAuthStatus').textContent = 'Status: Loading Google APIs...';
        
        // Retry in 1 second if APIs aren't ready
        setTimeout(maybeEnableAndInitClient, 1000);
    }
}


   
async function handleIntelligenceAnalysis() {
    const searchInput = document.querySelector('#searchInput').value.trim();
    const checkInDate = document.querySelector('#intelligenceCheckInDate').value;
    const btn = document.querySelector('#analyzeBtn');
    const resultsEl = document.querySelector('#intelligenceResults');
    
    if (!searchInput || !checkInDate) { showToast("Address/City and Check-in Date are required.", "error"); return; }
    
    btn.disabled = true;
    btn.innerHTML = `<svg class="animate-spin h-5 w-5 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;
    resultsEl.innerHTML = `<p class="text-slate-500 text-center py-10">Verifying location and fetching events...</p>`;

    try {
        // First get location coordinates
        const geoResponse = await fetch(`https://photon.komoot.io/api/?q=${encodeURIComponent(searchInput)}&limit=10`);
        const geoData = await geoResponse.json();
        
        if (!geoData.features || geoData.features.length === 0) {
            throw new Error("Location not found. Please try a more specific address.");
        }
        
        const location = geoData.features[0];
        const [lng, lat] = location.geometry.coordinates;
        window.currentLat = lat;
        window.currentLng = lng;
        window.currentLat = lat;
        window.currentLng = lng;
        // Get PredictHQ API key
        const predictHQKey = await idbKeyval.get('PREDICTHQ_API_KEY');
        if (!predictHQKey) {
            throw new Error("PredictHQ API key not found. Please save your API key first.");
        }
        
        // Calculate date range (check-in -> +2 days)
        const startDate = new Date(checkInDate);
        const endDate = new Date(startDate);
        endDate.setDate(endDate.getDate() + 2);
        
        const formatDateForAPI = (date) => date.toISOString().split('T')[0];
       
        // Fetch events from PredictHQ + Ticketmaster + Eventbrite
const [phqResponse] = await Promise.all([
  fetch(
    `https://api.predicthq.com/v1/events/?` +
    `category=sports,concerts,conferences,festivals,expos,public-holidays,public-holidays` +
    `&within=${Math.round(SEARCH_RADIUS_MILES * 1.60934)}km@${lat},${lng}` +
    `&active.gte=${formatDateForAPI(startDate)}` +
    `&active.lte=${formatDateForAPI(endDate)}` +
    `&rank.gte=0` +
    `&phq_attendance.gte=0`+
    `&limit=10` +
    `&sort=rank`,
    {
      headers: {
        'Authorization': `Bearer ${predictHQKey}`,
        'Accept': 'application/json'
      }
    }
  ),
  
]);



const [phqData] = await Promise.all([
  phqResponse.json(),
  
  
]);

// Merge into one array
const allEvents = Array.isArray(phqData?.results) ? phqData.results : [];

        
        // Format the response to match what your render function expects
        const formattedData = {
            location_name: searchInput,
            compression_score: (() => {
  try {
    const arr = Array.isArray(phqData?.results) ? phqData.results : [];
    const total = arr.reduce((s, e) => s + (Number.isFinite(e.phq_attendance) ? e.phq_attendance : 0), 0);
    return Math.min(100, Math.round(total / 300000 * 100));
  } catch(_) { return 65; }
})(),
            market_intel: (() => {
  const arr = Array.isArray(phqData?.results) ? phqData.results : [];

  // Palabras a excluir: community/family/social/meses/d√≠as ‚Äúinternacionales‚Äù gen√©ricos
  const bannedRe = /\b(community|famil(y|ia)|social|awareness|observance|heritage|hispanic heritage month|pride month|black history month|women'?s history month|international (day|week|month)|world (day|week|month))\b/i;

  // Boost por categor√≠a y keywords ‚Äúwow‚Äù
  const catBoost = { concerts: 30, sports: 25, festivals: 15, conferences: 10, expos: 10 };
  const wowKeys = [
    'nfl','nba','nhl','mlb','ncaa','ufc','boxing','formula 1','f1','nascar',
    'playoff','final','championship','bowl','grand prix',
    'comic-con','expo','world tour','stadium','arena','amphitheater','convention center'
  ];

  const curated = arr
    .filter(e => {
      const catOK = ['sports','concerts','conferences','festivals','expos'].includes(e.category);
      const att   = Number.isFinite(e.phq_attendance) ? e.phq_attendance : 0;
      const rank  = typeof e.rank === 'number' ? e.rank : 0;
      const title = (e.title || '');
      const desc  = (e.description || '');
      const labelsStr = Array.isArray(e.labels) ? e.labels.join(' ') : '';

      // Bloquear community/family/social/observances/‚Äúmonth/week/day‚Äù globales
      const text = `${title} ${desc} ${labelsStr}`;
      const genericMonthOrDay = /\b(month|week|day)\b/i.test(title) && /(international|world|heritage|awareness)/i.test(title);

      return catOK && att >= 500 && rank >= 70 && !bannedRe.test(text) && !genericMonthOrDay;
    })
    .map(e => {
      const att   = Number.isFinite(e.phq_attendance) ? e.phq_attendance : 0;
      const rank  = typeof e.rank === 'number' ? e.rank : 0;
      const ts    = e.start ? new Date(e.start).getTime() : 0;
      const catB  = catBoost[e.category] || 0;
      const title = (e.title || '').toLowerCase();

      let kwBoost = 0;
      for (const k of wowKeys) if (title.includes(k)) kwBoost += 200;

      const score = att * 1 + rank * 100 + catB + kwBoost;
      return { _e: e, _score: score, _ts: ts };
    })
    .sort((a, b) => (b._score - a._score) || (a._ts - b._ts))
    .map(x => x._e)
    .slice(0, 12); // corta a los 12 mejores

  // Devuelve en el mismo formato que ya usas
  return curated.map(event => ({
    name: event.title,
    start_datetime: event.start,
    attendance: Number.isFinite(event.phq_attendance) ? event.phq_attendance : null,
    rank: (typeof event.rank === 'number') ? event.rank : null,
    category: event.category || 'event',
    venue: (event.entities || []).find(en => en.type === 'venue')?.name || null
  }));
})(),

            concierge_corner: [
                "Local museums and cultural centers",
                "Fine dining restaurants in the area", 
                "Shopping districts and malls",
                "Parks and recreational areas",
                "Historical landmarks and tours"
            ],
            playbook: {
                response_scenarios: {
                    yes_event: "Excellent choice. This event is drawing in a large crowd and the rooms are selling fast because of that, let me help you find the best rate available right away, please allow me one moment.",
                    no_work: "I understand, given the high demand in the area due to the mentioned events the rooms are selling fast, let me help you find the best available rate right away.",
                    no_visiting: "The online rates are cheaper because those type of discounted rooms are the first ones to be relocated in case the hotel overbooks, my rate is a guranteed rate and cannot be cancelled by the hotel, want me to grab it for you?",
                    no_shopping: "I understand. Just be aware that hotel availability can change quickly with local demand.",
                    no_funeral: "I'm very sorry for your loss. We'll find you a quiet, comfortable room away from any crowds."
                },
                rebuttals: {
online_price: "The online rates are cheaper because those discounted rooms are the first to be relocated if the hotel overbooks. My rate is guaranteed and cannot be cancelled by the hotel. Want me to grab it for you?",
too_expensive: "I understand it seems pricey, but with high demand in the area due to local events, rates are only expected to increase. Want me to lock this in for you?",
general: "I totally understand \u2014 unfortunately, due to the high demand in the area, rates are only expected to increase. Want me to lock this one in for you?"
}
            }
        };
        
        // Render the results
        renderIntelligenceResults(formattedData, checkInDate);
        
    } catch (error) {
        console.error("Intelligence Analysis Error:", error);
        resultsEl.innerHTML = `<div class="p-4 text-center"><p class="text-red-600 font-semibold text-lg">Analysis Error</p><p class="text-slate-600 mt-2">${error.message}</p><p class="text-sm text-slate-400 mt-4">Please check your API keys and try again.</p></div>`;
        showToast('Error during analysis.', 'error');
    } finally {
        btn.disabled = false;
        btn.textContent = 'Analyze';
    }
}
   async function getIntelligenceForConfirmedLocation(address, checkInDate) {
     const btn = document.querySelector('#analyzeBtn');
     const resultsEl = document.querySelector('#intelligenceResults');
     btn.disabled = true;
     btn.innerHTML = `<svg class="animate-spin h-5 w-5 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;
     resultsEl.innerHTML = `<p class="text-slate-500 text-center py-10">Scanning professional event databases & preparing AI analysis...</p>`;
     
      const masterPrompt = `
TASK: Generate a JSON object based on the provided INPUT_DATA.

INPUT_DATA:
- location_name: The full location name.
- check_in_date: The customer's desired check-in date.
- market_intel: A list of major events. May be empty.

OUTPUT_FORMAT:
- Return a single JSON object with a root key named "playbook".
- The "playbook" key MUST contain "opening_line", "bridge_to_value", "rebuttals", and "response_scenarios".

RULES FOR "opening_line":
1.  **If 'market_intel' is NOT empty:**
    -   Identify the single most significant event from the list.
    -   Your response MUST be a single, tactical question using the exact name of that event.
    -   The question MUST follow this precise structure: "Okay, thank you, so I found an available room for those dates. Just so you're aware, this is a very popular date due to the [Event Name] and my system is showing limited avilability because of that. The final rate, including all taxes and fees, will be [Amount]. Want me to grab this one for you?"
    -   Example: If the event is "Super Bowl LIX", your output must be the string: "By any chance, are you traveling in for the Super Bowl LIX?"
2.  **If 'market_intel' IS empty:**
    -   Your response MUST be the single, tactical question: "Are you traveling for business or for pleasure on this trip?"

RULES FOR OTHER KEYS:
- All other playbook keys ("bridge_to_value", "rebuttals", etc.) MUST be generated based on the provided market intelligence, creating factual urgency by mentioning specific events if they exist.
`;

     try {
// Definir todas las keys en el mismo scope que el fetch
const openRouterKey   = await idbKeyval.get('OPENROUTER_API_KEY');
const predictHQKey    = await idbKeyval.get('PREDICTHQ_API_KEY');
const ticketmasterKey = await idbKeyval.get('');
const eventbriteKey   = await idbKeyval.get('');

// Validaci√≥n
if (!openRouterKey || !predictHQKey || !ticketmasterKey || !eventbriteKey) {
  throw new Error("PredictHQ API key must be set.");
}

// ‚¨áÔ∏è fetch y payload aqu√≠, usando las mismas variables
const [phqResponse] = await Promise.all([
  fetch(
    `https://api.predicthq.com/v1/events/?` +
    `category=sports,concerts,conferences,festivals,expos,public-holidays,public-holidays` + `&within=35km@${lat},${lng}` +
    `&active.gte=${formatDateForAPI(startDate)}` +
    `&active.lte=${formatDateForAPI(endDate)}` +
    `&rank.gte=70` +
    `&phq_attendance.gte=2000` +
    `&limit=10` +
    `&sort=rank`,
    {
      headers: {
        'Authorization': `Bearer ${predictHQKey}`,
        'Accept': 'application/json'
      }
    }
  ),
  ]);

const payload = { address, checkInDate, openRouterKey, predictHQKey, masterPrompt };
       
       const response = await fetch(`http://localhost:5678/get_intelligence`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) });
       const data = await response.json();
       if (!response.ok) throw new Error(data.error || `Server responded with status: ${response.status}`);
       renderIntelligenceResults(data, checkInDate);
     } catch (error) {
       console.error("Omniscience Engine Fetch Error:", error);
       resultsEl.innerHTML = `<div class="p-4 text-center"><p class="text-red-600 font-semibold text-lg">Engine Communication Error</p><p class="text-slate-600 mt-2">${error.message}</p><p class="text-sm text-slate-400 mt-4">Please ensure the DemandDaddy server is running and API keys are correct.</p></div>`;
       showToast('Error communicating with the local server.', 'error');
     } finally {
       btn.disabled = false;
       btn.textContent = 'Analyze';
     }
   }
// ADD THIS FUNCTION - generates AI-powered urgency sentences
async function generateUrgencySentence(primaryEventName, openRouterKey) {
    const prompt = `Create ONE compelling, urgent sales sentence for a hotel agent. 
    Context: ${primaryEventName} is happening, creating high demand. 
    Requirements: 
    - Exactly ONE sentence
    - Create urgency about limited availability
    - Mention the event naturally
    - End with asking if they want to book
    - Include [Amount] placeholder
    - Sound authentic, not pushy
    
    Examples:
    "With ${primaryEventName} in town, we're down to our last few rooms at [Amount] - should I secure one for you?"
    "Due to demand from ${primaryEventName}, this [Amount] rate won't last long - want me to hold this room?"`;

    try {
        const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${openRouterKey}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                model: 'anthropic/claude-3.5-sonnet', // or any model you prefer
                messages: [{ role: 'user', content: prompt }],
                max_tokens: 100
            })
        });

        const data = await response.json();
        return data.choices[0].message.content.trim();
    } catch (error) {
        console.error('AI sentence generation failed:', error);
        // Fallback sentence
        return `With ${primaryEventName} creating high demand, we have limited rooms at [Amount] - should I secure one for you?`;
    }
}
  async function renderIntelligenceResults(data, checkInDateStr) {
    lastIntelData = data; lastCheckInDateStr = checkInDateStr;
    const resultsEl = document.querySelector('#intelligenceResults');
    const checkInDate = new Date(checkInDateStr + 'T00:00:00');
    const score = data.compression_score || 0;
    const gaugeColor = score >= 75 ? 'bg-red-500' : (score >= 25 ? 'bg-yellow-400' : 'bg-green-500');
    const gaugeColorHex = score >= 75 ? '#ef4444' : (score >= 25 ? '#facc15' : '#22c55e');
    const uniqueEvents = Array.from( (data.market_intel || []).reduce((map, event) => { const key = `${event.name}|${event.start_datetime}`; 

// --- Smart Event Filter + Distance + PHQ info ---
(function(){
  try{
    var ws = new Date(checkInDate); ws.setHours(0,0,0,0);
    var we = new Date(checkInDate); we.setDate(we.getDate()+2); we.setHours(23,59,59,999);

    function getLatLng(ev){
      var cand=[
        [ev.latitude, ev.longitude],[ev.lat, ev.lng],[ev.lat, ev.lon],
        [ev.location&&ev.location[1], ev.location&&ev.location[0]],
        [ev.location&&ev.location.lat, ev.location&&(ev.location.lng||ev.location.lon)],
        [ev.geo&&ev.geo.lat, ev.geo&&(ev.geo.lng||ev.geo.lon)],
        [ev.place&&ev.place.lat, ev.place&&(ev.place.lng||ev.place.lon)],
        [ev.venue&&ev.venue.lat, ev.venue&&(ev.venue.lng||ev.venue.lon)],
        [ev.geometry&&ev.geometry.coordinates&&ev.geometry.coordinates[1], ev.geometry&&ev.geometry.coordinates&&ev.geometry.coordinates[0]],
        [ev.point&&ev.point.lat, ev.point&&(ev.point.lng||ev.point.lon)]
      ];
      for (var i=0;i<cand.length;i++){ var a=cand[i]; var la=Number(a&&a[0]), lo=Number(a&&a[1]); if(isFinite(la)&&isFinite(lo)) return {lat:la,lng:lo}; }
      return null;
    }
    function hv(lat1, lon1, lat2, lon2){ var R=3958.8,toRad=x=>x*Math.PI/180;
      var dLat=toRad(lat2-lat1), dLon=toRad(lon2-lon1);
      var a=Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
      return 2*R*Math.asin(Math.sqrt(a));
    }
    var hLat=window.currentLat||data.hotel_lat||data.lat, hLng=window.currentLng||data.hotel_lng||data.lng;

    // Window filter
    uniqueEvents = uniqueEvents.filter(function(ev){
      var raw = ev.start_datetime || ev.start || ev.startDate || ev.date || (ev.start_local && (ev.start_local.start || ev.start_local));
      if (!raw) return false;
      var d = new Date(raw);
      return d>=ws && d<=we;
    });

    // Distance + PHQ flags
    uniqueEvents.forEach(function(ev){
      var pt=getLatLng(ev);
      if(isFinite(hLat)&&isFinite(hLng)&&pt){ var dmi=Math.round((hv(hLat,hLng,pt.lat,pt.lng)+Number.EPSILON)*10)/10; if(isFinite(dmi)) ev.distance_miles=dmi; }
      ev._rank = Number(ev.rank||ev.phq_rank||0);
      ev._attendance = Number(ev.attendance||ev.phq_attendance||0);
      ev._holiday = String(ev.category||'').toLowerCase().indexOf('holiday')!==-1;
      ev._major = (ev._rank>=90)||(ev._attendance>=20000);
    });
  }catch(e){ console.warn('enrich fail', e); }
})();
// --- End Smart Event Filter + Distance + PHQ info ---
// --- Smart Event Filter & Distance (in-place, pre-render) ---
(function(){
  try {
    var ws = new Date(checkInDate); ws.setHours(0,0,0,0);
    var we = new Date(checkInDate); we.setDate(we.getDate()+2); we.setHours(23,59,59,999);
    // strict window filter
    uniqueEvents = uniqueEvents.filter(function(ev){
      var raw = ev.start_datetime || ev.start || ev.startDate || ev.date || (ev.start_local && (ev.start_local.start || ev.start_local));
      if (!raw) return false;
      var d = new Date(raw);
      return d >= ws && d <= we;
    });
    // compute distance_miles if hotel coords + event coords available
    var hLat = window.currentLat || data.hotel_lat || data.lat;
    var hLng = window.currentLng || data.hotel_lng || data.lng;
    function _hv(lat1, lon1, lat2, lon2){
      var R=3958.8, toRad=function(x){return x*Math.PI/180;};
      var dLat=toRad(lat2-lat1), dLon=toRad(lon2-lon1);
      var a=Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
      return 2*R*Math.asin(Math.sqrt(a));
    }
    if (isFinite(hLat) && isFinite(hLng)){
      uniqueEvents.forEach(function(ev){
        var eLat = Number(ev.latitude || ev.lat || (ev.location && (ev.location[1]||ev.location.lat)) || (ev.venue && ev.venue.lat));
        var eLng = Number(ev.longitude || ev.lng || (ev.location && (ev.location[0]||ev.location.lng)) || (ev.venue && ev.venue.lng));
        if (isFinite(eLat) && isFinite(eLng)){
          var dmi = Math.round((_hv(hLat,hLng,eLat,eLng)+Number.EPSILON)*10)/10;
          if (isFinite(dmi)) ev.distance_miles = dmi;
        }
      });
    }
  } catch(_){}
})();
// --- End Smart Event Filter & Distance ---
if (!map.has(key)) { map.set(key, { ...event, dateObj: new Date(event.start_datetime) }); } return map; }, new Map()).values() );
    
    if (intelSortDirection === 'asc') { uniqueEvents.sort((a, b) => a.dateObj - b.dateObj); } else { uniqueEvents.sort((a, b) => b.dateObj - a.dateObj); }
    
    // DEFENSIVE PARSING of the playbook object to prevent errors
    const playbook = data.playbook || {};
    const scenarios = playbook.response_scenarios || {};
    const rebuttals = playbook.rebuttals || {};
    
// Elegir el evento EXACTO del check-in; si no hay, caer al primero
const chkKey = __dateOnlyStrLocal(checkInDate);
const eventForCheckin = uniqueEvents.find(ev => {
  const dt = ev?.start_datetime ? new Date(ev.start_datetime) : ev?.dateObj;
  return dt && __dateOnlyStrLocal(dt) === chkKey;
}) || uniqueEvents[0];

const primaryEventName = eventForCheckin?.name || 'the event';


    let html = `<div class="mb-4">
       <div class="flex justify-between items-center mb-1"><span class="font-bold text-lg" style="color:${gaugeColorHex}">Occupancy: ${score}%</span><span class="text-sm font-semibold text-slate-500">${data.location_name || ''}</span></div>
       <div class="w-full bg-gray-200 rounded-full h-4"><div class="${gaugeColor} h-4 rounded-full" style="width: ${score}%"></div></div>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-x-6 gap-y-4 mb-4">
       <div>
           <h4 class="font-bold text-slate-800 mb-1 flex items-center"><span>üóìÔ∏è Verified Market Intel (${formatDateReadable(checkInDate)}+)</span><button id="intelSortBtn" title="Toggle Sort Order" class="ml-2 p-1 rounded-md hover:bg-slate-200 focus:outline-none focus:ring-2 focus:ring-slate-400"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9M3 12h9m5-4v12m0 0l-4-4m4 4l4-4" /></svg></button></h4>
           <
<div class="max-h-32 overflow-y-auto pr-2 mb-2">
    ${uniqueEvents.length ? uniqueEvents.slice(0, 5).map(e => {
        const nameRaw = e.name || '';
        const name = nameRaw.toLowerCase();
        const cat  = (e.category || '').toLowerCase();
        const venue = e.venue || 'Venue TBD';
        const dist = (typeof e.distance_miles === 'number') ? e.distance_miles.toFixed(1) : '‚Äî';
        const date = e.start_datetime ? new Date(e.start_datetime).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) : 'TBD';
        const attendance = (e.attendance || 0).toLocaleString();

        // Label & badge by category / league
        let label = 'Event', badgeBg = '#6b7280', icon = 'üìÖ';
        if (cat === 'concerts' || name.includes('concert') || name.includes('tour')) { label = 'Concert'; badgeBg = '#3b82f6'; icon = 'üéµ'; }
        else if (cat === 'sports') {
          if (name.includes('nhl') || name.includes('hockey')) { label = 'NHL'; badgeBg = '#0ea5e9'; icon = 'üèí'; }
          else if (name.includes('nba') || name.includes('basketball')) { label = 'NBA'; badgeBg = '#8b5cf6'; icon = 'üèÄ'; }
          else if (name.includes('nfl') || name.includes('football')) { label = 'NFL'; badgeBg = '#ef4444'; icon = 'üèà'; }
          else if (name.includes('mlb') || name.includes('baseball')) { label = 'MLB'; badgeBg = '#64748b'; icon = '‚öæ'; }
          else { label = 'Sports'; badgeBg = '#10b981'; icon = 'üèüÔ∏è'; }
        }
        else if (cat === 'expos' || name.includes('expo') || name.includes('convention') || name.includes('trade')) { label = 'Expo'; badgeBg = '#f59e0b'; icon = 'üè¢'; }
        else if (cat === 'festivals' || name.includes('festival') || name.includes('show') || name.includes('theater') || name.includes('theatre')) { label = 'Show'; badgeBg = '#8b5cf6'; icon = 'üé≠'; }
        else if (cat === 'conferences' || name.includes('conference')) { label = 'Conference'; badgeBg = '#8b5cf6'; icon = 'üé§'; }

        const searchQuery = encodeURIComponent(nameRaw + ' ' + (data.location_name || ''));
        return `<div class="flex flex-col py-2 border-b border-slate-200 text-sm">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2 flex-1 min-w-0">
                <span class="font-semibold px-1.5 py-0.5 rounded-md text-xs flex-shrink-0" style="background:${badgeBg};color:white;">${icon} ${label}</span>
                <a href="https://www.google.com/search?q=${searchQuery}" target="_blank" class="text-slate-800 hover:text-red-600 hover:underline truncate flex-1" title="${nameRaw}">
                  ${nameRaw}
                </a>
              </div>
              <div class="flex items-center gap-2 ml-2 text-xs flex-shrink-0">
                <span class="text-purple-600">${date}</span>
                <span class="font-semibold text-black">${attendance}</span>
              </div>
            </div>
            <div class="text-slate-600 text-xs mt-0.5">üìç ${venue} ‚Äî ${dist} miles away</div>
        </div>`;
    }).join('') : '<div class="text-slate-500 text-sm py-2">No events found</div>'} 
</div>
${uniqueEvents.length > 10 ? `<div class="text-xs text-slate-500 text-center mb-2">+ ${uniqueEvents.length - 10} more events</div>` : ''}
${data.seasonal_driver ? `<div class="p-2 rounded-md bg-amber-50 border border-amber-200 text-xs">üóìÔ∏è ${data.seasonal_driver}</div>` : ''}
       </div>
       <div><h4 class="font-bold text-slate-800 mb-1">üìç Concierge Corner</h4><ul class="text-sm space-y-1 text-slate-600 list-disc list-inside">${(data.concierge_corner || []).length ? data.concierge_corner.map(c => `<li>${c}</li>`).join('') : '<li>N/A</li>'}</ul></div>
    </div>
    
    <div class="border-t-2 border-slate-200 pt-4">
    <div class="flex justify-between items-center mb-1">
        <h3 class="font-bold text-slate-800 text-x5">üéØ Tactical Conversation Playbook</h3>
        <!-- This is the lock icon. It does not yet have functionality, but it is ready. -->
        <div id="starter-lock-icon" class="p-2 rounded-full cursor-pointer text-gray-400 hover:bg-slate-200" title="Generate random rebuttal">
  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
    <path d="M10 2a5 5 0 00-5 5v2a2 2 0 00-2 2v5a2 2 0 002 2h10a2 2 0 002-2v-5a2 2 0 00-2-2V7a5 5 0 00-5-5zm0 9a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
    <path d="M10 7a3 3 0 013 3v2H7V7a3 3 0 013-3z" />
  </svg>
</div>
    </div>
    <p class="text-base text-slate-600 mb-1"><b>Opening Question:</b></p>
    <!-- This is the corrected, simplified display logic -->
    <div id="starter-text-container" class="p-4 rounded-md bg-slate-100 text-5xl leading-tight font-bold text-slate-900 italic text-center">"${(uniqueEvents.length > 0 ? `Okay thank you for holding, so I have found an available room for those dates. Just so you know, this is a very popular date due to the <span class="text-red-600 font-extrabold">${primaryEventName}</span> and my system is showing limited availability. The final rate for your stay, including all taxes and fees, will be [Amount]. Want me to grab this one for you we only have 2 left at this rate?` : 'Are you traveling for business or for pleasure on this trip?')}"</div>
       
       <div class="mt-4">
           <h4 class="font-semibold text-slate-700 mb-2">Agent Response Playbook (If customer says...):</h4>
           <div class="space-y-2">
               <details><summary class="text-5xl leading-tight font-semibold cursor-pointer p-3 rounded-lg bg-green-100 border border-green-300 text-green-800">"Yes, I'm going to the event."</summary><div class="p-3 mt-1 rounded-b-lg bg-green-50 border-x border-b border-green-300 text-2xl font-semibold text-green-900 italic">${scenarios.yes_event || 'Excellent choice. This event is drawing in a large crowd and the rooms are selling fast, let me help you findd the best rate right away, please allow me one moment. '}</div></details>
               

       <div class="mt-4">
  <!-- Arrow rotate (solo para estos 3) -->
  <style id="pivot-acc-css-b">
    .pivot-acc summary .pivot-arrow { transition: transform .2s ease; }
    .pivot-acc[open] summary .pivot-arrow { transform: rotate(90deg); }
  </style>

  <div class="space-y-3">

    <!-- 1) Too expensive / cheaper online ‚Äî GREEN -->
    <details class="pivot-acc rounded-lg border border-green-300 bg-green-100">
      <summary class="text-5xl leading-tight font-semibold cursor-pointer p-3 rounded-lg text-red-700 flex items-center gap-3 select-none">
        <svg class="pivot-arrow w-7 h-7 text-red-700" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path d="M6 4l8 6-8 6V4z"/>
        </svg>
        <span>"It's too expensive / I saw it cheaper online."</span>
      </summary>
      <div class="p-3 mt-1 rounded-b-lg bg-green-50 text-2xl font-semibold text-green-800 italic" style="border:1px solid #86efac;">
        ${rebuttals.online_price || 'I can appreciate that, but many of those sites don‚Äôt have live inventory, and with the demand from ' + primaryEventName + ', those rates may no longer be available.'}
      </div>
    </details>

    <!-- 2) Need to consult ‚Äî CYAN -->
    <details class="pivot-acc rounded-lg border border-cyan-300 bg-cyan-100">
      <summary class="text-5xl leading-tight font-semibold cursor-pointer p-3 rounded-lg text-red-700 flex items-center gap-3 select-none">
        <svg class="pivot-arrow w-7 h-7 text-red-700" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path d="M6 4l8 6-8 6V4z"/>
        </svg>
        <span>"I need to consult with somebody else."</span>
      </summary>
      <div class="p-3 mt-1 rounded-b-lg bg-cyan-50 text-2xl font-semibold text-cyan-800 italic" style="border:1px solid #67e8f9;">
        ${rebuttals.consultation || 'Of course, but I can‚Äôt guarantee this room will still be here in 10 minutes given the city-wide demand from ' + primaryEventName + '.'}
      </div>
    </details>

    <!-- 3) I'll call back / need to think ‚Äî ROSE -->
    <details class="pivot-acc rounded-lg border border-rose-300 bg-rose-100">
      <summary class="text-5xl leading-tight font-semibold cursor-pointer p-3 rounded-lg text-red-700 flex items-center gap-3 select-none">
        <svg class="pivot-arrow w-7 h-7 text-red-700" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path d="M6 4l8 6-8 6V4z"/>
        </svg>
        <span>"I'll call back / I need to think about it."</span>
      </summary>
      <div class="p-3 mt-1 rounded-b-lg bg-rose-50 text-2xl font-semibold text-rose-800 italic" style="border:1px solid #fda4af;">
        ${rebuttals.hesitation || 'I understand, but the pricing and availability are changing by the minute because of ' + primaryEventName + ', and I‚Äôd hate for you to miss out.'}
      </div>
    </details>

  </div>
</div>

       <div class="mt-6 p-4 rounded-lg border-4 border-red-500 bg-red-100">
           <h4 class="font-extrabold text-red-800 text-xl mb-2 flex items-center gap-2">
               <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd" /></svg>
               MASTER REBUTTAL (Final Push)
           </h4>
           <p class="text-3xl font-bold text-red-900 italic">"${rebuttals.master_rebuttal || 'With the influx of people for both ' + primaryEventName + ' and other local happenings, rooms are extremely limited. The rate we have now is the best you will find. Shall I lock that in for you now?'}"</p>
       </div>
    </div>`;
    

resultsEl.innerHTML = html;
(function(){
  try{
    // Remove Concierge Corner & full width
    var h4s=[...resultsEl.querySelectorAll('h4')];
    h4s.forEach(h=>{ if(/Concierge Corner/i.test((h.textContent||''))) { const col=h.closest('div'); if(col&&col.parentNode) col.parentNode.removeChild(col);} });
    [...resultsEl.querySelectorAll('.grid')].forEach(g=>{ g.className = g.className.replace(/\blg:grid-cols-2\b/g,'lg:grid-cols-1').replace(/\bgrid-cols-2\b/g,'grid-cols-1'); });
    // Full window list
    [...resultsEl.querySelectorAll('[class*="overflow-y-auto"]')].forEach(l=>{ l.style.maxHeight='none'; l.style.height='auto'; l.style.overflowY='visible'; });

    // Style event name & venue
    [...resultsEl.querySelectorAll('a.truncate.flex-1')].forEach(a=>{
      a.style.color='#b91c1c'; a.style.fontWeight='900'; a.style.fontSize='1.75rem'; a.style.lineHeight='1.1';
      a.style.whiteSpace='nowrap'; a.style.overflow='hidden'; a.style.textOverflow='ellipsis';
    });

    const rows=[...resultsEl.querySelectorAll('.text-slate-600.text-xs')];
    const evs=(window._renderedEvents && window._renderedEvents.length ? window._renderedEvents : (data.market_intel||[]));

    rows.forEach((line,i)=>{
      let t=(line.textContent||''); if(t.indexOf('üìç')===-1) return;
      const ev=evs[i];
      const venue = t.split('‚Äî')[0].replace('üìç','').trim();
      // Prefer ev.distance_miles when available
      const miles = (ev && Number.isFinite(Number(ev.distance_miles))) ? (Number(ev.distance_miles).toFixed(1).replace(/\.0$/,'')) : '‚Äî';
      line.textContent='';
      line.innerHTML='üìç <span style="color:#b91c1c;font-weight:900;font-size:1.15rem;line-height:1">'
        + venue + '</span> ‚Äî <span style="font-weight:700">'+ miles + ' mi</span> '
        + '<span class="opacity-70" data-drive></span>';
      line.style.whiteSpace='nowrap'; line.style.overflow='hidden'; line.style.textOverflow='ellipsis';
    });

    // PHQ badges (as before)
    const metaRows=[...resultsEl.querySelectorAll('.text-slate-600.text-xs')];
    metaRows.forEach((line,i)=>{
      const ev=evs[i]; if(!ev) return;
      const r=Number(ev.rank||ev.phq_rank||0), a=Number(ev.attendance||ev.phq_attendance||0);
      const flags=[]; if(r) flags.push('Rank: '+r); if(a) flags.push('Attend: '+a.toLocaleString());
      if(String(ev.category||'').toLowerCase().includes('holiday')) flags.push('Holiday');
      if(r>=90 || a>=20000) flags.push('Major');
      if(!flags.length) return;
      const x=document.createElement('div'); x.style.fontSize='0.95rem'; x.style.fontWeight='600'; x.style.color='#0f172a'; x.style.marginTop='2px';
      x.textContent=flags.join(' ‚Ä¢ '); line.parentNode.appendChild(x);
    });

    // Enlarge date text (~3x)
    const monthRx=/(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)/i;
    [...resultsEl.querySelectorAll('span,div,a')].forEach(el=>{
      const s=(el.textContent||'').trim();
      if(monthRx.test(s) && /\b\d{1,2}\b/.test(s)){ el.style.fontSize='1.8rem'; el.style.lineHeight='1.1'; el.style.fontWeight='700'; el.style.color='#7c3aed'; }
    });

    // Drive-time via OSRM
    const hLat=window.currentLat, hLng=window.currentLng;
    async function driveMins(frLat,frLng,toLat,toLng){ try{ const u='https://router.project-osrm.org/route/v1/driving/'+frLng+','+frLat+';'+toLat+','+toLat+'?overview=false'; const r=await fetch(u); const j=await r.json(); const s=j&&j.routes&&j.routes[0]&&j.routes[0].duration; return isFinite(s)?Math.round(s/60):null; }catch(_){return null;} }
    if(isFinite(hLat)&&isFinite(hLng)){
      metaRows.slice(0,20).forEach(async (line,i)=>{
        const ev=evs[i]; if(!ev) return;
        const cands=[[ev.latitude,ev.longitude],[ev.lat,ev.lng],[ev.lat,ev.lon],[ev.location&&ev.location[1],ev.location&&ev.location[0]],[ev.location&&ev.location.lat,ev.location&&(ev.location.lng||ev.location.lon)],[ev.geometry&&ev.geometry.coordinates&&ev.geometry.coordinates[1], ev.geometry&&ev.geometry.coordinates&&ev.geometry.coordinates[0]]];
        let pt=null; for(const a of cands){ const la=Number(a&&a[0]), lo=Number(a&&a[1]); if(isFinite(la)&&isFinite(lo)){ pt={lat:la,lng:lo}; break; } }
        if(!pt) return; const mins=await driveMins(hLat,hLng,pt.lat,pt.lng); if(!mins) return;
        const s=line.querySelector('[data-drive]'); if(s) s.textContent=' (~'+mins+' min drive)';
      });
    }
  }catch(e){ console.warn('post-render patch error', e); }
})();
(function(){
  try{
    // Kill Concierge Corner & force full width
    var h4s=[...resultsEl.querySelectorAll('h4')];
    h4s.forEach(h=>{ if(/Concierge Corner/i.test((h.textContent||''))) { const col=h.closest('div'); if(col&&col.parentNode) col.parentNode.removeChild(col);} });
    [...resultsEl.querySelectorAll('.grid')].forEach(g=>{ g.className = g.className.replace(/lg:grid-cols-2/g,'lg:grid-cols-1').replace(/grid-cols-2/g,'grid-cols-1'); });

    // Make list full window (no inner scroll)
    [...resultsEl.querySelectorAll('[class*="overflow-y-auto"]')].forEach(l=>{ l.style.maxHeight='none'; l.style.height='auto'; l.style.overflowY='visible'; });

    // Style event name & venue in red, ‚Äú3x horizontally‚Äù but same row height
    [...resultsEl.querySelectorAll('a.truncate.flex-1')].forEach(a=>{
      a.style.color='#b91c1c'; a.style.fontWeight='900'; a.style.fontSize='1.75rem'; a.style.lineHeight='1.1';
      a.style.whiteSpace='nowrap'; a.style.overflow='hidden'; a.style.textOverflow='ellipsis';
    });
    // Convert "miles away" -> "mi" and append (~min drive)
    [...resultsEl.querySelectorAll('.text-slate-600.text-xs')].forEach(line=>{
      let t=(line.textContent||''); if(t.indexOf('üìç')===-1) return;
      t=t.replace('miles away','mi'); line.textContent=''; // rebuild with markup
      const parts = t.split('‚Äî'); const venue=(parts[0]||'').replace('üìç','').trim(); const tail=(parts.slice(1).join('‚Äî')||'').trim();
      line.innerHTML='üìç <span style="color:#b91c1c;font-weight:900;font-size:1.15rem;line-height:1">'
        + venue + '</span> ‚Äî <span style="font-weight:700">'+ tail +'</span> <span class="opacity-70" data-drive></span>';
      line.style.whiteSpace='nowrap'; line.style.overflow='hidden'; line.style.textOverflow='ellipsis';
    });

    // Insert PHQ info badges under each row (rank/attendance/flags)
    const evs=(data.market_intel||[]);
    const metaRows=[...resultsEl.querySelectorAll('.text-slate-600.text-xs')];
    metaRows.forEach((line,i)=>{
      const ev=evs[i]; if(!ev) return;
      const r=Number(ev.rank||ev.phq_rank||0), a=Number(ev.attendance||ev.phq_attendance||0);
      const flags=[]; if(r) flags.push('Rank: '+r); if(a) flags.push('Attend: '+a.toLocaleString()); 
      if(String(ev.category||'').toLowerCase().includes('holiday')) flags.push('Holiday');
      if(r>=90 || a>=20000) flags.push('Major');
      if(!flags.length) return;
      const x=document.createElement('div'); x.style.fontSize='0.95rem'; x.style.fontWeight='600'; x.style.color='#0f172a'; x.style.marginTop='2px';
      x.textContent=flags.join(' ‚Ä¢ '); line.parentNode.appendChild(x);
    });

    // Drive-time via OSRM
    const hLat=window.currentLat, hLng=window.currentLng;
    async function driveMins(frLat,frLng,toLat,toLng){ try{ const u='https://router.project-osrm.org/route/v1/driving/'+frLng+','+frLat+';'+toLng+','+toLat+'?overview=false'; const r=await fetch(u); const j=await r.json(); const s=j&&j.routes&&j.routes[0]&&j.routes[0].duration; return isFinite(s)?Math.round(s/60):null; }catch(_){return null;} }
    if(isFinite(hLat)&&isFinite(hLng)){
      metaRows.slice(0,20).forEach(async (line,i)=>{
        const ev=evs[i]; if(!ev) return;
        const cands=[[ev.latitude,ev.longitude],[ev.lat,ev.lng],[ev.lat,ev.lon],[ev.location&&ev.location[1],ev.location&&ev.location[0]],[ev.location&&ev.location.lat,ev.location&&(ev.location.lng||ev.location.lon)],[ev.geometry&&ev.geometry.coordinates&&ev.geometry.coordinates[1], ev.geometry&&ev.geometry.coordinates&&ev.geometry.coordinates[0]]];
        let pt=null; for(const a of cands){ const la=Number(a&&a[0]), lo=Number(a&&a[1]); if(isFinite(la)&&isFinite(lo)){ pt={lat:la,lng:lo}; break; } }
        if(!pt) return; const mins=await driveMins(hLat,hLng,pt.lat,pt.lng); if(!mins) return;
        const s=line.querySelector('[data-drive]'); if(s) s.textContent=' (~'+mins+' min drive)';
      });
    }
  }catch(e){ console.warn('post-render enhance fail', e); }
})();
  
  try{ setTimeout(()=>hydrateDistances(uniqueEvents), 0); }catch(_){}
  try{ setTimeout(()=>highlightCheckinExact(uniqueEvents, checkInDateStr), 0); }catch(_){}
  try{ setTimeout(()=>enhanceEventLinksWithDate(uniqueEvents), 0); }catch(_){}
}
   
   safeOn('datesConfirm', 'click', async () => {
     const ci = document.querySelector('#reservationCheckInDate').value, co = document.querySelector('#reservationCheckOutDate').value;
     if (!ci || !co || (new Date(co) <= new Date(ci))) { alert('Invalid dates.'); return; }
     document.querySelector('#datesForm').classList.add('hidden'); document.querySelector('#datesSuccess').classList.remove('hidden');
     const { commissionAmount, durationSec } = state.pendingSale;
     const newReservationId = state.nextReservationId++;
     // ‚¨áÔ∏è ONLY ONE reservations.push ‚¨áÔ∏è
state.reservations.push({ 
    id: newReservationId, 
    guestName: 'New Sale', 
    checkInDate: new Date(ci + 'T00:00:00'), 
    checkOutDate: new Date(co + 'T00:00:00'), 
    commissionAmount, 
    status: 'pending', 
    bookingDate: new Date() 
});

// ü¶à ADD SHARK MODE SYNC RIGHT HERE
updateSharkModeSync();

// ‚¨áÔ∏è ONLY ONE callRecords.push ‚¨áÔ∏è
state.callRecords.push({ 
    id: state.nextCallId++, 
    timestamp: new Date(), 
    outcome: 'Successful Sale', 
    commissionAmount, 
    durationSec, 
    reservationId: newReservationId 
});
     delete state.pendingSale;
     await save();
     updateAllUI();
     setTimeout(async () => {
         hideModal('modalDates');
         const salesCount = (state.reservations || []).filter(r => r.status !== 'cancelled').length;
const baseline = (state.settings && Number.isInteger(state.settings.spinOffset)) ? state.settings.spinOffset : 0;
const effective = Math.max(0, salesCount - baseline);

if (effective > 0 && effective % 4 === 0) {
  window.currentSpinMode = (effective % 16 === 0) ? 'mega' : 'regular';
  currentReservationIdForSpin = newReservationId;
  celebrate(window.currentSpinMode === 'mega' ? 'mega' : 'spin');
  showModal('modalWheel');
} else {
  window.currentSpinMode = 'regular';
  celebrate('sale');
}

await syncToGoogleSheet();
     }, 1500);
   });

   document.addEventListener('DOMContentLoaded', async () => {
     await load();
          setTimeout(() => {
       try {
         if (typeof photon !== 'undefined' && photon.autocomplete) {
           new photon.autocomplete.Geosearch(document.querySelector('#searchInput'), {
             limit: 5, lang: 'en',
             formatResult: (feature) => { 
               const { name, city, state, postcode } = feature.properties; 
               return `${name}, ${city || ''}, ${state || ''} ${postcode || ''}`.replace(/, ,/g, ',').replace(/, $/g, '').trim(); 
             },
             onSelected: (feature) => { 
               const { name, city, state, postcode } = feature.properties; 
               const val = `${name}, ${city || ''}, ${state || ''} ${postcode || ''}`.replace(/, ,/g, ',').replace(/, $/g, '').trim(); 
               document.querySelector('#searchInput').value = val; 
             }
           });
         } else {
           console.warn('Photon autocomplete library not loaded');
         }
       } catch(e) { 
         console.error("Photon Autocomplete failed.", e); 
       }
     }, 2000);
     const backgroundOptions = { 'Default Pink': '#fce7f3', 'Soothing Blue': '#eff6ff', 'Mint Green': '#f0fdf4', 'Warm Yellow': '#fefce8' };
     Object.entries(backgroundOptions).forEach(([name, value]) => { const option = document.createElement('option'); option.value = value; option.textContent = name; document.querySelector('#backgroundSelector').appendChild(option); });
     Object.entries(THEME_DATA).forEach(([key, value]) => { const option = document.createElement('option'); option.value = key; option.textContent = value.name; document.querySelector('#themeSelector').appendChild(option); });
     document.querySelector('#backgroundSelector').value = state.settings.background;
     document.querySelector('#dynamicSkySelector').value = state.settings.dynamicSky;
     document.querySelector('#kenBurnsToggle').checked = state.settings.kenBurns;
     document.querySelector('#sunMoonToggle').checked = state.settings.sunMoon;
     document.querySelector('#lighthouseToggle').checked = state.settings.lighthouse;
     document.querySelector('#lightsSpeedSlider').value = state.settings.hotelLightsSpeed;
     document.querySelector('#toggleLamps').checked = state.settings.exteriorLampsOn;
     document.querySelector('#themeSelector').value = state.settings.activeTheme;
     document.querySelector('#autoQuoteToggle').checked = state.settings.autoQuotes;
     document.querySelector('#toggleLights').checked = state.settings.hotelLightsOn;
     document.querySelector('#confettiSlider').value = state.confettiIntensity;
     if (await idbKeyval.get('OPENROUTER_API_KEY')) { document.querySelector('#apiKeyInput').placeholder = "API Key is saved"; }
     if (await idbKeyval.get('PREDICTHQ_API_KEY')) { document.querySelector('#predictHQKeyInput').placeholder = "API Key is saved"; }
safeOn('analyzeBtn', 'click', handleIntelligenceAnalysis);
document.querySelector('#intelligenceResults').addEventListener('click', (e) => { if (e.target.closest('#intelSortBtn')) { intelSortDirection = intelSortDirection === 'asc' ? 'desc' : 'asc'; if (lastIntelData && lastCheckInDateStr) { renderIntelligenceResults(lastIntelData, lastCheckInDateStr); } } });
document.querySelector('#intelligenceResults').addEventListener('click', (e) => { if (e.target.closest('#intelSortBtn')) { intelSortDirection = intelSortDirection === 'asc' ? 'desc' : 'asc'; if (lastIntelData && lastCheckInDateStr) { renderIntelligenceResults(lastIntelData, lastCheckInDateStr); } } });
     // Add event listener for the new sort button, delegating from a parent element
     safeOn('intelligenceResults', 'click', (e) => {
         if (e.target.closest('#intelSortBtn')) {
             intelSortDirection = intelSortDirection === 'asc' ? 'desc' : 'asc';
             if (lastIntelData && lastCheckInDateStr) {
                 renderIntelligenceResults(lastIntelData, lastCheckInDateStr);
             }
         }
     });
     document.querySelector('#searchInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') { const firstSuggestion = document.querySelector('.photon-suggestion'); if (firstSuggestion) { firstSuggestion.click(); } e.preventDefault(); document.querySelector('#analyzeBtn').click(); }});
     safeOn('searchInput', 'focus', e => e.target.select());
     safeOn('todayBtn', 'click', () => { document.querySelector('#intelligenceCheckInDate').value = formatDateForInput(new Date()); });
     safeOn('backgroundSelector', 'change', e => { state.settings.background = e.target.value; state.settings.dynamicSky = 'off'; document.querySelector('#dynamicSkySelector').value = 'off'; save(); applyMasterBackground(); });
     safeOn('dynamicSkySelector', 'change', e => { state.settings.dynamicSky = e.target.value; save(); applyMasterBackground(); });
     safeOn('kenBurnsToggle', 'change', e => { state.settings.kenBurns = e.target.checked; save(); applyMasterBackground(); });
     safeOn('sunMoonToggle', 'change', e => { state.settings.sunMoon = e.target.checked; save(); applyMasterBackground(); });
     safeOn('lighthouseToggle', 'change', e => { state.settings.lighthouse = e.target.checked; save(); applyMasterBackground(); });
// --- EVENT LISTENER MODIFICADO PARA LUCES NORMALES (toggleLights) ---
safeOn('toggleLights', 'change', e => {
    // --- BLOQUEA LAS LUCES NORMALES SI EL GOAL MODE EST√Å ACTIVO ---
    if (state.settings.goalLightsMode) {
        e.preventDefault();
        document.querySelector('#toggleLights').checked = false; // Force the checkbox back to off
        showToast("Turn off 'Goal Lights Mode' first to use automatic lights.");
        return;
    }
    // --- FIN DEL BLOQUEO ---

    state.settings.hotelLightsOn = e.target.checked;
    save();
    if(e.target.checked) {
        animateHotelLights();
    } else {
        $$('.hotel-window').forEach(w => w.classList.remove('lit'));
    }
});

     safeOn('lightsSpeedSlider', 'input', e => { state.settings.hotelLightsSpeed = parseFloat(e.target.value); save(); });
     safeOn('toggleLamps', 'change', e => { state.settings.exteriorLampsOn = e.target.checked; save(); renderLamps(); });
// --- EVENT LISTENER PARA EL NUEVO BOT√ìN "GOAL LIGHTS MODE" ---
safeOn('toggleGoalLights', 'change', function(e) {
    state.settings.goalLightsMode = e.target.checked;
    save();

    if (state.settings.goalLightsMode) {
        // MODO GOAL ACTIVADO: Apagar el modo autom√°tico
        state.settings.hotelLightsOn = false;
        document.querySelector('#toggleLights').checked = false; // Apagar el checkbox visualmente
        // Prender las luces basado en ventas
        updateGoalLights();
    } else {
        // MODO GOAL DESACTIVADO: Apagar todas las luces de goal
        $$('.hotel-window, .hotel-window-large').forEach(w => w.classList.remove('lit'));
        // Y no hacer nada m√°s. El usuario decide si prende las luces autom√°ticas.
    }
});
     safeOn('themeSelector', 'change', e => { state.settings.activeTheme = e.target.value; save(); applyTheme(); });
     safeOn('bgUpload', 'change', e => { const file = e.target.files[0]; if(!file) return; const reader = new FileReader(); reader.onload = (event) => { state.settings.customBg = event.target.result; state.settings.background = 'custom'; state.settings.dynamicSky = 'off'; document.querySelector('#dynamicSkySelector').value = 'off'; save(); applyMasterBackground(); showToast("Custom background applied.", "success"); }; reader.readAsDataURL(file); });
     safeOn('showQuoteBtn', 'click', () => showQuote(true));
     safeOn('quoteCloseBtn', 'click', () => hideQuote());
     safeOn('quoteContinueBtn', 'click', () => hideQuote());
     safeOn('autoQuoteToggle', 'change', e => { state.settings.autoQuotes = e.target.checked; save(); updateAmbientQuotes(); });
     safeOn('saveQuoteThemeBtn', 'click', handleQuoteFileUpload);
     safeOn('saveApiKey', 'click', async () => { const key = (document.querySelector('#apiKeyInput').value||'').trim(); if (key.length > 10) { await idbKeyval.set('OPENROUTER_API_KEY', key); showToast("OpenRouter API Key saved!", "success"); document.querySelector('#apiKeyInput').value = ''; document.querySelector('#apiKeyInput').placeholder = "API Key is saved"; } else { showToast("Invalid API Key format.", "error"); } });
     safeOn('savePredictHQKey', 'click', async () => { const key = (document.querySelector('#predictHQKeyInput').value||'').trim(); if (key.length > 10) { await idbKeyval.set('PREDICTHQ_API_KEY', key); showToast("PredictHQ API Key saved!", "success"); document.querySelector('#predictHQKeyInput').value = ''; document.querySelector('#predictHQKeyInput').placeholder = "API Key is saved"; } else { showToast("Invalid API Key format.", "error"); } });
     safeOn('checkBtn', 'click', () => { if (state.timeTracking.status === 'checked-out') handleCheckIn(); else handleCheckOut(); });
     safeOn('breakBtn', 'click', () => handleStartBreak('break'));
     safeOn('lunchBtn', 'click', () => handleStartBreak('lunch'));
     safeOn('endBreakLunchBtn', 'click', handleEndBreak);
     safeOn('resetTodayPerformance', 'click', resetTodayPerformance);
     safeOn('resetWeekPerformance', 'click', resetWeekPerformance);
     safeOn('prevQuincenaBtn', 'click', () => { const d = new Date(state.ui.quincenaViewDate); d.setDate(1); d.setMonth(d.getMonth() - 1); state.ui.quincenaViewDate = d; save(); renderQuincenaOverview(); });
     safeOn('nextQuincenaBtn', 'click', () => { const d = new Date(state.ui.quincenaViewDate); d.setDate(1); d.setMonth(d.getMonth() + 1); state.ui.quincenaViewDate = d; save(); renderQuincenaOverview(); });
     safeOn('prevMonthBtn', 'click', (e) => { e.preventDefault(); const d = new Date(state.ui.monthlyViewDate); d.setMonth(d.getMonth() - 1); state.ui.monthlyViewDate = d; save(); renderMonthlyReview(); });
     safeOn('nextMonthBtn', 'click', (e) => { e.preventDefault(); const d = new Date(state.ui.monthlyViewDate); d.setMonth(d.getMonth() + 1); state.ui.monthlyViewDate = d; save(); renderMonthlyReview(); });
     safeOn('startCall','click', ()=>{ if(state.timeTracking.status === 'checked-out'){ showToast('Please Check In before starting a call.', 'error'); return; } state.activeCallStart=new Date(); document.querySelector('#callTimerDisplay').textContent='00:00'; if(callTimerInterval) clearInterval(callTimerInterval); callTimerInterval=setInterval(()=>{ if(!state.activeCallStart){ clearInterval(callTimerInterval); return; } const elapsed=Math.floor((Date.now()-state.activeCallStart.getTime())/1000); document.querySelector('#callTimerDisplay').textContent = formatTimer(elapsed); },1000); const c=document.querySelector('#callOutcomeBtns'); if(c) c.innerHTML=''; callOutcomes.forEach(({ outcome, bg, border })=>{ const btn=document.createElement('button'); btn.className='call-btn'; btn.style.backgroundColor=bg; btn.style.borderColor=border; btn.textContent=outcome; btn.onclick=()=>{ if(callTimerInterval){ clearInterval(callTimerInterval); callTimerInterval=null; } const end=new Date(); const start=state.activeCallStart; const durationSec=start?Math.max(0,Math.round((end-start)/1000)):0; if(outcome!=='Successful Sale') state.callsWithoutSale++; else state.callsWithoutSale=0; if(outcome==='Successful Sale'){ state.pendingSale={ outcome:'Successful Sale', durationSec }; hideModal('modalCall'); showModal('modalCommission'); } else { state.callRecords.push({ id:state.nextCallId++, timestamp:new Date(), outcome, durationSec }); state.activeCallStart=null; save(); updateAllUI(); hideModal('modalCall'); } }; c?.appendChild(btn); }); showModal('modalCall'); setTimeout(()=>document.querySelector('#searchInput').focus(), 100); });
     safeOn('commissionInput','keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); document.querySelector('#commissionContinue').click(); }});
     safeOn('commissionContinue','click',()=>{ const amt=parseFloat(document.querySelector('#commissionInput').value||'0'); if(amt>0){ state.pendingSale=state.pendingSale||{ outcome:'Successful Sale', durationSec: 0 }; state.pendingSale.commissionAmount=amt; document.querySelector('#commissionInput').value=''; hideModal('modalCommission'); const today = new Date(); document.querySelector('#reservationCheckInDate').value = formatDateForInput(today); const nextDay = new Date(today); nextDay.setDate(today.getDate() + 1); document.querySelector('#reservationCheckOutDate').value = formatDateForInput(nextDay); document.querySelector('#reservationCheckOutDate').min = formatDateForInput(nextDay); showModal('modalDates'); } });
     safeOn('btnCheckInToday','click',()=>{ const t=new Date(); document.querySelector('#reservationCheckInDate').value=formatDateForInput(t); document.querySelector('#reservationCheckInDate').dispatchEvent(new Event('change')); });
     safeOn('reservationCheckInDate', 'change', (e) => { const checkInValue = e.target.value; if (!checkInValue) return; const checkInDate = new Date(checkInValue + 'T00:00:00'); const nextDay = new Date(checkInDate); nextDay.setDate(checkInDate.getDate() + 1); const nextDayStr = formatDateForInput(nextDay); document.querySelector('#reservationCheckOutDate').value = nextDayStr; document.querySelector('#reservationCheckOutDate').min = nextDayStr; });
     safeOn('wheelSpinSave','click',()=>{ const amount=parseFloat(document.querySelector('#wheelSpinInput').value||'0'); if(amount>0){ document.querySelector('#wheelSpinSave').disabled=true; spinWheel(amount); } else { alert('Enter a valid bonus amount.'); } });
     safeOn('resetCalls', 'click', async ()=>{ if(confirm('Reset ALL call records? This cannot be undone.')){ state.callRecords=[]; state.callsWithoutSale=0; state.nextCallId=1; await save(); updateAllUI(); showToast("Call records have been reset.", "success"); } });
     safeOn('resetSales', 'click', async ()=>{ if(confirm('Reset ALL sales/reservations? This will not affect wheel spins. This cannot be undone.')){ state.reservations=[]; state.nextReservationId=1; await save(); updateAllUI(); await syncToGoogleSheet(); showToast("Sales records have been reset.", "success"); } });
     safeOn('resetWork', 'click', async ()=>{ if(confirm('Reset ALL work time tracking data? This cannot be undone.')){ state.timeTracking = { ...getDefaultState().timeTracking }; state.workSessions = []; await save(); updateAllUI(); showToast("Work time data has been reset.", "success"); } });
safeOn('resetSpins', 'click', async () => {
  if (!confirm('Reset the spin progress counters to zero? This will not delete any of your previously won spin bonuses.')) return;

  state.settings = state.settings || {};
  // Set the visual offset to the current real sales so the progress looks ‚Äúreset‚Äù
  state.settings.spinOffset = (state.reservations || []).filter(r => r.status !== 'cancelled').length;

  await save();
  updateSpinIndicator(); // refresh just the Spin Progress UI (no timers)
  showToast("Spin progress has been reset.", "success");
});

function handleAuthClick() {
    console.log('Auth button clicked');
    console.log('tokenClient available:', !!tokenClient);
    console.log('gapiAccessToken:', gapiAccessToken);
    
    if (!tokenClient) {
        console.log('Token client not available, forcing initialization...');
        maybeEnableAndInitClient();
        showToast('Initializing Google APIs. Please wait 2 seconds and try again.', 'info');
        return;
    }
    
    if (gapiAccessToken) {
        console.log('Already authorized, syncing...');
        syncToGoogleSheet();
    } else {
        console.log('Requesting authorization...');
        tokenClient.requestAccessToken({ prompt: 'consent' });
    }
}
function handleSignoutClick() {
  if (typeof gapi !== 'undefined' && gapiAccessToken) {
    google.accounts.oauth2.revoke(gapiAccessToken);
    gapiAccessToken = null;
    updateSigninStatus(false);
    showToast('Signed out from Google.');
  }
}
     safeOn('googleClientIdInput', 'input', save);
     safeOn('googleSheetIdInput', 'input', save);
     safeOn('googleSheetNameInput', 'input', save);
     safeOn('authButton', 'click', handleAuthClick);
     safeOn('signoutButton', 'click', handleSignoutClick);
     safeOn('manualSyncButton', 'click', syncToGoogleSheet);
     safeOn('confettiSlider', 'input', (e) => { state.confettiIntensity = parseFloat(e.target.value); save(); });
     safeOn('exportAll', 'click', () => { if(!confirm("Export a comprehensive financial and operational report to a CSV file?")) return; let csvContent = "data:text/csv;charset=utf-8,"; const formatDate = (d) => new Date(d).toLocaleDateString('en-CA'); csvContent += "QUINCENA PAY PERIOD SUMMARIES\r\n"; csvContent += "Pay Period,Pay Date,Total Commissions,Total Bonuses,Grand Total Payout\r\n"; const allItems = []; (state.reservations || []).filter(r => r.status !== 'cancelled').forEach(res => { const settledDate = getSettledDateForReservation(res.checkOutDate); allItems.push({ settledDate, amount: res.commissionAmount || 0, payDate: calculatePayDate(settledDate), type: 'commission' }); }); (state.wheelSpins || []).forEach(spin => { const settledDate = new Date(spin.timestamp); allItems.push({ settledDate, amount: spin.amount || 0, payDate: calculatePayDate(settledDate), type: 'bonus' }); }); if (allItems.length > 0) { const payPeriods = {}; allItems.forEach(item => { const payDateKey = item.payDate.toISOString().split('T')[0]; if (!payPeriods[payDateKey]) { const isFirstHalf = item.payDate.getDate() === 21; const refDate = new Date(item.payDate); if (!isFirstHalf) refDate.setMonth(refDate.getMonth() -1); const periods = getPayPeriodsForMonth(refDate); const period = isFirstHalf ? periods[0] : periods[1]; payPeriods[payDateKey] = { label: `${formatDate(period.earningStart)} - ${formatDate(period.earningEnd)}`, payDate: formatDate(period.payDate), commissions: 0, bonuses: 0 }; } if (item.type === 'commission') payPeriods[payDateKey].commissions += item.amount; if (item.type === 'bonus') payPeriods[payDateKey].bonuses += item.amount; }); Object.values(payPeriods).sort((a,b) => new Date(a.payDate) - new Date(b.payDate)).forEach(p => { csvContent += `"${p.label}",${p.payDate},${p.commissions.toFixed(2)},${p.bonuses.toFixed(2)},${(p.commissions + p.bonuses).toFixed(2)}\r\n`; }); } csvContent += "\r\nDETAILED WORK SESSIONS\r\n"; csvContent += "Start Time,End Time,Duration (HH:MM:SS)\r\n"; (state.workSessions || []).forEach(s => { const duration = (new Date(s.end) - new Date(s.start)) / 1000; csvContent += `"${new Date(s.start).toLocaleString()}","${new Date(s.end).toLocaleString()}","${formatTime(duration)}"\r\n`; }); csvContent += "\r\nDETAILED TRANSACTION LOG\r\n"; const headers = ["DataType", "ID", "Timestamp", "Outcome/Status", "Duration(s)", "Commission", "Amount", "Check-In", "Check-Out", "GuestName"]; csvContent += headers.join(",") + "\r\n"; state.callRecords.forEach(c => { const row = ["Call", c.id, `"${c.timestamp.toISOString()}"`, `"${c.outcome}"`, c.durationSec, c.commissionAmount || "", "", "", "", ""]; csvContent += row.join(",") + "\r\n"; }); state.reservations.forEach(r => { const row = ["Reservation", r.id, `"${r.bookingDate.toISOString()}"`, `"${r.status}"`, "", r.commissionAmount, "", `"${new Date(r.checkInDate).toISOString().split('T')[0]}"`, `"${new Date(r.checkOutDate).toISOString().split('T')[0]}"`, `"${(r.guestName||'').replace(/"/g, '""')}"`]; csvContent += row.join(",") + "\r\n"; }); state.wheelSpins.forEach(s => { const row = ["Spin", s.id, `"${s.timestamp.toISOString()}"`, s.mega ? "Mega" : "Regular", "", "", s.amount, "", "", ""]; csvContent += row.join(",") + "\r\n"; }); const encodedUri = encodeURI(csvContent); const link = document.createElement("a"); link.setAttribute("href", encodedUri); link.setAttribute("download", "comprehensive_report.csv"); document.body.appendChild(link); link.click(); link.remove(); });
     document.body.addEventListener('click', async e=>{ const delBtn=e.target.closest('[data-del-id]'); const cancelBtn=e.target.closest('[data-cancel-id]'); const reinstateBtn=e.target.closest('[data-reinstate-id]'); const spinDelBtn = e.target.closest('[data-del-spin-id]'); let needsSync = false; if (delBtn) { const resId = parseInt(delBtn.dataset.delId, 10); if (confirm(`PERMANENTLY DELETE reservation #${resId}? This will also delete the associated 'Successful Sale' call record.`)) { state.callRecords = state.callRecords.filter(c => c.reservationId !== resId); state.reservations = state.reservations.filter(r => r.id !== resId); needsSync = true; } } else if (cancelBtn) { const resId = parseInt(cancelBtn.dataset.cancelId, 10); const res = state.reservations.find(r => r.id === resId); if (res) { res.status = 'cancelled'; needsSync = true; } } else if (reinstateBtn) { const resId = parseInt(reinstateBtn.dataset.reinstateId, 10); const res = state.reservations.find(r => r.id === resId); if (res) { res.status = 'pending'; needsSync = true; } } else if (spinDelBtn) { const spinId = parseInt(spinDelBtn.dataset.delSpinId, 10); if (confirm(`Permanently delete wheel spin bonus #${spinId}? This will remove the bonus amount from your totals.`)) { state.wheelSpins = state.wheelSpins.filter(s => s.id !== spinId); await save(); updateAllUI(); showToast("Wheel spin bonus deleted.", "success"); } } if (needsSync) { await save(); updateAllUI(); await syncToGoogleSheet(); } const callDelBtn=e.target.closest('.delete-call-btn'); if (callDelBtn) { const callId = callDelBtn.getAttribute('data-call-id'); if(confirm('Delete this call record?')){ state.callRecords = state.callRecords.filter(c=>c.id.toString()!==callId); await save(); updateAllUI(); } } });
     if(dynamicSkyInterval) clearInterval(dynamicSkyInterval);
     dynamicSkyInterval = setInterval(applyMasterBackground, 60000);
     document.querySelector('#intelligenceCheckInDate').value = formatDateForInput(new Date());
     drawWheel();
     updateAllUI();
     if(state.timeTracking.status !== 'checked-out') { startMasterTimer(); animateLargeHotel(); }
     updateAmbientQuotes();
     if (state.settings.hotelLightsOn) { animateHotelLights(); }

    function debugGoogleStatus() {
       console.log('Google API status:', {
         gapiInited: gapiInited,
         gisInited: gisInited,
         hasClientId: !!state.settings.googleClientId,
         clientId: state.settings.googleClientId,
         authButtonDisabled: document.querySelector('#authButton').disabled
       });
     }

     // Call this periodically to see what's happening
     setInterval(debugGoogleStatus, 3000);

     // Also add error handling for Google API loading
     window.gapiLoadError = function(error) {
       console.error('Google API failed to load:', error);
       document.querySelector('#googleAuthStatus').textContent = 'Status: Google API failed to load';
     };

     window.gisLoadError = function(error) {
       console.error('Google Identity Services failed to load:', error);
       document.querySelector('#googleAuthStatus').textContent = 'Status: GIS failed to load';
     };

     console.log("Omniscience Engine v20.5 (Manual Override) Initialized. All systems nominal.");
   });
</script>
<script>
(async function(){
  // Wait for idbKeyval to be ready
  function waitFor(fn, timeout=5000){
    const start = Date.now();
    return new Promise((resolve, reject)=>{
      (function check(){
        if(fn()) return resolve();
        if(Date.now()-start>timeout) return resolve(); // resolve anyway
        setTimeout(check, 200);
      })();
    });
  }
  await waitFor(()=> typeof idbKeyval !== 'undefined' && idbKeyval.get);

  try{
    // Load existing keys into inputs (do not reveal full values)
    try{
      const tm = await idbKeyval.get(''); if(tm){ document.getElementById('ticketmasterKeyInput').placeholder = 'API Key is saved (last4: ...' + tm.slice(-4); }
      const eb = await idbKeyval.get(''); if(eb){ document.getElementById('eventbriteKeyInput').placeholder = 'API Key is saved (last4: ...' + eb.slice(-4); }
    }catch(e){ console.warn('Could not read saved keys', e); }

    }catch(e){ console.warn('Key handler init failed', e); }
})();
</script>
<script id="radius-dropdown-inject">
(function () {
  var dateInput =
    document.getElementById('dateInput') ||
    document.querySelector('input[type="date"]');

  if (!dateInput) return;

  var label = document.createElement('label');
  label.setAttribute('for', 'radiusSelect');
  label.className = 'text-sm font-medium mb-1 block';
  label.textContent = 'Radius (miles)';

  var select = document.createElement('select');
  select.id = 'radiusSelect';
  select.className = 'border rounded px-2 py-2';
  [25, 50, 75, 100, 150, 200].forEach(function (mi) {
    var opt = document.createElement('option');
    opt.value = mi;
    opt.textContent = mi + ' mi';
    select.appendChild(opt);
  });

  var flexRow = document.createElement('div');
  flexRow.style.display = 'flex';
  flexRow.style.gap = '8px';
  flexRow.style.alignItems = 'center';

  var dateCol = document.createElement('div');
  dateCol.style.flex = '1 1 50%';
  dateInput.parentElement.insertBefore(flexRow, dateInput);
  dateCol.appendChild(dateInput);
  flexRow.appendChild(dateCol);

  var radiusCol = document.createElement('div');
  radiusCol.style.flex = '1 1 50%';
  radiusCol.appendChild(label);
  radiusCol.appendChild(select);
  flexRow.appendChild(radiusCol);

  dateInput.style.width = '100%';
})();
</script class="w-40 h-10 px-2 border rounded-md">
<!-- Goal Tracker (UI only) -->
<div class="section card mb-8" id="goal-tracker" style="background-color:#ffffff;">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-lg font-semibold flex items-center gap-2"><span>üéØ</span> Goal Tracker</h2>
    <button id="resetGoals" class="btn" style="background-color:#ef4444">Reset</button>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div>
      <label for="goalName" class="text-sm font-medium mb-1 block">Item</label>
      <input id="goalName" type="text" class="w-full border rounded px-2 py-2" placeholder="e.g., Washing machine">
    </div>
    <div>
      <label for="goalTarget" class="text-sm font-medium mb-1 block">Target price</label>
      <input id="goalTarget" type="number" min="0" step="0.01" class="w-full border rounded px-2 py-2" placeholder="e.g., 499.00">
    </div>
    <div>
      <label for="goalImage" class="text-sm font-medium mb-1 block">Image URL (optional)</label>
      <input id="goalImage" type="url" class="w-full border rounded px-2 py-2" placeholder="https://...">
    </div>
  </div>

  <div class="mt-4 flex flex-wrap gap-2 items-end">
    <button id="addGoal" class="btn" style="background-color:#0ea5e9">Add Goal</button>
    <div class="flex items-center gap-2">
      <label for="saleAmount" class="text-sm font-medium">Add Sale</label>
      <input id="saleAmount" type="number" min="0" step="0.01" class="border rounded px-2 py-2 w-28" placeholder="0.00">
      <button id="applySale" class="btn" style="background-color:#10b981">Apply</button>
    </div>
  </div>

  
</div>
<script id="fix-card-boundaries">
(function () {
  // Find the AI & Event Intelligence card by locating the OpenRouter input (#apiKeyInput)
  var anchorInput = document.getElementById('apiKeyInput');
  if (!anchorInput) return;
  var aiCard = anchorInput.closest('.card');
  if (!aiCard) return;

  // Collect descendant cards that have an H2 (likely full sections), in DOM order
  var descendants = Array.from(aiCard.querySelectorAll('.card')).filter(function (c) {
    if (c === aiCard) return false;
    return !!c.querySelector('h2');
  });
  if (!descendants.length) return;

  // Move each section card to become a sibling after the AI card, preserving order
  var insertAfter = aiCard;
  descendants.forEach(function (sec) {
    if (insertAfter.parentNode) {
      insertAfter.parentNode.insertBefore(sec, insertAfter.nextSibling);
      insertAfter = sec;
    }
  });
})();
</script>
<script id="separate-cards-robust">
document.addEventListener('DOMContentLoaded', function(){
  function closestCard(node){
    return node?.closest?.('.section.card') || node?.closest?.('.card') || null;
  }
  // Identify AI card by the label "OpenRouter.ai API Key" (stable anchor)
  var aiLabel = Array.from(document.querySelectorAll('label')).find(l => /OpenRouter\.ai\s*API\s*Key/i.test(l.textContent||''));
  var aiCard = closestCard(aiLabel) || closestCard(document.querySelector('h2:contains("AI & Event Intelligence")'));
  // Identify Overall Performance card by heading or metric labels
  var overallH2 = Array.from(document.querySelectorAll('h2')).find(h => /Overall\s*Performance/i.test(h.textContent||''));
  var overallCard = closestCard(overallH2);
  if (!overallCard){
    // Fallback: look for typical metric labels
    var metricLabel = Array.from(document.querySelectorAll('*')).find(n => /(Total Commissions|Sales Count|Conversion Rate|Total Spins)/i.test(n.textContent||''));
    overallCard = closestCard(metricLabel);
  }
  if (aiCard && overallCard && aiCard.contains(overallCard) && aiCard !== overallCard){
    aiCard.parentNode.insertBefore(overallCard, aiCard.nextSibling);
  }
});
</script>
<script id="goal-tracker-logic">
(function(){
  function hasIDB(){ return !!(window.idbKeyval && idbKeyval.get && idbKeyval.set); }
  const storeKey = 'goals.v1';

  const getStore = () => ({
    async get(){ try{ return hasIDB() ? (await idbKeyval.get(storeKey)) : JSON.parse(localStorage.getItem(storeKey)||'[]'); }catch(_){ return []; } },
    async set(v){ if(hasIDB()) await idbKeyval.set(storeKey, v); else localStorage.setItem(storeKey, JSON.stringify(v)); },
    async clear(){ if(hasIDB()) await idbKeyval.del(storeKey); else localStorage.removeItem(storeKey); }
  });

  const $ = s => document.querySelector(s);
  const list = document.querySelector('#goalsList');
  if(!list) return; // in case section not present

  const $name = document.querySelector('#goalName'), $target = document.querySelector('#goalTarget'), $file = document.querySelector('#goalImage');
  const $sale = document.querySelector('#saleAmount');

  const store = getStore();
  let goals = [];

  function uuid(){ return 'g' + Math.random().toString(36).slice(2,10); }
  function fmt(n){ return Number(n||0).toLocaleString(undefined,{style:'currency',currency:'USD'}); }
  const remaining = g => Math.max(0, Number(g.target||0) - Number(g.paid||0));
  const percent = g => { const t=Number(g.target||0); if(!t) return 0; const p=Math.min(t,Number(g.paid||0)); return Math.round((p/t)*100); };

  function goalCard(g){
    const card = document.createElement('div');
    card.style.cssText = 'background:#fff;border:1px solid #e2e8f0;border-radius:14px;padding:12px;display:grid;grid-template-columns:90px 1fr;gap:12px;';
    const img = document.createElement('img');
    img.alt = g.name; img.width=90; img.height=90; img.style.cssText='width:90px;height:90px;border-radius:12px;object-fit:cover;border:1px solid #e2e8f0;background:#fff;';
    img.src = g.image || 'data:image/svg+xml;utf8,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="90" height="90"><rect width="100%" height="100%" fill="#f8fafc"/><text x="50%" y="55%" text-anchor="middle" font-size="12" fill="#64748b">no image</text></svg>');

    const head = document.createElement('div');
    const title = document.createElement('div'); title.textContent = g.name||'(unnamed)'; title.style.cssText='font-weight:800;margin-bottom:4px;';
    const meta = document.createElement('div'); meta.style.cssText='color:#475569;font-size:.9rem;margin-bottom:6px;';
    meta.textContent = `Target ${fmt(g.target)} ¬∑ Paid ${fmt(g.paid)} ¬∑ Remaining ${fmt(remaining(g))}`;

    const bar = document.createElement('div'); bar.style.cssText='height:10px;border-radius:999px;background:#e2e8f0;overflow:hidden;margin-bottom:6px;';
    const fill = document.createElement('span'); fill.style.cssText=`display:block;height:100%;background:linear-gradient(90deg,#93c5fd,#34d399);width:${percent(g)}%;`;
    bar.appendChild(fill);

    const line = document.createElement('div'); line.style.cssText='display:flex;gap:8px;align-items:center;justify-content:space-between;';
    const badge = document.createElement('span');
    const done = remaining(g) <= 0;
    badge.textContent = done ? 'Achieved' : 'In Progress';
    badge.style.cssText = 'padding:4px 8px;border-radius:8px;font-weight:700;font-size:.8rem;'+(done?'background:#dcfce7;color:#14532d;':'background:#fef3c7;color:#78350f;');

    const rem = document.createElement('span'); rem.style.cssText='color:#475569;font-size:.9rem;';
    rem.textContent = done ? '0 remaining' : `${fmt(remaining(g))} remaining`;

    line.appendChild(badge); line.appendChild(rem);

    head.appendChild(title); head.appendChild(meta); head.appendChild(bar); head.appendChild(line);

    card.appendChild(img); card.appendChild(head);
    return card;
  }

  function render(){
    list.innerHTML='';
    goals.forEach(g => list.appendChild(goalCard(g)));
  }

  function toDataURL(file){
    return new Promise((resolve,reject)=>{
      if(!file) return resolve(null);
      const r = new FileReader();
      r.onload = ()=> resolve(r.result);
      r.onerror = reject;
      r.readAsDataURL(file);
    });
  }

  document.querySelector('#addGoal')?.addEventListener('click', async () => {
    const name = ($name?.value||'').trim();
    const target = Number($target?.value||0);
    if(!name || !target){ alert('Enter item and target price.'); return; }
    const imgData = await toDataURL($file?.files?.[0]);
    const g = { id: uuid(), name, target, paid: 0, image: imgData };
    goals.push(g);
    await store.set(goals);
    $name.value=''; $target.value=''; if($file) $file.value='';
    render();
  });

  document.querySelector('#applySale')?.addEventListener('click', async () => {
    const amt = Number($sale?.value||0);
    if(!amt){ alert('Enter sale amount.'); return; }
    if(!goals.length){ alert('Add a goal first.'); return; }
    // Apply to first non-achieved goal; if all achieved, apply to the one with highest remaining
    const target = goals.find(g => remaining(g)>0) || goals.sort((a,b)=>remaining(b)-remaining(a))[0];
    target.paid = Number(target.paid||0) + Math.max(0, amt);
    await store.set(goals);
    $sale.value='';
    render();
  });

  document.querySelector('#resetGoals')?.addEventListener('click', async () => {
    if(!confirm('Reset all goals?')) return;
    goals = [];
    await store.clear();
    render();
  });

  (async function init(){
    goals = await store.get() || [];
    render();
  })();
})();
</script>
<script id="separate-overall-performance-v5">
(function(){
  if (window.__opSplitV5) return; window.__opSplitV5=true;
  function closestCard(el){ return el && (el.closest('.section.card') || el.closest('.card')); }

  var aiH2 = Array.from(document.querySelectorAll('h2')).find(h => /AI\s*&\s*Event\s*Intelligence/i.test((h.textContent||'').trim()));
  var aiLabel = Array.from(document.querySelectorAll('label')).find(l => /OpenRouter\.ai\s*API\s*Key/i.test((l.textContent||'').trim()));
  var aiCard = closestCard(aiH2) || closestCard(aiLabel);
  if (!aiCard) return;

  var startH2 = Array.from(aiCard.querySelectorAll('h2')).find(h => /Overall\s*Performance/i.test((h.textContent||'').trim()));
  if (!startH2) return;

  var endH2 = Array.from(document.querySelectorAll('h2')).find(h => /This\s*Week'?s\s*Performance/i.test((h.textContent||'').trim()));
  if (!endH2 || !aiCard.contains(endH2)) {
    var n = startH2.nextElementSibling;
    while (n && aiCard.contains(n)) {
      if (n.tagName === 'H2') { endH2 = n; break; }
      n = n.nextElementSibling;
    }
  }

  var newCard = document.createElement('div');
  newCard.className = 'section card';
  newCard.style.backgroundColor = '#e6fffa';
  newCard.style.border = '1px solid #bae6fd';
  newCard.style.borderRadius = getComputedStyle(aiCard).borderRadius || '16px';
  newCard.style.padding = getComputedStyle(aiCard).padding || '16px';
  aiCard.parentNode.insertBefore(newCard, aiCard.nextSibling);

  var node = startH2;
  while (node && node !== endH2) {
    var next = node.nextSibling;
    newCard.appendChild(node);
    node = next;
  }
})();
</script>
<!-- === MOVE KPI TILES INTO OVERALL PERFORMANCE (non-destructive) === -->
<script id="op-five-tiles-setup">
document.addEventListener('DOMContentLoaded', function () {
  const $ = (s, r=document) => r.querySelector(s);
  const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
  const cardOf = el => el && (el.closest('.section.card') || el.closest('.card'));

  // 1) Find OP card
  const opH2 = $$('h2').find(h => /Overall\s*Performance/i.test((h.textContent||'').trim()));
  const opCard = cardOf(opH2);
  if (!opCard) return;

  // 2) Find the grid that contains the 4 KPI ids, move it inside OP under the H2
  const hasAll = g => ['#totalSpins','#totalCommissions','#salesCount','#conversionRate'].every(sel => g.querySelector(sel));
  let kpiGrid = $$('.grid, [class*="grid-cols"]').find(hasAll);
  if (!kpiGrid) return;

  if (!opCard.contains(kpiGrid)) {
    if (opH2 && opH2.parentNode) opH2.parentNode.insertBefore(kpiGrid, opH2.nextSibling);
    else opCard.appendChild(kpiGrid);
  }
  // Ensure grid has the op-grid class for 5 columns
  kpiGrid.classList.add('op-grid');

  // 4) Live total logic (localStorage + auto-increment on Today's Calls)
  const KEY = 'liveCallsTotal';
  const getInt = (x,d=0)=>{ const n=parseInt(x,10); return Number.isFinite(n)?n:d; };
  const render = v => { const el = document.querySelector('#liveCallsTotal'); if (el) el.textContent = String(v); };
  let total = getInt(localStorage.getItem(KEY), 0); render(total);
  const setTotal = v => { total = Math.max(0, getInt(v,0)); localStorage.setItem(KEY, String(total)); render(total); };

  function findTodaysCallsBox(){
    const h2 = $$('h2').find(h => /Today.?s\s*Performance/i.test((h.textContent||'').trim()));
    const card = cardOf(h2);
    if (!card) return null;
    // pick the box that contains label "Today's Calls"
    return $$('.text-center, .kpi, .tile, .rounded-lg', card)
      .find(b => /Today.?s\s*Calls/i.test((b.textContent||'').trim())) || null;
  }

  const callsBox = findTodaysCallsBox();
  let lastVal = null;
  function extract(el){
    if (!el) return null;
    const nums = $$('.text-2xl, .text-lg, .font-bold, div, span', el)
      .map(n => (n.textContent||'').trim())
      .filter(s => /^\d+$/.test(s))
      .map(s => parseInt(s,10));
    if (nums.length) return nums[0];
    const m = (el.textContent||'').match(/(\d+)/);
    return m?parseInt(m[1],10):null;
  }
  if (callsBox){
    lastVal = extract(callsBox);
    const obs = new MutationObserver(() => {
      const curr = extract(callsBox);
      if (curr == null) return;
      if (lastVal == null) { lastVal = curr; return; }
      const delta = curr - lastVal;
      if (delta > 0) setTotal(total + delta);
      lastVal = curr;
    });
    obs.observe(callsBox, {subtree:true, childList:true, characterData:true});
  }

  // Hook Reset All Info if present
  let resetBtn = document.querySelector('#resetAllInfo') || document.querySelector('#resetAll') || document.querySelector('#resetEverything') ||
                 $$('button').find(b => /Reset\s*All\s*Info|Reset\s*All\b/i.test((b.textContent||'').trim())) || null;
  if (resetBtn) resetBtn.addEventListener('click', () => setTotal(0));
});
</script>
<script id="prune-ai-banner">
(function(){
  function byText(tag, re){
    var els = document.getElementsByTagName(tag);
    for (var i=0;i<els.length;i++){
      var t = (els[i].textContent||'').trim();
      if(re.test(t)) return els[i];
    }
    return null;
  }
  function removeBannersInCard(card){
    if(!card) return;
    // remove any obvious banners by class
    var sel = '.bg-rose-50, .bg-red-50, .bg-pink-50, .ai-key-banner, #api-warning';
    card.querySelectorAll(sel).forEach(function(n){ n.remove(); });
    // remove anonymous empty rows right after inputs grid
    var grids = card.querySelectorAll('.grid, .grid-cols-1, .md\:grid-cols-2');
    var lastGrid = grids[grids.length-1];
    if(lastGrid){
      // remove following siblings that are empty/visual only
      var n = lastGrid.nextElementSibling;
      while(n){
        var txt = (n.textContent||'').trim();
        var h = n.getBoundingClientRect ? n.getBoundingClientRect().height : 0;
        if(txt==='' || h<18){
          var toRemove = n;
          n = n.nextElementSibling;
          toRemove.remove();
          continue;
        }
        break;
      }
    }
  }
  function run(){
    // Try by H2 text
    var h2 = byText('h2', /AI\s*&\s*Event\s*Intelligence/i);
    var card = h2 ? (h2.closest('.card') || h2.parentElement) : null;
    // Fallback by OpenRouter input id
    if(!card){
      var anchor = document.getElementById('apiKeyInput');
      if(anchor) card = anchor.closest('.card');
    }
    removeBannersInCard(card);
  }
  window.addEventListener('load', run);
  setTimeout(run, 300);
  setTimeout(run, 1200);
})();
</script>
<script id="stop-key-autochecks">
(function(){
  // Neutralize any init that auto-checks remote services on load.
  // We allow Analyze button to perform scans explicitly.
  var initFns = ['maybeEnableAndInitClient','initializeGapiClient'];
  initFns.forEach(function(name){
    if(typeof window[name]==='function'){
      var orig = window[name];
      window[name] = function(){
        try{ return orig.apply(this, arguments); }catch(e){}
      };
    }
  });
})();
</script>
<script>
let SEARCH_RADIUS_MILES = 50;

function setSearchRadius(miles) {
  SEARCH_RADIUS_MILES = miles;
  const lbl = document.getElementById("radiusLabel");
  if (lbl) lbl.textContent = `Current Radius: ${SEARCH_RADIUS_MILES} miles`;
  if (typeof refreshEvents === "function") refreshEvents();
}

document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("distanceButton");
  if (btn) {
    btn.addEventListener("click", () => {
      const miles = parseInt(prompt("Enter search radius in miles:", SEARCH_RADIUS_MILES), 10);
      if (!isNaN(miles)) setSearchRadius(miles);
    });
  }
  setSearchRadius(SEARCH_RADIUS_MILES);
});

function isWithinRadius(userLat, userLng, eventLat, eventLng) {
  const R = 3958.8; // miles
  const toRad = deg => deg * Math.PI / 180;
  const dLat = toRad(eventLat - userLat);
  const dLon = toRad(eventLng - userLng);
  const a = Math.sin(dLat/2)**2 + Math.cos(toRad(userLat)) * Math.cos(toRad(eventLat)) * Math.sin(dLon/2)**2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return (R * c) <= SEARCH_RADIUS_MILES;
}
</script>
<script>
function formatEventDate(start, end) {
  const s = new Date(start);
  const e = new Date(end);
  const opts = { month: 'short', day: 'numeric', year: 'numeric' };
  if (!end || s.toDateString() === e.toDateString()) {
    return s.toLocaleDateString(undefined, opts);
  } else {
    return `${s.toLocaleDateString(undefined, opts)} ‚Äì ${e.toLocaleDateString(undefined, opts)}`;
  }
}

function categoryEmoji(cat) {
  switch(cat) {
    case "concerts": return "üé§ Concert";
    case "sports": return "üèà Sports";
    case "festivals": return "üé≠ Festival";
    case "expos": return "üè¢ Expo";
    case "conferences": return "üìä Conference";
    default: return "üé´ Event";
  }
}

function haversineDistance(lat1, lon1, lat2, lon2) {
  const R = 3958.8; // miles
  const dLat = (lat2-lat1) * Math.PI/180;
  const dLon = (lon2-lon1) * Math.PI/180;
  const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

function renderEvents(events) {
  const list = document.getElementById("eventsList");
  if (!list) return;
  list.innerHTML = "";
  const hotelLat = window.currentLat || 0;
  const hotelLng = window.currentLng || 0;
  events.forEach(ev => {
    const li = document.createElement("li");
    li.style.marginBottom = "14px";
    const cat = ev.category ? categoryEmoji(ev.category) : "üé´ Event";
    const name = `<span style='color:red;font-weight:bold;'>${ev.title}</span>`;
    const date = formatEventDate(ev.start, ev.end);
    const attend = ev.phq_attendance ? `${ev.phq_attendance} asistentes esperados` : "(no estimate)";
    let distTxt = "";
    if (ev.location && ev.location.length === 2 && hotelLat && hotelLng) {
      const dist = haversineDistance(hotelLat, hotelLng, ev.location[1], ev.location[0]);
      distTxt = `üìç ${dist.toFixed(1)} miles del hotel`;
    }
    li.innerHTML = `${cat} ‚Äî ${name}<br>üìÖ ${date} ‚Äî ${attend}<br>${distTxt}`;
    list.appendChild(li);
  });
}
</script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  try {
    var results = document.getElementById('intelligenceResults');
    if (!results) return;
    var once = false;
    var obs = new MutationObserver(function(){
      try {
        // Remove Concierge Corner column
        var h4s = Array.prototype.slice.call(results.querySelectorAll('h4'));
        h4s.forEach(function(h){
          if (/Concierge Corner/i.test(h.textContent||'')){
            var col = h.closest('div');
            if (col && col.parentNode) col.parentNode.removeChild(col);
          }
        });
        // Force grid to single full-width column
        var grids = Array.prototype.slice.call(results.querySelectorAll('.grid'));
        grids.forEach(function(grid){
          grid.className = grid.className.replace(/\blg:grid-cols-2\b/g,'lg:grid-cols-1').replace(/\bgrid-cols-2\b/g,'grid-cols-1');
        });
        // Make the list "full window" height: remove internal scroll and let it expand
        var lists = Array.prototype.slice.call(results.querySelectorAll('[class*="overflow-y-auto"]'));
        lists.forEach(function(list){
          list.style.maxHeight = 'none';
          list.style.height = 'auto';
          list.style.overflowY = 'visible';
        });
      } catch(e){ console.warn('Observer adjustments error', e); }
    });
    obs.observe(results, { childList: true, subtree: true });
  } catch(e){ console.warn('Observer init failed', e); }
});
</script>
<script>
(function(){
  function nthDow(year,m,dow,n){ var f=new Date(year,m,1), add=(dow-f.getDay()+7)%7 + (n-1)*7; return new Date(year,m,1+add); }
  function lastDow(year,m,dow){ var d=new Date(year,m+1,0), diff=(d.getDay()-dow+7)%7; return new Date(year,m+1,0-diff); }
  function observed(dt){ var d=new Date(dt), w=d.getDay(); if(w===6){ d.setDate(d.getDate()-1); } else if(w===0){ d.setDate(d.getDate()+1); } return d; }
  function usHolidays(y){
    return [
      observed(new Date(y,0,1)),                    // New Year
      nthDow(y,0,1,3),                               // MLK
      nthDow(y,1,1,3),                               // Presidents
      lastDow(y,4,1),                                // Memorial (Mon)
      observed(new Date(y,6,4)),                     // July 4
      nthDow(y,8,1,1),                               // Labor
      nthDow(y,9,1,2),                               // Columbus/Indigenous
      observed(new Date(y,10,11)),                   // Veterans
      nthDow(y,10,4,4),                              // Thanksgiving
      observed(new Date(y,11,25)),                   // Christmas
    ];
  }
  function isHolidayWeekend(d){
    const list = usHolidays(d.getFullYear()).concat(usHolidays(d.getFullYear()-1), usHolidays(d.getFullYear()+1));
    for(const h of list){ const s=new Date(h), e=new Date(h); s.setDate(h.getDate()-3); e.setDate(h.getDate()+3); if(d>=s && d<=e) return h; }
    return null;
  }
  document.addEventListener('DOMContentLoaded', function(){
    const input=document.getElementById('intelligenceCheckInDate'); const results=document.getElementById('intelligenceResults');
    if(!input || !results) return;
    function update(){
      const v=input.value; if(!v) return;
      const d=new Date(v+'T00:00:00'); const h=isHolidayWeekend(d);
      const old=document.getElementById('holidayWeekendBanner'); if(old) old.remove();
      if(h){ const b=document.createElement('div'); b.id='holidayWeekendBanner'; b.className='p-3 mb-3 rounded-lg border-2 border-yellow-400 bg-yellow-50 text-yellow-900 font-semibold'; b.textContent='Holiday weekend around '+ d.toLocaleDateString() +'. Expect higher demand.'; results.prepend(b); }
    }
    input.addEventListener('change', update); update();
  });
})();
</script>
<style>
  .checkin-hit { background:#FEF9C3 !important; } /* soft yellow */
</style>
<script>
/* ===== Distance, Highlight, and Date-aware Search (non-destructive) ===== */
async function __geocodeAddress(q){
  const url = 'https://nominatim.openstreetmap.org/search?format=json&limit=1&q='+encodeURIComponent(q);
  const res = await fetch(url, { headers:{'Accept':'application/json'} });
  if(!res.ok) throw new Error('Geocode failed '+res.status);
  const arr = await res.json();
  if(!arr || !arr.length) throw new Error('No geocode results');
  return { lat: Number(arr[0].lat), lng: Number(arr[0].lon) };
}
function __haversineMiles(lat1,lon1,lat2,lon2){
  const R=3958.8, toRad=v=>v*Math.PI/180;
  const dLat=toRad(lat2-lat1), dLon=toRad(lon2-lon1);
  const a=Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
  return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}
async function __osrmMinutes(frLat,frLng,toLat,toLng){
  try{
    const url=`https://router.project-osrm.org/route/v1/driving/${frLng},${frLat};${toLng},${toLat}?overview=false`;
    const r=await fetch(url); if(!r.ok) return null;
    const j=await r.json();
    const s=j && j.routes && j.routes[0] && j.routes[0].duration;
    return (isFinite(s)? Math.round(s/60) : null);
  }catch(_){ return null; }
}
function __dateOnlyStrLocal(d){
  const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), da=String(d.getDate()).padStart(2,'0');
  return y+'-'+m+'-'+da;
}
function __humanDate(d){
  return d.toLocaleDateString('en-US',{year:'numeric', month:'short', day:'numeric'});
}

async function ensureOriginFromAddress(){
  let addrEl = document.getElementById('searchInput');
  if(!addrEl){
    // very light fallback: pick first text input with 'address' in id/name/placeholder
    const cand = Array.from(document.querySelectorAll('input[type="text"],input[type="search"]'))
      .find(n=>/(address|hotel|origin|location)/i.test(n.id||'') || /(address|hotel|origin|location)/i.test(n.name||'') || /(address|hotel|origin|location)/i.test(n.placeholder||''));
    addrEl = cand || null;
  }
  if(addrEl && addrEl.value && addrEl.value.trim()){
    try{
      const {lat,lng} = await __geocodeAddress(addrEl.value.trim());
      window.currentLat = lat; window.currentLng = lng;
      try { localStorage.setItem('hotelLat', String(lat)); localStorage.setItem('hotelLng', String(lng)); } catch(_){}
      return {lat,lng};
    }catch(e){ /* fall back below */ }
  }
  const a = Number(localStorage.getItem('hotelLat'));
  const b = Number(localStorage.getItem('hotelLng'));
  if(isFinite(a) && isFinite(b)) return {lat:a,lng:b};
  if(isFinite(window.currentLat) && isFinite(window.currentLng)) return {lat:Number(window.currentLat), lng:Number(window.currentLng)};
  return null;
}

/* Robust coordinate extraction from event object */
function __extractEventLatLng(ev){
  const candidates = [
    [ev && ev.latitude, ev && ev.longitude],
    [ev && ev.lat, ev && ev.lng],
    [ev && ev.venue_latitude, ev && ev.venue_longitude],
    [ev && ev.venue_lat, ev && ev.venue_lng],
    [ev && ev.location && ev.location.lat, ev && ev.location && ev.location.lng],
    [ev && ev.coordinates && ev.coordinates.lat, ev && ev.coordinates && ev.coordinates.lng],
    // GeoJSON style
    (ev && ev.geometry && Array.isArray(ev.geometry.coordinates)) ? [ev.geometry.coordinates[1], ev.geometry.coordinates[0]] : null,
    Array.isArray(ev && ev.coordinates) ? [ev.coordinates[0], ev.coordinates[1]] : null
  ];
  for(const c of candidates){
    if(!c) continue;
    const la = Number(c[0]), lo = Number(c[1]);
    if(isFinite(la)&&isFinite(lo)) return {lat:la,lng:lo};
  }
  return null;
}

/* Optional: minimal venue text geocode if coords missing (limit to 2 per run) */
let __venueGeoBudget = 2;
async function __fallbackGeocodeFromCard(i){
  if(__venueGeoBudget<=0) return null;
  const detailLines = document.querySelectorAll('#intelligenceResults .text-slate-600.text-xs');
  const line = detailLines[i];
  if(!line) return null;
  // Usually the venue is the first bold link on that line or its immediate text
  let venueText = '';
  const bold = line.querySelector('strong, b, a');
  if(bold && bold.textContent) venueText = bold.textContent.trim();
  if(!venueText) venueText = (line.textContent||'').split('‚Ä¢')[0].replace('üìç','').trim();
  if(!venueText) return null;
  try{
    const {lat,lng} = await __geocodeAddress(venueText);
    __venueGeoBudget--;
    return {lat,lng};
  }catch(_){ return null; }
}

/* Hydrate distances after render */
async function hydrateDistances(events){
  const origin = await ensureOriginFromAddress();
  if(!origin) return;

  const rows = document.querySelectorAll('#intelligenceResults .text-slate-600.text-xs');
  const N = Math.min(rows.length, events.length);

  const pending = [];
  const limit = 4;
  let active = 0, i = 0;

  function runNext(){
    while(active < limit && i < N){
      const idx = i++;
      active++;
      const line = rows[idx];
      const ev = events[idx];

      let coords = __extractEventLatLng(ev);
      const doWork = async ()=>{
        if(!coords){ coords = await __fallbackGeocodeFromCard(idx); }
        if(!coords){ return; }

        let distSpan = line.querySelector('[data-dist]');
        let driveSpan = line.querySelector('[data-drive]');
        if(!distSpan){ distSpan = document.createElement('span'); distSpan.setAttribute('data-dist','1'); line.appendChild(distSpan); }
        if(!driveSpan){ driveSpan = document.createElement('span'); driveSpan.setAttribute('data-drive','1'); line.appendChild(driveSpan); }

        const miles = __haversineMiles(origin.lat, origin.lng, coords.lat, coords.lng);
        try { distSpan.textContent = ' ' + miles.toFixed(1) + ' mi'; } catch(_){}

        const mins = await __osrmMinutes(origin.lat, origin.lng, coords.lat, coords.lng);
        if(mins!=null) try{ driveSpan.textContent = ' (~' + mins + ' min drive)'; }catch(_){}
      };

      const p = Promise.resolve().then(doWork).catch(()=>{}).finally(()=>{ active--; runNext(); });
      pending.push(p);
    }
  }
  runNext();
  await Promise.all(pending);
}

/* Only highlight exact check-in date (local YYYY-MM-DD match) */
function highlightCheckinExact(events, checkInDateStr){
  if(!Array.isArray(events) || !checkInDateStr) return;
  const chk = new Date(checkInDateStr + 'T00:00:00');
  if(isNaN(+chk)) return;
  const chkKey = __dateOnlyStrLocal(chk);

  // Clear previous
  const root = document.getElementById('intelligenceResults');
  if(!root) return;
  root.querySelectorAll('.checkin-hit').forEach(n=>n.classList.remove('checkin-hit'));

  const detailLines = root.querySelectorAll('.text-slate-600.text-xs');
  for(let i=0; i<detailLines.length && i<events.length; i++){
    const ev = events[i];
    const dt = ev && ev.start_datetime ? new Date(ev.start_datetime) : null;
    if(!dt) continue;
    const evKey = __dateOnlyStrLocal(dt);
    if(evKey === chkKey){
      let card = detailLines[i].closest('div');
      for(let hops=0; hops<6 && card; hops++){
        if(card.className && /border-|rounded|shadow|divide-|py-|my-|px-/.test(card.className)) break;
        card = card.parentElement;
      }
      (card || detailLines[i]).classList.add('checkin-hit');
    }
  }
}

/* Update event search links: "Event Name Month Day, Year" only */
function enhanceEventLinksWithDate(events){
  if(!Array.isArray(events) || !events.length) return;
  const root = document.getElementById('intelligenceResults');
  if(!root) return;
  const detailLines = root.querySelectorAll('.text-slate-600.text-xs');

  for(let i=0; i<detailLines.length && i<events.length; i++){
    const ev = events[i];
    if(!ev || !ev.start_datetime) continue;
    const dt = new Date(ev.start_datetime);
    if(String(dt)==='Invalid Date') continue;

    const q = (ev.name || '').trim();
    const qDate = __humanDate(dt); // e.g., "Oct 6, 2025"
    /* Update event search links: "Event Name Month Day, Year expected attendance AI" */
const finalQ = q ? (q + ' ' + qDate + ' expected attendance AI') : (qDate + ' expected attendance');


    // choose a search anchor in this card
    let card = detailLines[i].closest('div');
    for(let hops=0; hops<6 && card; hops++){
      if(card.className && /border-|rounded|shadow|divide-|py-|my-|px-/.test(card.className)) break;
      card = card.parentElement;
    }
    if(!card) card = detailLines[i];

    // prefer known search anchors; else first anchor
    let a = card.querySelector('a[href*="google.com/search"],a[href*="bing.com/search"],a[href*="duckduckgo.com/?q="]');
    if(!a) a = card.querySelector('a');
    if(!a) continue;

    try{
      // If link already points to a search engine, replace the q param; else make it a Google search.
      let u;
      try{ u = new URL(a.href, location.href); }catch(_){ u = null; }
      if(u && u.hostname.includes('google') && u.pathname.includes('/search')){
        u.searchParams.set('q', finalQ);
        a.href = u.toString();
      }else if(u && u.hostname.includes('bing.com') && u.pathname==='/search'){
        u.searchParams.set('q', finalQ);
        a.href = u.toString();
      }else if(u && u.hostname.includes('duckduckgo.com')){
        u.searchParams.set('q', finalQ);
        a.href = u.toString();
      }else{
        a.href = 'https://www.google.com/search?q=' + encodeURIComponent(finalQ);
        a.target = '_blank';
        a.rel = 'noopener';
      }
    }catch(_){ /* leave as-is on failure */ }
  }
}
</script>
<!-- DISTANCE + DRIVE-TIME HELPERS -->
<script>
async function __geocodeAddress(q, ms=8000){
  const ctrl=new AbortController(); const t=setTimeout(()=>ctrl.abort(), ms);
  try{
    const url='https://nominatim.openstreetmap.org/search?format=json&limit=1&q='+encodeURIComponent(q);
    const r=await fetch(url,{headers:{'Accept':'application/json'}, signal:ctrl.signal});
    if(!r.ok) throw new Error('geocode '+r.status);
    const a=await r.json(); if(!a||!a.length) throw new Error('no result');
    return {lat:+a[0].lat, lng:+a[0].lon};
  }catch(_){ return null; } finally{ clearTimeout(t); }
}
function __haversineMiles(a,b,c,d){
  const R=3958.8, toRad=(v)=>v*Math.PI/180;
  const dLat=toRad(c-a), dLon=toRad(d-b);
  const A=Math.sin(dLat/2)**2 + Math.cos(toRad(a))*Math.cos(toRad(c))*Math.sin(dLon/2)**2;
  return R*2*Math.atan2(Math.sqrt(A), Math.sqrt(1-A));
}
async function __osrmMinutes(frLat,frLng,toLat,toLng, ms=9000){
  const ctrl=new AbortController(); const t=setTimeout(()=>ctrl.abort(), ms);
  try{
    const u=`https://router.project-osrm.org/route/v1/driving/${frLng},${frLat};${toLng},${toLat}?overview=false`;
    const r=await fetch(u,{signal:ctrl.signal}); if(!r.ok) return null;
    const j=await r.json(); const s=j && j.routes && j.routes[0] && j.routes[0].duration;
    return isFinite(s)? Math.round(s/60) : null;
  }catch(_){ return null; } finally{ clearTimeout(t); }
}

/* 1) Detect origin from your address box (uses id="searchInput") */
async function __originFromAddress(){
  const el=document.getElementById('searchInput');
  if(el && el.value && el.value.trim()){
    const r=await __geocodeAddress(el.value.trim());
    if(r){ try{ localStorage.setItem('hotelLat',r.lat); localStorage.setItem('hotelLng',r.lng);}catch(_){}; return r; }
  }
  const a=+localStorage.getItem('hotelLat'), b=+localStorage.getItem('hotelLng');
  if(isFinite(a)&&isFinite(b)) return {lat:a,lng:b};
  if(isFinite(window.currentLat)&&isFinite(window.currentLng)) return {lat:+window.currentLat,lng:+window.currentLng};
  return null;
}

/* 2) Extract coords from each event object (handles common shapes) */
function __eventCoords(ev){
  const cands=[
    [ev?.latitude, ev?.longitude],
    [ev?.lat, ev?.lng],
    [ev?.venue_latitude, ev?.venue_longitude],
    [ev?.venue_lat, ev?.venue_lng],
    [ev?.location?.lat, ev?.location?.lng],
    (ev?.geometry?.coordinates && Array.isArray(ev.geometry.coordinates)) ? [ev.geometry.coordinates[1],ev.geometry.coordinates[0]] : null,
    (Array.isArray(ev?.coordinates) ? [ev.coordinates[0],ev.coordinates[1]] : null)
  ];
  for(const c of cands){ if(!c) continue; const la=+c[0], lo=+c[1]; if(isFinite(la)&&isFinite(lo)) return {lat:la,lng:lo}; }
  return null;
}

/* 3) Write distance into the small gray venue line inside each card */
async function hydrateDistances(events){
  const origin=await __originFromAddress(); if(!origin) return;
  const root=document.getElementById('intelligenceResults'); if(!root) return;

  // This selector targets the gray venue line you already have
  const lines=root.querySelectorAll('.text-slate-600.text-xs');
  const N=Math.min(lines.length, events.length);

  // Run in small batches so the UI stays responsive
  const limit=3; let active=0, i=0; const pending=[];
  function pump(){
    while(active<limit && i<N){
      const idx=i++; active++;
      const line=lines[idx], ev=events[idx];
      const coords=__eventCoords(ev);
      const work=async()=>{
        if(!coords) return;

        let distSpan=line.querySelector('[data-dist]'); 
        let driveSpan=line.querySelector('[data-drive]');
        if(!distSpan){ distSpan = document.createElement('span'); distSpan.setAttribute('data-dist','1'); line.appendChild(distSpan); }
        if(!driveSpan){ driveSpan = document.createElement('span'); driveSpan.setAttribute('data-drive','1'); line.appendChild(driveSpan); }

        const miles=__haversineMiles(origin.lat,origin.lng,coords.lat,coords.lng);
        distSpan.textContent=' '+miles.toFixed(1)+' mi';

        const m=await __osrmMinutes(origin.lat,origin.lng,coords.lat,coords.lng);
        if(m!=null) driveSpan.textContent=' (~'+m+' min drive)';
      };
      pending.push(Promise.resolve().then(work).catch(()=>{}).finally(()=>{ active--; pump(); }));
    }
  }
  pump(); await Promise.all(pending);
}
</script>
</div></div>
<script>
(function(){
  function fmtHMS(totalSeconds){
    totalSeconds = Math.max(0, Math.floor(totalSeconds||0));
    var h = Math.floor(totalSeconds/3600);
    var m = Math.floor((totalSeconds%3600)/60);
    var s = totalSeconds%60;
    return String(h).padStart(2,'0')+':'+String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
  }
  function monthlySeconds(){
    var now = new Date();
    var monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
    var work = (window.state && Array.isArray(window.state.workSessions)) ? window.state.workSessions : (window.workSessions||[]);
    var total = 0;
    try{
      (work||[]).forEach(function(s){
        var st = new Date(s.start);
        var en = s.end ? new Date(s.end) : now;
        if (en < monthStart) return;               // entirely before
        if (st < monthStart) st = monthStart;      // clamp
        if (en > now) en = now;                    // clamp
        total += Math.max(0, (en - st)/1000);
      });
    }catch(e){/* keep 0 */}
    return total;
  }
  function tickMonthly(){
    var el = document.getElementById('monthlyTime');
    if (!el) return;
    el.textContent = fmtHMS(monthlySeconds());
  }
  function bootMonthly(){
    tickMonthly();
    setInterval(tickMonthly, 1000);
  }
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', bootMonthly);
  } else {
    bootMonthly();
  }
})();
</script>

<!-- Robust Manual Sync + safe auth binder -->
<script>
(function(){
  function setStatus(text, color){ try{ var el=document.getElementById('googleAuthStatus'); if(el){ el.textContent=text; if(color) el.style.color=color; } }catch(e){} }
  function ensureTokenClient(){
    try{
      if (window.tokenClient) return true;
      if (!window.google || !google.accounts || !google.accounts.oauth2) return false;
      var clientId = '';
      try{ if(window.state && window.state.settings && window.state.settings.googleClientId){ clientId = String(window.state.settings.googleClientId||''); } }catch(_){}
      if (!clientId){ var el=document.getElementById('googleClientIdInput'); if(el) clientId = el.value.trim(); }
      if (!clientId){ setStatus('Status: Enter your Google Client ID', '#991b1b'); return false; }
      window.tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: clientId,
        scope: 'https://www.googleapis.com/auth/spreadsheets',
        callback: function(tokenResponse){
          try{
            if(tokenResponse && tokenResponse.access_token){
              window.gapiAccessToken = tokenResponse.access_token;
              var ms=document.getElementById('manualSyncButton'); if(ms) ms.disabled=false;
              var ab=document.getElementById('authButton'); if(ab) ab.classList.add('hidden');
              var sb=document.getElementById('signoutButton'); if(sb) sb.classList.remove('hidden');
              setStatus('Status: Authorized', '#166534');
            }else{
              setStatus('Status: No access token returned', '#991b1b');
            }
          }catch(e){ console.error(e); }
        }
      });
      return true;
    }catch(e){ console.error(e); return false; }
  }

  function bindAuthButton(){
    var btn=document.getElementById('authButton'); if(!btn || btn.dataset.bound==='1') return; btn.dataset.bound='1';
    btn.addEventListener('click', function(){
      if(!ensureTokenClient()){ return; }
      try{ window.tokenClient.requestAccessToken({ prompt:'consent' }); }catch(e){ console.error(e); setStatus('Status: Auth failed', '#991b1b'); }
    });
  }

  function bindManualSync(){
    var btn=document.getElementById('manualSyncButton'); if(!btn || btn.dataset.bound==='1') return; btn.dataset.bound='1';
    btn.addEventListener('click', async function(){
      try{
        var prev=btn.textContent; btn.textContent='Syncing...'; btn.disabled=true;
        var fn = (window && window.syncToGoogleSheet) ? window.syncToGoogleSheet : (typeof syncToGoogleSheet==='function'?syncToGoogleSheet:null);
        if(!fn){ console.error('syncToGoogleSheet is not accessible'); if(window.showToast) showToast('Sync function unavailable', 'error'); return; }
        await Promise.resolve(fn());
        if(window.showToast) showToast('Manual sync completed', 'success');
      }catch(e){ console.error(e); if(window.showToast) showToast('Sync failed. See console.', 'error'); }
      finally{ btn.disabled=false; btn.textContent=prev||'Sync Manually'; }
    }, { once:false });
  }

  function boot(){ bindAuthButton(); bindManualSync(); }
  if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', boot); } else { boot(); }
})();
</script>
<style>
#monthlyTime {
  font-variant-numeric: tabular-nums;
  transition: none !important;
  display: inline-block;
  min-width: 120px;     /* keeps width fixed */
  text-align: center;
  background-clip: padding-box;
  -webkit-font-smoothing: antialiased;
  will-change: contents;  /* hint GPU to keep it stable */
}
</style>

<script>
// ---- MONTHLY TRACKER COUNTER (anti-flicker hardware-paint version) ----
document.addEventListener("DOMContentLoaded", () => {
  const el = document.getElementById("monthlyTime");
  if (!el) return;

  let trackerSeconds = parseInt(localStorage.getItem("monthlySeconds")) || 0;
  const format = s => {
    const h = Math.floor(s / 3600);
    const m = Math.floor((s % 3600) / 60);
    const sec = s % 60;
    return `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(sec).padStart(2,"0")}`;
  };

  // draw once before start
  el.textContent = format(trackerSeconds);

  // use one stable interval; force text update without clearing node
  setInterval(() => {
    trackerSeconds++;
    const newText = format(trackerSeconds);
    // instead of replacing innerHTML, just update the text node directly
    if (el.firstChild) {
      el.firstChild.nodeValue = newText;
    } else {
      el.textContent = newText;
    }
    localStorage.setItem("monthlySeconds", trackerSeconds);
  }, 1000);
});
</script>
<script>
/* Hide the old radius dropdown; filtering is time-based now */
(function hideRadiusUIOnly(){
  function hideRadiusControls(){
    document.querySelectorAll('select').forEach(sel => {
      const txt = Array.from(sel.options||[]).map(o=>o.textContent||'').join(' ').toLowerCase();
      if (/\bmi\b/.test(txt) || /\bmiles?\b/.test(txt) || /\bkm\b/.test(txt)) {
        sel.style.display = 'none';
        if (sel.parentElement) sel.parentElement.style.display = 'none';
      }
    });
  }
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', hideRadiusControls);
  else hideRadiusControls();
  window.addEventListener('renderIntelligenceDone', hideRadiusControls);
})();
</script>


</body></html>
<script>
(function(){
  const SCOPES = "https://www.googleapis.com/auth/spreadsheets";

  window.gapiLoadError = (e) => console.error("Google API failed to load:", e);
  window.gisLoadError  = (e) => console.error("Google Identity failed to load:", e);

  window.gapiLoaded = function() {
    console.log('gapi loaded, initializing Sheets API...');
    
    if (!window.gapi || !gapi.load) {
        console.error('gapi not properly loaded');
        return;
    }
    
    gapi.load('client', async () => {
        try {
            await gapi.client.init({
                discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4']
            });
            window.gapiInited = true;
            console.log('‚úÖ Google Sheets API initialized!');
            maybeEnableAndInitClient();
        } catch (err) {
            console.error("GAPI init error:", err);
            showToast('Failed to initialize Google Sheets API', 'error');
        }
    });
};

  window.gisLoaded = function(){
    window.gisInited = true;
    maybeEnableAndInitClient();
  };

  window.maybeEnableAndInitClient = function(){
    const statusEl = document.querySelector('#googleAuthStatus');
    const authBtn  = document.querySelector('#authButton');
    const setStatus = (t) => { if(statusEl) statusEl.textContent = t; };

    if (!(window.gapiInited && window.gisInited)) {
      if (authBtn) authBtn.disabled = true;
      setStatus('Status: Loading Google APIs...');
      return;
    }

    const clientId = (window.state && window.state.settings && window.state.settings.googleClientId) 
      ? window.state.settings.googleClientId 
      : (document.querySelector('#googleClientIdInput') ? (document.querySelector('#googleClientIdInput').value||'').trim() : '');

    if (!clientId) {
      if (authBtn) authBtn.disabled = true;
      setStatus('Status: Client ID Missing');
      return;
    }

    try {
      window.tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: clientId,
        scope: SCOPES,
        callback: (tokenResponse) => {
          if (tokenResponse && tokenResponse.error) {
            console.error('Token error:', tokenResponse.error);
            return;
          }
          window.gapiAccessToken = tokenResponse.access_token;
          updateSigninStatus(true);
          if (typeof showToast==='function') showToast('Authorization successful!', 'success');
          if (typeof syncToGoogleSheet==='function') syncToGoogleSheet();
        }
      });
    } catch (err) {
      console.error("InitTokenClient error:", err);
      return;
    }

    if (authBtn) authBtn.disabled = false;
    setStatus('Status: Ready to Authorize');
  };

  window.updateSigninStatus = function(isSignedIn){
    const status = document.querySelector('#googleAuthStatus');
    if (isSignedIn) {
      document.querySelector('#authButton')?.classList.add('hidden');
      document.querySelector('#signoutButton')?.classList.remove('hidden');
      document.querySelector('#manualSyncButton')?.removeAttribute('disabled');
      if (status){ status.textContent = 'Status: Authorized'; status.style.color = '#166534'; }
    } else {
      document.querySelector('#authButton')?.classList.remove('hidden');
      document.querySelector('#signoutButton')?.classList.add('hidden');
      document.querySelector('#manualSyncButton')?.setAttribute('disabled','disabled');
      if (status){ status.textContent = 'Status: Not Authorized'; status.style.color = '#991b1b'; }
    }
  };
})();
</script>
<script>
// Bind Google-related buttons with safeOn (if present)
(function(){
  if (typeof safeOn !== 'function') return;
  safeOn('authButton','click', () => {
    try {
      if (window.tokenClient) {
        window.tokenClient.requestAccessToken({prompt:''});
      } else {
        if (typeof showToast==='function') showToast('Google not ready', 'error');
      }
    } catch (err) { console.error(err); }
  });
  safeOn('signoutButton','click', () => {
    try {
      if (window.gapiAccessToken) {
        google.accounts.oauth2.revoke(window.gapiAccessToken);
        window.gapiAccessToken = null;
        if (typeof updateSigninStatus==='function') updateSigninStatus(false);
        if (typeof showToast==='function') showToast('Signed out from Google', 'success');
      }
    } catch (err) { console.error(err); }
  });
  safeOn('manualSyncButton','click', () => {
    try { if (typeof syncToGoogleSheet==='function') syncToGoogleSheet(); } catch (err) { console.error(err); }
  });
})();
</script>
<script>
// üîß Fix: ensure the manual sync button really triggers the Google Sheets sync
document.addEventListener('DOMContentLoaded', function() {
  const manualSyncButton = document.querySelector('#manualSyncButton');
  if (manualSyncButton) {
    manualSyncButton.addEventListener('click', async function() {
      console.log('üîÑ Manual sync button clicked (direct event binding)');
      await syncToGoogleSheet();
    });
  } else {
    console.warn('‚ö†Ô∏è manualSyncButton not found in DOM');
  }
});
</script>
